%!PS-Adobe-2.0
%%Creator: dvipsk 5.58f Copyright 1986, 1994 Radical Eye Software
%%Title: bro.dvi
%%Pages: 18
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Roman Times-Bold Times-Italic Courier
%%+ Courier-Oblique
%%EndComments
%DVIPSCommandLine: dvips bro.dvi
%DVIPSParameters: dpi=600, compressed, comments removed
%DVIPSSource:  TeX output 1998.01.14:1703
%%BeginProcSet: texc.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]/id ch-image N /rw ch-width 7 add 8 idiv string N /rc 0 N /gp 0 N
/cp 0 N{rc 0 ne{rc 1 sub /rc X rw}{G}ifelse}imagemask restore}B /G{{id
gp get /gp gp 1 add N dup 18 mod S 18 idiv pl S get exec}loop}B /adv{cp
add /cp X}B /chg{rw cp id gp 4 index getinterval putinterval dup gp add
/gp X adv}B /nd{/cp 0 N rw exit}B /lsh{rw cp 2 copy get dup 0 eq{pop 1}{
dup 255 eq{pop 254}{dup dup add 255 and S 1 and or}ifelse}ifelse put 1
adv}B /rsh{rw cp 2 copy get dup 0 eq{pop 128}{dup 255 eq{pop 127}{dup 2
idiv S 128 and or}ifelse}ifelse put 1 adv}B /clr{rw cp 2 index string
putinterval adv}B /set{rw cp fillstr 0 4 index getinterval putinterval
adv}B /fillstr 18 string 0 1 17{2 copy 255 put pop}for N /pl[{adv 1 chg}
{adv 1 chg nd}{1 add chg}{1 add chg nd}{adv lsh}{adv lsh nd}{adv rsh}{
adv rsh nd}{1 add adv}{/rc X nd}{1 add set}{1 add clr}{adv 2 chg}{adv 2
chg nd}{pop nd}]dup{bind pop}forall N /D{/cc X dup type /stringtype ne{]
}if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginFont: Times-Roman
% @psencodingfile{
%   author = "P. MacKay, Alan Jeffrey, S. Rahtz, K. Berry, B. Horn",
%   version = "0.2",
%   date = "7 September 94",
%   filename = "8r.enc",
%   email = "kb@cs.umb.edu",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "xx",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% }
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are in their Windows ANSI positions,
% because Windows users cannot easily reencode the fonts, and it makes
% no difference on other systems. The only Windows ANSI characters not
% available are those that make no sense for typesetting -- rubout
% (127 decimal), nobreakspace (160), softhyphen (173).
% 
% (2) The caron and dotlessi characters are in the positions used by
% Y&Y for their modified ATM encoding.
% 
% (3) Remaining characters are assigned arbitrarily to the first few
% positions.
% 
% (4) (Y&Y) Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x10.
% 
% (5) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available in the Type 1 fonts.
% 
% Ligatures are omitted, since this encoding is intended for use at the
% driver end. Including ligatures and kerns would make the TFM files
% much larger, to no particular purpose. If someone actually wants to
% typeset in this encoding, they can pick a different name, and regenerate
% the fonts.
 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /breve /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /tilde /minus
  % These are the only two remaining unencoded characters, so may as
  % well include them.
  /Zcaron /zcaron /.notdef /.notdef
% 0x10 (TeX characters from, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quotesingle
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /grave /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE
 /caron % Y&Y
 /.notdef
 /.notdef
% 0x90
 /.notdef /quoteleft /quoteright /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tildeaccent /trademark /scaron /guilsinglright
 /oe
 /dotlessi % Y&Y
 /.notdef
 /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def
%%EndFont
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2
index /UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type /integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics /Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont /setfont load]cvx def}def
/ObliqueSlant{dup sin S cos div neg}B /SlantFont{4 index mul add}def
/ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding exch def}def
end
%%EndProcSet
%%BeginProcSet: special.pro
TeXDict begin /SDict 200 dict N SDict begin /@SpecialDefaults{/hs 612 N
/vs 792 N /ho 0 N /vo 0 N /hsc 1 N /vsc 1 N /ang 0 N /CLIP 0 N /rwiSeen
false N /rhiSeen false N /letter{}N /note{}N /a4{}N /legal{}N}B
/@scaleunit 100 N /@hscale{@scaleunit div /hsc X}B /@vscale{@scaleunit
div /vsc X}B /@hsize{/hs X /CLIP 1 N}B /@vsize{/vs X /CLIP 1 N}B /@clip{
/CLIP 2 N}B /@hoffset{/ho X}B /@voffset{/vo X}B /@angle{/ang X}B /@rwi{
10 div /rwi X /rwiSeen true N}B /@rhi{10 div /rhi X /rhiSeen true N}B
/@llx{/llx X}B /@lly{/lly X}B /@urx{/urx X}B /@ury{/ury X}B /magscale
true def end /@MacSetUp{userdict /md known{userdict /md get type
/dicttype eq{userdict begin md length 10 add md maxlength ge{/md md dup
length 20 add dict copy def}if end md begin /letter{}N /note{}N /legal{}
N /od{txpose 1 0 mtx defaultmatrix dtransform S atan/pa X newpath
clippath mark{transform{itransform moveto}}{transform{itransform lineto}
}{6 -2 roll transform 6 -2 roll transform 6 -2 roll transform{
itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll curveto}}{{
closepath}}pathforall newpath counttomark array astore /gc xdf pop ct 39
0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}if}N
/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1 -1
scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3 get
ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip yflip
not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub neg 0
TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{noflips{TR
pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop 90 rotate 1
-1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg
TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr 1 get neg
sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr 2 get ppr
0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4 -1 roll add
2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S TR}if}N /cp
{pop pop showpage pm restore}N end}if}if}N /normalscale{Resolution 72
div VResolution 72 div neg scale magscale{DVImag dup scale}if 0 setgray}
N /psfts{S 65781.76 div N}N /startTexFig{/psf$SavedState save N userdict
maxlength dict begin /magscale true def normalscale currentpoint TR
/psf$ury psfts /psf$urx psfts /psf$lly psfts /psf$llx psfts /psf$y psfts
/psf$x psfts currentpoint /psf$cy X /psf$cx X /psf$sx psf$x psf$urx
psf$llx sub div N /psf$sy psf$y psf$ury psf$lly sub div N psf$sx psf$sy
scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub TR
/showpage{}N /erasepage{}N /copypage{}N /p 3 def @MacSetUp}N /doclip{
psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll newpath 4 copy 4 2
roll moveto 6 -1 roll S lineto S lineto S lineto closepath clip newpath
moveto}N /endTexFig{end psf$SavedState restore}N /@beginspecial{SDict
begin /SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count /ocount X /dcount countdictstack N}N /@setspecial
{CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto
closepath clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx
sub div rhiSeen{rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR
}{rhiSeen{rhi ury lly sub div dup scale llx neg lly neg TR}if}ifelse
CLIP 2 eq{newpath llx lly moveto urx lly lineto urx ury lineto llx ury
lineto closepath clip}if /showpage{}N /erasepage{}N /copypage{}N newpath
}N /@endspecial{count ocount sub{pop}repeat countdictstack dcount sub{
end}repeat grestore SpecialSave restore end}N /@defspecial{SDict begin}
N /@fedspecial{end}B /li{lineto}B /rl{rlineto}B /rc{rcurveto}B /np{
/SaveX currentpoint /SaveY X N 1 setlinecap newpath}N /st{stroke SaveX
SaveY moveto}N /fil{fill SaveX SaveY moveto}N /ellipse{/endangle X
/startangle X /yrad X /xrad X /savematrix matrix currentmatrix N TR xrad
yrad scale 0 0 1 startangle endangle arc savematrix setmatrix}N end
%%EndProcSet
TeXDict begin 40258431 52099146 1000 600 600 (bro.dvi)
@start /Fa 171[36 6[52 77[{TeXBase1Encoding ReEncodeFont}2
58.333336 /Times-Roman rf /Fb 172[50 6[50 6[50 50 1[50
66[{TeXBase1Encoding ReEncodeFont}5 83.333336 /Courier-Oblique
rf /Fc 6 112 df<146014E0EB01C0EB0380EB0700130E131E5B5BA25B485AA2485AA212
075B120F90C7FCA25A121EA2123EA35AA65AB2127CA67EA3121EA2121F7EA27F12077F12
03A26C7EA26C7E1378A27F7F130E7FEB0380EB01C0EB00E01460135278BD20>40
D<12C07E12707E7E7E120F6C7E6C7EA26C7E6C7EA21378A2137C133C133E131EA2131F7F
A21480A3EB07C0A6EB03E0B2EB07C0A6EB0F80A31400A25B131EA2133E133C137C1378A2
5BA2485A485AA2485A48C7FC120E5A5A5A5A5A13527CBD20>I<EB01C013031307131F13
FFB5FCA2131F1200B3B3A8497E007FB512F0A31C3879B72A>49 D<ED03F090390FF00FF8
90393FFC3C3C9039F81F707C3901F00FE03903E007C03A07C003E010000FECF000A24848
6C7EA86C6C485AA200075C6C6C485A6D485A6D48C7FC38073FFC38060FF0000EC9FCA412
0FA213C06CB512C015F86C14FE6CECFF804815C03A0F80007FE048C7EA0FF0003E140348
140116F8481400A56C1401007C15F06CEC03E0003F1407D80F80EB0F80D807E0EB3F0039
01FC01FC39007FFFF0010790C7FC26387EA52A>103 D<EA03F012FFA3120F1203B3B3AD
487EB512C0A3123A7EB917>108 D<EB03FE90380FFF8090383E03E09038F800F8484813
7C48487F48487F4848EB0F80001F15C090C712074815E0A2007EEC03F0A400FE15F8A900
7E15F0A2007F14076C15E0A26C6CEB0FC0000F15806D131F6C6CEB3F006C6C137EC66C13
F890387E03F090381FFFC0D903FEC7FC25277EA52A>111 D E /Fd
141[72 2[72 44[72 66[{TeXBase1Encoding ReEncodeFont}3
119.999947 /Courier rf /Fe 3 106 df<4B7E1503150782150F151FA2153FA2156F15
CF82EC0187140315071406140E140C02187FA2EC30031460A214C013011480D903007F91
B5FC5B90380C0001A25B13380130805B01E013005B12011203000F4A7ED8FFF890381FFF
E0A22B2A7DA932>65 D<013FB512F816FF903A01FC001FC04AEB07E0EE03F001031401A2
4A14F8A2130717F04A130317E0010F1407EE0FC04AEB1F80EE7E00011F495A91B512F0A2
91388001FC013FEB007E8291C7EA1F80160F4915C0A2137EA213FEEE1F805BEE3F000001
153E16FE49EB01F84B5A0003EC1FC0B7C7FC15F82D287DA732>I<130E131F5BA2133E13
1C90C7FCA7EA03E0487EEA0C78EA187C1230A212605B12C0A2EA01F0A3485AA2485AA2EB
C180EA0F81A2381F0300A213066C5A131CEA07F06C5A11287DA617>105
D E /Ff 130[40 40 40 40 40 1[40 40 40 40 40 40 40 40
40 40 40 40 40 1[40 40 40 40 40 40 40 40 40 1[40 1[40
40 40 1[40 1[40 40 40 40 40 40 40 40 40 40 1[40 2[40
40 1[40 40 40 40 40 40 1[40 40 40 1[40 40 40 40 40 40
40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40
40 40 40 33[{TeXBase1Encoding ReEncodeFont}81 66.666664
/Courier rf /Fg 143[60 3[60 2[60 5[60 60 60 97[{
TeXBase1Encoding ReEncodeFont}6 100.000000 /Courier rf
/Fh 134[50 2[50 55 33 39 44 1[55 50 55 83 28 55 1[28
55 50 33 44 55 44 55 50 10[72 1[66 55 2[61 78 8[61 66
72 72 12[50 50 50 50 50 50 2[25 46[{TeXBase1Encoding ReEncodeFont}37
100.000000 /Times-Bold rf /Fi 3 121 df<EC01F8140FEC3F80ECFC00495A495A49
5AA2130F5CB3A7131F5C133F49C7FC13FEEA03F8EA7FE048C8FCEA7FE0EA03F8EA00FE13
7F6D7E131F80130FB3A7801307A26D7E6D7E6D7EEC3F80EC0FF814011D537ABD2A>102
D<12FCEAFFC0EA07F0EA01FCEA007E7F80131F80130FB3A7801307806D7E6D7EEB007EEC
1FF0EC07F8EC1FF0EC7E00495A495A495A5C130F5CB3A7131F5C133F91C7FC137E485AEA
07F0EAFFC000FCC8FC1D537ABD2A>I<137E3801FFC03807C1E0380F0070001E1338003E
131C48130C141E147E5AA3143C1400A3127CA37E121E7E6C7E6C7EEA00F013FCEA03FF38
0F8780381F01E0003E13F0EB00F848137CA200FC133E5A141FA6127C143F6C133EA26C13
7CEA0F80000713F83801E1F03800FFC0EB3F00130FEB03C0EB01E0EB00F01478147C143E
A3141FA3123C127EA3143E127812300038137C6C13786C13F0380783E03803FF8038007E
00184C7ABA25>120 D E /Fj 9 113 df<121C127FEAFF80A5EA7F00121C0909798817>
58 D<1760177017F01601A21603A21607160FA24C7EA216331673166316C3A2ED0183A2
ED0303150683150C160115181530A21560A215C014011580DA03007FA202061300140E14
0C5C021FB5FC5CA20260C7FC5C83495A8349C8FC1306A25BA25B13385B01F01680487E00
0716FFB56C013F13FF5EA2383C7DBB3E>65 D<0103B77E4916F018FC903B0007F80003FE
4BEB00FFF07F80020FED3FC0181F4B15E0A2141FA25DA2143F19C04B143F1980027F157F
190092C812FE4D5A4A4A5AEF0FF04AEC1FC005FFC7FC49B612FC5F02FCC7B4FCEF3FC001
03ED0FE0717E5C717E1307844A1401A2130F17035CA2131F4D5A5C4D5A133F4D5A4A4A5A
4D5A017F4BC7FC4C5A91C7EA07FC49EC3FF0B812C094C8FC16F83B397DB83F>I<902603
FFF891381FFFF8496D5CA2D90007030113006FEC007C02061678DA0EFF157081020C6D14
60A2DA1C3F15E0705CEC181F82023815016F6C5C1430150702706D1303030392C7FC0260
7FA2DAE0015C701306ECC0008201016E130EEF800C5C163F0103EDC01C041F131891C713
E0160F49EDF03818300106140717F8010E02031370EFFC60130CEE01FE011C16E004005B
011815FF177F1338600130153FA20170151F95C8FC01F081EA07FCB512E01706A245397D
B843>78 D<4BB4FC031F13F09238FE01FC913903F0007EDA07C0EB1F80DA1F80EB0FC002
3EC7EA07E002FCEC03F0495A4948EC01F8495A4948EC00FC495A49C912FE49167E13FE49
167F1201485AA2485AA2120F5B001F17FFA2485AA34848ED01FEA400FFEE03FC90C9FCA2
EF07F8A2EF0FF0A218E0171F18C0EF3F806C167F180017FE4C5A6C6C5D1603001F4B5A6D
4A5A000FED1F806C6C4AC7FC6D147E0003EC01F8D801FC495AD8007EEB0FC090263F807F
C8FC903807FFF801001380383D7CBA3F>I<0003B812FEA25A903AF8003FC00101C09138
80007E4848163C90C7007F141C121E001C92C7FCA2485CA200305C007017180060130112
E0485CA21403C716005DA21407A25DA2140FA25DA2141FA25DA2143FA25DA2147FA292C9
FCA25CA25CA21301A25CA21303A25CEB0FFC003FB6FC5AA237397EB831>84
D<EB03F0EA01FFA3EA00075CA3130F5CA3131F5CA3133F91C8FCA35B017EEB07C0ED1FF0
ED783801FEEBE0F89039FC01C1FCEC0383EC07070001130ED9F81C13F891383803F09138
7001E0000349C7FCEBF1C0EBF38001F7C8FCEA07FEA2EBFFE0EBE7F8380FE0FEEBC07F6E
7E141F001F80D9800F1330A21670003F011F136001001380A216E04815C0007E1481020F
1380158300FE903807870048EB03FE0038EB00F8263B7CB92B>107
D<D803E0137F3A07F801FFE03A0E3C0781F03A1C3E1E00F826383F387F00305B4A137C00
705B00605BA200E090C712FC485A137EA20000140101FE5C5BA2150300015D5B15075E12
0349010F133016C0031F13700007ED80605B17E0EE00C0000F15014915801603EE070000
1FEC0F0E49EB07FC0007C7EA01F02C267EA432>110 D<90390F8003F090391FE00FFC90
3939F03C1F903A70F8700F80903AE0FDE007C09038C0FF80030013E00001491303018015
F05CEA038113015CA2D800031407A25CA20107140FA24A14E0A2010F141F17C05CEE3F80
131FEE7F004A137E16FE013F5C6E485A4B5A6E485A90397F700F80DA383FC7FC90387E1F
FCEC07E001FEC9FCA25BA21201A25BA21203A25B1207B512C0A32C3583A42A>112
D E /Fk 4 53 df<13E01201120712FF12F91201B3A7487EB512C0A212217AA01E>49
D<EA01FC3807FF80381C0FC0383003E0386001F0EB00F812F86C13FCA2147C1278003013
FCC7FC14F8A2EB01F0EB03E014C0EB0780EB0F00131E13385B5B3801C00CEA0380380600
185A5A383FFFF85AB512F0A216217CA01E>I<13FF000313C0380F03E0381C00F014F800
3E13FC147CA2001E13FC120CC712F8A2EB01F0EB03E0EB0FC03801FF00A2380003E0EB00
F01478147C143E143F1230127812FCA2143E48137E0060137C003813F8381E03F0380FFF
C00001130018227DA01E>I<14E01301A213031307A2130D131D13391331136113E113C1
EA01811203EA07011206120C121C12181230127012E0B6FCA2380001E0A6EB03F0EB3FFF
A218227DA11E>I E /Fl 133[37 42 42 60 42 46 28 32 37 1[46
42 46 69 23 46 1[23 46 42 28 37 46 37 46 42 11[60 55
46 60 1[51 65 60 78 1[65 1[32 65 2[55 60 60 1[60 18[21
28 21 41[46 2[{TeXBase1Encoding ReEncodeFont}43 83.333336
/Times-Bold rf /Fm 131[50 1[50 50 50 50 50 50 50 50 50
50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 3[50
50 50 3[50 50 50 50 50 50 1[50 50 50 1[50 2[50 50 1[50
50 50 50 50 50 1[50 50 50 50 1[50 1[50 2[50 1[50 50 1[50
50 50 50 50 50 50 50 50 1[50 50 50 2[50 33[{
TeXBase1Encoding ReEncodeFont}70 83.333336 /Courier rf
/Fn 4 53 df<13381378EA01F8121F12FE12E01200B3AB487EB512F8A215267BA521>49
D<13FF000313E0380E03F0381800F848137C48137E00787F12FC6CEB1F80A4127CC7FC15
005C143E147E147C5C495A495A5C495A010EC7FC5B5B903870018013E0EA018039030003
0012065A001FB5FC5A485BB5FCA219267DA521>I<13FF000313E0380F01F8381C007C00
30137E003C133E007E133FA4123CC7123E147E147C5C495AEB07E03801FF8091C7FC3800
01E06D7E147C80143F801580A21238127C12FEA21500485B0078133E00705B6C5B381F01
F03807FFC0C690C7FC19277DA521>I<1438A2147814F81301A2130313071306130C131C
131813301370136013C012011380EA03005A120E120C121C5A12305A12E0B612E0A2C7EA
F800A7497E90383FFFE0A21B277EA621>I E /Fo 134[29 1[44
29 1[18 26 26 1[33 33 33 1[18 2[18 33 33 18 29 33 29
33 33 12[37 10[22 2[41 1[48 12[33 8[17 22 17 41[33 2[{
TeXBase1Encoding ReEncodeFont}28 66.666664 /Times-Italic
rf /Fp 104[66 2[29 29 25[33 33 48 33 33 18 26 22 33 33
33 33 52 18 33 1[18 33 33 22 29 33 29 33 29 3[22 1[22
2[48 63 1[48 41 37 44 1[37 48 48 59 41 1[26 22 48 1[37
41 48 44 44 48 6[18 33 33 33 33 1[33 33 1[33 33 1[17
22 17 40[37 37 2[{TeXBase1Encoding ReEncodeFont}63 66.666664
/Times-Roman rf /Fq 1 4 df<136013701360A20040132000E0137038F861F0387E67
E0381FFF803807FE00EA00F0EA07FE381FFF80387E67E038F861F038E060700040132000
001300A21370136014157B9620>3 D E /Fr 134[37 1[55 37 42
23 32 32 1[42 42 42 60 23 37 1[23 42 42 23 37 42 37 42
42 8[51 69 1[60 46 42 51 1[51 60 55 69 46 2[28 60 60
51 51 1[55 1[51 6[28 42 1[42 3[42 1[42 1[23 21 28 5[28
39[{TeXBase1Encoding ReEncodeFont}49 83.333336 /Times-Italic
rf /Fs 104[83 42 1[37 37 24[37 42 42 60 42 42 23 32 28
42 42 42 42 65 23 42 23 23 42 42 28 37 42 37 42 37 3[28
1[28 51 60 60 78 60 60 51 46 55 60 46 60 60 74 51 60
32 28 60 60 46 51 60 55 55 60 5[23 23 42 42 42 42 42
42 42 42 42 42 23 21 28 21 47 1[28 28 28 1[69 3[28 29[46
46 2[{TeXBase1Encoding ReEncodeFont}82 83.333336 /Times-Roman
rf /Ft 134[60 60 86 1[66 40 47 53 1[66 60 66 100 33 66
1[33 66 60 40 53 66 53 66 60 12[80 66 86 8[47 2[73 80
3[86 6[40 1[60 60 60 60 60 60 60 60 3[40 30 41[66 2[{
TeXBase1Encoding ReEncodeFont}41 119.999947 /Times-Bold
rf /Fu 2 121 df<130C131EA50060EB01800078130739FC0C0FC0007FEB3F80393F8C7F
003807CCF83801FFE038007F80011EC7FCEB7F803801FFE03807CCF8383F8C7F397F0C3F
8000FCEB0FC039781E078000601301000090C7FCA5130C1A1D7C9E23>3
D<EA01F8EA07FEEA1F07383E0380383C01C0387800E01301EAF003A3EB01C090C7FCA27E
1278127C123C7E7EEA03C013F0EA0FFCEA1E1E383C0780007C13C0EA7803EB01E012F0EB
00F0A51278EB01E0123CEA3E03001E13C0380787803803FF00EA00FC133C130FEB0780EB
03C014E0130114F01300A21238127CA3387801E01270383803C0EA1C07380E0F803807FE
00EA01F8143D7BAE1F>120 D E /Fv 134[50 50 72 50 50 28
39 33 1[50 50 50 1[28 50 1[28 50 50 1[44 50 44 50 44
10[72 3[66 1[55 1[72 1[61 1[39 2[72 3[66 66 72 92 6[50
50 50 2[50 1[50 50 50 1[25 33 25 44[{TeXBase1Encoding ReEncodeFont}42
100.000000 /Times-Roman rf /Fw 134[72 1[104 1[72 40 56
48 2[72 72 112 40 72 1[40 1[72 48 64 72 64 1[64 12[88
80 96 3[104 4[48 4[104 1[96 104 6[40 12[48 45[{
TeXBase1Encoding ReEncodeFont}28 144.000000 /Times-Roman
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin

%%EndSetup
%%Page: 1 1
1 0 bop 180 161 a Fw(Bro:)43 b(A)36 b(System)e(for)h(Detecting)f(Netw)o
(ork)f(Intruders)h(in)i(Real-T)-5 b(ime)1700 402 y Fv(V)-11
b(ern)25 b(P)o(axson)1441 518 y(Netw)o(ork)g(Research)h(Group)1146
634 y(La)o(wrence)f(Berk)o(ele)o(y)g(National)f(Laboratory)2755
598 y Fu(\003)1544 751 y Fv(Berk)o(ele)o(y)-6 b(,)24
b(CA)h(94720)1621 867 y(v)o(ern@ee.lbl.go)o(v)1679 1061
y(LBNL-41197)1437 1221 y(Re)n(vised)f(January)h(14,)f(1998)-150
1533 y Ft(Abstract)-150 1722 y Fs(W)-7 b(e)36 b(describe)f(Bro,)k(a)c
(stand-alone)f(system)h(for)g(detecting)f(net-)-150 1822
y(w)o(ork)c(intruders)f(in)i(real-time)e(by)h(passi)n(v)o(ely)g
(monitoring)e(a)j(net-)-150 1921 y(w)o(ork)23 b(link)g(o)o(v)o(er)g
(which)g(the)g(intruder')-5 b(s)23 b(traf)n(\002c)g(transits.)36
b(W)-7 b(e)24 b(gi)n(v)o(e)-150 2021 y(an)c(o)o(v)o(ervie)n(w)e(of)h
(the)h(system')-5 b(s)20 b(design,)f(which)h(emphasizes)f(high-)-150
2120 y(speed)30 b(\(FDDI-rate\))f(monitoring,)i(real-time)f
(noti\002cation,)i(clear)-150 2220 y(separation)18 b(between)g
(mechanism)g(and)h(polic)o(y)-5 b(,)18 b(and)g(e)o(xtensibility)-5
b(.)-150 2320 y(T)e(o)21 b(achie)n(v)o(e)f(these)h(ends,)g(Bro)g(is)h
(di)n(vided)d(into)i(an)g(\223e)n(v)o(ent)f(engine\224)-150
2419 y(that)e(reduces)f(a)h(k)o(ernel-\002ltered)e(netw)o(ork)g(traf)n
(\002c)i(stream)f(into)h(a)g(se-)-150 2519 y(ries)27
b(of)f(higher)n(-le)n(v)o(el)f(e)n(v)o(ents,)i(and)f(a)h(\223polic)o(y)
f(script)g(interpreter\224)-150 2619 y(that)33 b(interprets)g(e)n(v)o
(ent)f(handlers)g(written)h(in)h(a)f(specialized)g(lan-)-150
2718 y(guage)17 b(used)g(to)h(e)o(xpress)g(a)g(site')-5
b(s)19 b(security)e(polic)o(y)-5 b(.)23 b(Ev)o(ent)17
b(handlers)-150 2818 y(can)24 b(update)f(state)i(information,)e
(synthesize)h(ne)n(w)g(e)n(v)o(ents,)g(record)-150 2917
y(information)e(to)i(disk,)g(and)g(generate)e(real-time)i
(noti\002cations)f(via)-150 3017 y Fr(syslo)o(g)p Fs(.)62
b(W)-7 b(e)34 b(also)f(discuss)g(a)g(number)d(of)j(attacks)f(that)h
(attempt)-150 3117 y(to)25 b(sub)o(v)o(ert)f(passi)n(v)o(e)h
(monitoring)e(systems)j(and)f(defenses)f(against)-150
3216 y(these,)f(and)f(gi)n(v)o(e)g(particulars)g(of)h(ho)n(w)f(Bro)h
(analyzes)f(the)g(four)g(ap-)-150 3316 y(plications)i(inte)o(grated)e
(into)i(it)h(so)f(f)o(ar:)33 b(Finger)m(,)24 b(FTP)-9
b(,)25 b(Portmapper)-150 3416 y(and)e(T)-6 b(elnet.)36
b(The)24 b(system)g(is)h(publicly)e(a)n(v)n(ailable)g(in)h(source)f
(code)-150 3515 y(form.)-150 3806 y Ft(1)119 b(Intr)n(oduction)-150
3995 y Fs(W)m(ith)31 b(gro)n(wing)f(Internet)g(connecti)n(vity)f(comes)
i(gro)n(wing)e(oppor)n(-)-150 4095 y(tunities)j(for)e(attack)o(ers)i
(to)f(illicitly)h(access)h(computers)c(o)o(v)o(er)i(the)-150
4194 y(netw)o(ork.)51 b(The)29 b(problem)e(of)i(detecting)f(such)h
(attacks)g(is)h(termed)-150 4294 y Fr(network)19 b(intrusion)f
(detection)p Fs(,)g(a)h(relati)n(v)o(ely)f(ne)n(w)g(area)h(of)f
(security)-150 4394 y(research)29 b([MHL94)n(].)53 b(W)-7
b(e)31 b(can)e(di)n(vide)g(these)h(systems)g(into)f(tw)o(o)-150
4493 y(types,)h(those)f(that)g(rely)f(on)g(audit)g(information)f
(gathered)f(by)j(the)-150 4593 y(hosts)19 b(in)h(the)f(netw)o(ork)e
(the)o(y)i(are)g(trying)f(to)h(protect,)f(and)h(those)f(that)-150
4692 y(operate)24 b(\223stand-alone\224)f(by)h(observing)f(netw)o(ork)h
(traf)n(\002c)h(directly)-5 b(,)p -150 4771 801 4 v -66
4824 a Fq(\003)-30 4848 y Fp(This)21 b(w)o(ork)g(w)o(as)h(supported)h
(by)e(the)h(Director)m(,)i(Of)n(\002ce)e(of)f(Ener)o(gy)h(Research,)
-150 4927 y(Of)n(\002ce)15 b(of)g(Computational)j(and)d(T)-5
b(echnology)17 b(Research,)f(Mathematical,)j(Informa-)-150
5006 y(tion,)e(and)f(Computational)k(Sciences)e(Di)n(vision)g(of)e(the)
h(United)g(States)g(Department)-150 5085 y(of)23 b(Ener)o(gy)g(under)h
(Contract)h(No.)e(DE-A)m(C03-76SF00098.)40 b(This)23
b(paper)h(appears)-150 5163 y(in)c(the)g(Proceedings)h(of)e(the)h(7th)g
(USENIX)e(Security)k(Symposium,)d(San)h(Antonio,)-150
5242 y(TX,)d(January)j(1998.)26 b Fo(This)18 b(r)n(e)o(vision)i(of)f
(the)g(paper)g(corr)n(ects)g(an)g(err)m(or)f(in)h(the)g(orig-)-150
5321 y(inal)g(ver)o(sion,)g(whic)o(h)g(in)f Fu(x)g Fo(7)g(o)o(ver)o
(stated)j(the)d(tr)o(af)o(\002c)h(le)o(vel)h(on)e(the)g(FDDI)f(ring)i
(by)f(a)-150 5400 y(factor)g(of)g(two.)2049 1533 y Fs(and)g(passi)n(v)o
(ely)-5 b(,)18 b(using)h(a)g(pack)o(et)g(\002lter)-5
b(.)25 b(In)19 b(this)g(paper)f(we)i(focus)e(on)2049
1632 y(the)k(problem)f(of)h(b)n(uilding)f(stand-alone)f(systems,)j
(which)f(we)h(will)2049 1732 y(term)18 b(\223monitors.)-6
b(\224)23 b(Though)17 b(monitors)g(necessarily)h(f)o(ace)g(the)h(dif)n
(\002-)2049 1832 y(culties)g(of)f(more)f(limited)i(information)d(than)i
(systems)g(with)h(access)2049 1931 y(to)j(audit)f(trails,)i(monitors)e
(also)h(gain)f(the)h(major)f(bene\002t)g(that)h(the)o(y)2049
2031 y(can)g(be)g(added)f(to)i(a)f(netw)o(ork)f(without)h(requiring)e
(an)o(y)h(changes)g(to)2049 2131 y(the)f(hosts.)25 b(F)o(or)19
b(our)g(purposes\227monitoring)c(a)20 b(collection)e(of)i(se)n(v-)2049
2230 y(eral)c(thousand)d(heterogeneous,)h(di)n(v)o(ersely-administered)
d(hosts\227)2049 2330 y(this)21 b(adv)n(antage)d(is)j(immense.)2132
2431 y(Our)34 b(monitoring)e(system)j(is)h(called)e(Bro)h(\(an)f
(Orwellian)g(re-)2049 2530 y(minder)f(that)h(monitoring)e(comes)i(hand)
f(in)i(hand)e(with)h(the)g(po-)2049 2630 y(tential)48
b(for)f(pri)n(v)n(ac)o(y)e(violations\).)106 b(A)48 b(number)e(of)h
(commer)n(-)2049 2730 y(cial)35 b(products)d(e)o(xist)j(that)f(do)g
(what)g(Bro)g(does,)k(generally)32 b(with)2049 2829 y(much)f(more)g
(sophisticated)g(interf)o(aces)g(and)g(management)f(soft-)2049
2929 y(w)o(are)24 b([In97)n(,)h(T)-7 b(o97)n(,)25 b(Wh97)o(],)2926
2899 y Fn(1)2988 2929 y Fs(and)f(lar)o(ger)f(\223attack)h
(signature\224)f(li-)2049 3028 y(braries.)51 b(T)-7 b(o)29
b(our)f(kno)n(wledge,)h(ho)n(we)n(v)o(er)m(,)g(there)g(are)g(no)f
(detailed)2049 3128 y(accounts)c(in)h(the)h(netw)o(ork)d(security)i
(literature)f(of)h(ho)n(w)g(monitors)2049 3228 y(can)f(be)h(b)n(uilt.)
38 b(Furthermore,)23 b(monitors)g(can)i(be)f(susceptible)g(to)h(a)2049
3327 y(number)j(of)h(attacks)h(aimed)f(at)h(sub)o(v)o(erting)d(the)j
(monitoring;)i(we)2049 3427 y(belie)n(v)o(e)19 b(the)i(attacks)f(we)h
(discuss)f(here)g(ha)n(v)o(e)g(not)g(been)g(pre)n(viously)2049
3527 y(described)g(in)i(the)g(literature.)29 b(Thus,)21
b(the)h(contrib)n(ution)d(of)j(this)g(pa-)2049 3626 y(per)h(is)i(not)e
(at)h(heart)f(a)h(no)o(v)o(el)e(idea)h(\(though)f(we)i(belie)n(v)o(ed)e
(it)i(no)o(v)o(el)2049 3726 y(when)30 b(we)h(undertook)c(the)k
(project,)h(in)e(1995\),)h(b)n(ut)g(rather)e(a)i(de-)2049
3825 y(tailed)i(o)o(v)o(ervie)n(w)d(of)i(some)h(e)o(xperiences)e(with)h
(b)n(uilding)g(such)g(a)2049 3925 y(system.)2132 4026
y(Prior)16 b(to)g(de)n(v)o(eloping)e(Bro,)j(we)f(had)g(signi\002cant)g
(operational)e(e)o(x-)2049 4125 y(perience)20 b(with)i(a)g(simpler)g
(system)f(based)h(on)f(of)n(f-line)f(analysis)i(of)2049
4225 y Fm(tcpdump)g Fs(trace)h(\002les.)34 b(Out)23 b(of)g(this)h(e)o
(xperience)c(we)k(formulated)2049 4325 y(a)d(number)d(of)i(design)f
(goals)h(and)g(requirements:)2049 4512 y Fl(High-speed,)g(lar)o(ge)g(v)
o(olume)g(monitoring)40 b Fs(F)o(or)69 b(our)f(en)m(viron-)2215
4612 y(ment,)20 b(we)h(vie)n(w)f(the)h(greatest)f(source)g(of)g
(threats)h(as)g(e)o(xternal)2215 4711 y(hosts)28 b(connecting)d(to)j
(our)f(hosts)g(o)o(v)o(er)f(the)i(Internet.)46 b(Since)2215
4811 y(the)28 b(netw)o(ork)f(we)i(w)o(ant)f(to)g(protect)g(has)g(a)h
(single)f(link)f(con-)2215 4911 y(necting)e(it)i(to)g(the)f(remainder)f
(of)h(the)g(Internet)f(\(a)h(\223DMZ\224\),)2215 5010
y(we)42 b(can)f(economically)f(monitor)g(our)h(greatest)g(potential)p
2049 5086 V 2134 5140 a Fk(1)2169 5163 y Fp(Or)18 b(at)h(least)h
(appear)m(,)h(according)g(to)e(their)h(product)g(literature,)i(to)d(do)
g(the)h(same)2049 5242 y(things\227we)f(do)e(not)g(ha)o(v)o(e)h(direct)
h(e)o(xperience)h(with)e(an)o(y)f(of)g(these)h(products.)2115
5321 y(A)h(some)n(what)i(dif)n(ferent)h(sort)d(of)g(product,)i(the)f
(\223Netw)o(ork)h(Flight)g(Recorder)m(,)-5 b(\224)23
b(is)2049 5400 y(described)c(in)e([RLSSL)-5 b(W97,)16
b(Ne97)q(].)1929 5649 y Fs(1)p eop
%%Page: 2 2
2 1 bop 16 -104 a Fs(source)23 b(of)g(attacks)g(by)g(passi)n(v)o(ely)f
(w)o(atching)h(the)g(DMZ)g(link.)16 -5 y(Ho)n(we)n(v)o(er)m(,)f(the)i
(link)f(is)h(an)g(FDDI)g(ring,)f(so)h(to)g(monitor)e(it)i(re-)16
95 y(quires)g(a)h(system)g(that)f(can)h(capture)e(traf)n(\002c)h(at)h
(speeds)g(of)f(up)16 194 y(to)c(100)g(Mbps.)25 b(In)20
b(addition,)e(the)j(v)n(olume)e(of)h(traf)n(\002c)g(o)o(v)o(er)f(the)16
294 y(link)h(is)h(f)o(airly)f(hefty)-5 b(,)19 b(about)g(20)h(GB/day)-5
b(.)-150 466 y Fl(No)20 b(pack)o(et)g(\002lter)h(dr)o(ops)41
b Fs(If)25 b(an)h(application)e(using)h(a)h(pack)o(et)f(\002l-)16
565 y(ter)33 b(cannot)e(consume)g(pack)o(ets)h(as)h(quickly)e(as)i(the)
o(y)f(arri)n(v)o(e)16 665 y(on)26 b(the)g(monitored)e(link,)j(then)e
(the)h(\002lter)h(b)n(uf)n(fers)e(the)h(pack-)16 765
y(ets)f(for)g(later)f(consumption.)36 b(Ho)n(we)n(v)o(er)m(,)24
b(e)n(v)o(entually)e(the)j(\002l-)16 864 y(ter)30 b(will)g(run)e(out)h
(of)h(b)n(uf)n(fer)m(,)f(at)h(which)f(point)g(it)h Fr(dr)l(ops)f
Fs(an)o(y)16 964 y(further)i(pack)o(ets)g(that)h(arri)n(v)o(e.)60
b(From)31 b(a)i(security)e(monitor)n(-)16 1063 y(ing)25
b(perspecti)n(v)o(e,)h(drops)e(can)i(completely)e(defeat)h(the)h(mon-)
16 1163 y(itoring,)41 b(since)c(the)h(missing)g(pack)o(ets)f(might)g
(contain)f(e)o(x-)16 1263 y(actly)24 b(the)g(interesting)f(traf)n
(\002c)h(that)g(identi\002es)g(a)g(netw)o(ork)f(in-)16
1362 y(truder)-5 b(.)27 b(Gi)n(v)o(en)21 b(our)f(\002rst)i(design)f
(requirement\227high-speed)16 1462 y(monitoring\227then)c(a)n(v)n
(oiding)i(pack)o(et)h(\002lter)h(drops)f(becomes)16 1562
y(another)f(strong)g(requirement.)16 1697 y(It)25 b(is)h(sometimes)f
(tempting)f(to)h(dismiss)g(a)h(problem)d(such)i(as)16
1797 y(pack)o(et)h(\002lter)h(drops)e(with)i(an)f(ar)o(gument)e(that)i
(it)h(is)h(unlik)o(ely)16 1896 y(a)e(traf)n(\002c)g(spik)o(e)f(will)i
(occur)d(at)i(the)g(same)g(time)g(as)g(an)g(attack)16
1996 y(happens)j(to)h(be)g(underw)o(ay)-5 b(.)52 b(This)31
b(ar)o(gument,)f(ho)n(we)n(v)o(er)m(,)g(is)16 2096 y(completely)e
(undermined)f(if)j(we)h(assume)e(that)h(an)g(attack)o(er)16
2195 y(might,)35 b(in)e(parallel)f(with)h(a)h(break-in)d(attempt,)k
Fr(attac)n(k)e(the)16 2295 y(monitor)20 b(itself)33 b
Fs(\(see)20 b(belo)n(w\).)-150 2467 y Fl(Real-time)g(noti\002cation)39
b Fs(One)50 b(of)f(our)g(main)g(dissatisf)o(actions)16
2566 y(with)31 b(our)e(initial)i(of)n(f-line)e(system)h(w)o(as)h(the)g
(lengthy)d(delay)16 2666 y(incurred)33 b(before)h(detecting)g(an)h
(attack.)69 b(If)35 b(an)g(attack,)j(or)16 2765 y(an)25
b(attempted)f(attack,)h(is)h(detected)e(quickly)-5 b(,)24
b(then)g(it)i(can)f(be)16 2865 y(much)c(easier)h(to)g(trace)g(back)f
(the)h(attack)o(er)f(\(for)g(e)o(xample,)g(by)16 2965
y(telephoning)d(the)i(site)h(from)d(which)i(the)o(y)f(are)h(coming\),)e
(min-)16 3064 y(imize)35 b(damage,)i(pre)n(v)o(ent)c(further)g
(break-ins,)k(and)d(initiate)16 3164 y(full)28 b(recording)d(of)j(all)h
(of)e(the)h(attack)o(er')-5 b(s)28 b(netw)o(ork)f(acti)n(vity)-5
b(.)16 3264 y(Therefore,)24 b(one)h(of)g(our)f(requirements)g(for)g
(Bro)h(w)o(as)i(that)e(it)16 3363 y(detect)i(attacks)g(in)g(real-time.)
44 b(This)27 b(is)g(not)g(to)g(discount)f(the)16 3463
y(enormous)e(utility)i(of)f(k)o(eeping)f(e)o(xtensi)n(v)o(e,)i
(permanent)e(logs)16 3562 y(of)g(netw)o(ork)e(acti)n(vity)i(for)f
(later)h(analysis.)36 b(In)m(v)n(ariably)-5 b(,)21 b(when)16
3662 y(we)28 b(ha)n(v)o(e)e(suf)n(fered)g(a)h(break-in,)g(we)h(turn)e
(to)i(these)f(logs)g(for)16 3762 y(retrospecti)n(v)o(e)20
b(damage)g(assessment,)i(sometimes)f(searching)16 3861
y(back)f(a)g(number)f(of)g(months.)-150 4033 y Fl(Mechanism)i(separate)
f(fr)o(om)f(policy)41 b Fs(Sound)h(softw)o(are)g(design)16
4133 y(often)29 b(stresses)j(constructing)c(a)i(clear)g(separation)f
(between)16 4232 y(mechanism)g(and)i(polic)o(y;)k(done)29
b(properly)-5 b(,)31 b(this)g(b)n(uys)f(both)16 4332
y(simplicity)f(and)g(\003e)o(xibility)-5 b(.)53 b(The)29
b(problems)f(f)o(aced)h(by)g(our)16 4431 y(system)19
b(particularly)d(bene\002t)i(from)g(separating)f(the)h(tw)o(o:)25
b(be-)16 4531 y(cause)32 b(we)f(ha)n(v)o(e)g(a)h(f)o(airly)f(high)g(v)n
(olume)g(of)g(traf)n(\002c)g(to)h(deal)16 4631 y(with,)i(we)d(need)f
(to)h(be)g(able)f(to)h(easily)h(trade-of)n(f)c(at)k(dif)n(fer)n(-)16
4730 y(ent)19 b(times)g(ho)n(w)g(we)g(\002lter)m(,)g(inspect)g(and)f
(respond)f(to)i(dif)n(ferent)16 4830 y(types)d(of)h(traf)n(\002c.)23
b(If)16 b(we)h(hardwired)e(these)h(responses)g(into)h(the)16
4930 y(system,)j(then)g(these)g(changes)g(w)o(ould)f(be)h(cumbersome)e
(\(and)16 5029 y(error)n(-prone\))f(to)j(mak)o(e.)-150
5201 y Fl(Extensible)42 b Fs(Because)27 b(there)h(are)f(an)h(enormous)e
(number)g(of)h(dif-)16 5300 y(ferent)39 b(netw)o(ork)g(attacks,)45
b(with)40 b(who)g(kno)n(ws)f(ho)n(w)h(man)o(y)16 5400
y(w)o(aiting)32 b(to)h(be)g(disco)o(v)o(ered,)g(the)f(system)h(clearly)
f(must)h(be)2215 -104 y(designed)17 b(in)h(order)f(to)h(mak)o(e)g(it)h
(easy)f(to)g(add)g(to)g(it)h(kno)n(wledge)2215 -5 y(of)25
b(ne)n(w)g(types)f(of)h(attacks.)40 b(In)24 b(addition,)h(while)g(our)f
(system)2215 95 y(is)e(a)f(research)f(project,)g(it)i(is)g(at)g(the)f
(same)g(time)g(a)g(production)2215 194 y(system)30 b(that)h(plays)f(a)g
(signi\002cant)g(role)f(in)i(our)e(daily)h(secu-)2215
294 y(rity)h(operations.)56 b(Consequently)-5 b(,)31
b(we)g(need)f(to)i(be)f(able)f(to)2215 394 y(upgrade)18
b(it)j(in)f(small,)h(easily)f(deb)n(ugged)e(increments.)2049
569 y Fl(A)-8 b(v)o(oid)20 b(simple)h(mistak)o(es)42
b Fs(Of)19 b(course,)g(we)g(al)o(w)o(ays)h(w)o(ant)f(to)h(a)n(v)n(oid)
2215 669 y(mistak)o(es.)36 b(Ho)n(we)n(v)o(er)m(,)23
b(here)g(we)i(mean)e(that)h(we)g(particularly)2215 769
y(desire)k(that)g(the)g(w)o(ay)g(that)g(a)h(site)g(de\002nes)f(its)h
(security)e(pol-)2215 868 y(ic)o(y)22 b(be)g(both)f(clear)h(and)f(as)i
(error)n(-free)c(as)k(possible.)30 b(\(F)o(or)21 b(e)o(x-)2215
968 y(ample,)j(we)g(w)o(ould)f(not)g(consider)f(e)o(xpressing)g(the)i
(polic)o(y)e(in)2215 1068 y(C)f(code)f(as)h(meeting)e(these)h(goals.\))
2049 1243 y Fl(The)h(monitor)f(will)h(be)g(attack)o(ed)40
b Fs(W)-7 b(e)18 b(must)f(assume)h(that)f(attack-)2215
1343 y(ers)30 b(will)h(\(e)n(v)o(entually\))c(ha)n(v)o(e)i(full)h(kno)n
(wledge)e(of)h(the)h(tech-)2215 1443 y(niques)j(used)g(by)g(the)h
(monitor)m(,)g(and)f(access)h(to)g(its)g(source)2215
1542 y(code,)29 b(and)f(will)h(use)g(this)g(kno)n(wledge)d(in)i
(attempts)h(to)f(sub-)2215 1642 y(v)o(ert)c(or)h(o)o(v)o(erwhelm)d(the)
j(monitor)e(so)i(that)g(it)g(f)o(ails)h(to)f(detect)2215
1742 y(the)18 b(attack)o(er')-5 b(s)17 b(break-in)f(acti)n(vity)-5
b(.)23 b(This)18 b(assumption)f(signi\002-)2215 1841
y(cantly)f(complicates)g(the)h(design)f(of)h(the)g(monitor;)f(b)n(ut)h
(f)o(ailing)2215 1941 y(to)j(address)g(it)h(is)g(to)g(b)n(uild)e(a)i
(house)e(of)h(cards.)2215 2079 y(W)-7 b(e)22 b(do,)f(ho)n(we)n(v)o(er)m
(,)e(allo)n(w)i(one)g(further)f(assumption,)g(namely)2215
2178 y(that)34 b Fr(the)f(monitor)h(will)g(only)f(be)h(attac)n(k)o(ed)f
(fr)l(om)h(one)f(end)p Fs(.)2215 2278 y(That)c(is,)k(gi)n(v)o(en)28
b(a)i(netw)o(ork)f(connection)e(between)i(hosts)h Fj(A)2215
2377 y Fs(and)21 b Fj(B)t Fs(,)h(we)g(assume)f(that)g(at)h(most)g(one)e
(of)h Fj(A)i Fs(or)e Fj(B)26 b Fs(has)21 b(been)2215
2477 y(compromised)k(and)i(might)g(try)h(to)g(attack)f(the)h(monitor)m
(,)g(b)n(ut)2215 2577 y(not)c(both.)37 b(This)25 b(assumption)e
(greatly)h(aids)g(in)h(dealing)e(with)2215 2676 y(the)29
b(problem)d(of)i(attacks)h(on)f(the)h(monitor)m(,)f(since)h(it)g(means)
2215 2776 y(that)g Fr(we)i(can)d(trust)j(one)d(of)i(the)f(endpoints)f
Fs(\(though)f(we)j(do)2215 2876 y(not)20 b(kno)n(w)f(which\).)2215
3013 y(In)26 b(addition,)g(we)g(note)f(that)i(this)f(second)f
(assumption)g(costs)2215 3113 y(us)17 b(virtually)e(nothing.)22
b(If,)17 b(indeed,)f(both)g Fj(A)h Fs(and)f Fj(B)21 b
Fs(ha)n(v)o(e)16 b(been)2215 3213 y(compromised,)28 b(then)g(the)h
(attack)o(er)g(can)f(establish)h(intricate)2215 3312
y(co)o(v)o(ert)19 b(channels)g(between)h(the)g(tw)o(o.)25
b(These)20 b(can)g(be)g(immea-)2215 3412 y(surably)27
b(hard)g(to)i(detect,)h(depending)25 b(on)j(ho)n(w)g(de)n(vious)f(the)
2215 3511 y(channel)18 b(is;)i(that)f(our)e(system)i(f)o(ails)h(to)f
(do)f(so)h(only)f(means)g(we)2215 3611 y(gi)n(v)o(e)h(up)h(on)g
(something)f(e)o(xtremely)f(dif)n(\002cult)i(an)o(yw)o(ay)-5
b(.)2132 3804 y(A)28 b(\002nal)g(important)f(point)g(concerns)f(the)i
(broader)e(conte)o(xt)g(for)2049 3903 y(our)20 b(monitoring)e(system.)
27 b(Our)21 b(site)g(is)h(engaged)c(in)j(basic,)g(unclas-)2049
4003 y(si\002ed)k(research.)37 b(The)24 b(consequences)f(of)h(a)h
(break-in)e(are)h(usually)2049 4102 y(limited)31 b(to)g(\(potentially)f
(signi\002cant\))g(e)o(xpenditure)e(in)k(lost)f(time)2049
4202 y(and)d(re-securing)e(the)j(compromised)d(machines,)j(and)f
(perhaps)f(a)2049 4302 y(tarnished)20 b(public)g(image)h(depending)d
(on)j(the)g(subsequent)f(actions)2049 4401 y(of)g(the)g(attack)o(ers.)
25 b(Thus,)20 b(while)g(we)h(v)o(ery)e(much)h(aim)g(to)g(minimize)2049
4501 y(break-in)d(acti)n(vity)-5 b(,)19 b(we)g(do)g(not)f(try)h(to)h
(achie)n(v)o(e)e(\223airtight\224)g(security)-5 b(.)2049
4601 y(W)e(e)18 b(instead)f(emphasize)f(monitoring)f(o)o(v)o(er)h
(blocking)f(when)i(possi-)2049 4700 y(ble.)31 b(Ob)o(viously)-5
b(,)20 b(other)h(sites)j(may)d(ha)n(v)o(e)h(quite)g(dif)n(ferent)e
(security)2049 4800 y(priorities,)f(which)h(we)h(do)e(not)h(claim)g(to)
h(address.)2132 4902 y(In)i(the)h(remainder)e(of)h(this)h(paper)f(we)h
(discuss)g(ho)n(w)f(the)g(design)2049 5001 y(of)d(Bro)h(attempts)f(to)h
(meet)f(these)h(goals)f(and)g(constraints.)25 b(First,)c(in)2049
5101 y Fi(x)d Fs(2)g(we)g(gi)n(v)o(e)e(an)i(o)o(v)o(ervie)n(w)d(of)j
(the)f(structure)g(of)g(the)h(whole)f(system.)2049 5201
y Fi(x)23 b Fs(3)f(presents)g(the)h(specialized)f Fm(Bro)g
Fs(language)f(used)h(to)g(e)o(xpress)g(a)2049 5300 y(site')-5
b(s)21 b(security)e(polic)o(y)-5 b(.)23 b(W)-7 b(e)20
b(turn)f(in)h Fi(x)g Fs(4)f(to)h(the)g(details)f(of)h(ho)n(w)f(the)2049
5400 y(system)d(is)i(currently)c(implemented.)22 b Fi(x)16
b Fs(5)h(discusses)f(attacks)h(on)f(the)1929 5649 y(2)p
eop
%%Page: 3 3
3 2 bop 175 -187 a
 10656645 18968821 0 0 33285570 59269365 startTexFig
 175 -187 a
%%BeginDocument: structure.eps
%Magnification: 1.00
/$F2psDict 200 dict def
$F2psDict begin
$F2psDict /mtrx matrix put
/col-1 {0 setgray} bind def
/col0 {0.000 0.000 0.000 srgb} bind def
/col1 {0.000 0.000 1.000 srgb} bind def
/col2 {0.000 1.000 0.000 srgb} bind def
/col3 {0.000 1.000 1.000 srgb} bind def
/col4 {1.000 0.000 0.000 srgb} bind def
/col5 {1.000 0.000 1.000 srgb} bind def
/col6 {1.000 1.000 0.000 srgb} bind def
/col7 {1.000 1.000 1.000 srgb} bind def
/col8 {0.000 0.000 0.560 srgb} bind def
/col9 {0.000 0.000 0.690 srgb} bind def
/col10 {0.000 0.000 0.820 srgb} bind def
/col11 {0.530 0.810 1.000 srgb} bind def
/col12 {0.000 0.560 0.000 srgb} bind def
/col13 {0.000 0.690 0.000 srgb} bind def
/col14 {0.000 0.820 0.000 srgb} bind def
/col15 {0.000 0.560 0.560 srgb} bind def
/col16 {0.000 0.690 0.690 srgb} bind def
/col17 {0.000 0.820 0.820 srgb} bind def
/col18 {0.560 0.000 0.000 srgb} bind def
/col19 {0.690 0.000 0.000 srgb} bind def
/col20 {0.820 0.000 0.000 srgb} bind def
/col21 {0.560 0.000 0.560 srgb} bind def
/col22 {0.690 0.000 0.690 srgb} bind def
/col23 {0.820 0.000 0.820 srgb} bind def
/col24 {0.500 0.190 0.000 srgb} bind def
/col25 {0.630 0.250 0.000 srgb} bind def
/col26 {0.750 0.380 0.000 srgb} bind def
/col27 {1.000 0.500 0.500 srgb} bind def
/col28 {1.000 0.630 0.630 srgb} bind def
/col29 {1.000 0.750 0.750 srgb} bind def
/col30 {1.000 0.880 0.880 srgb} bind def
/col31 {1.000 0.840 0.000 srgb} bind def

end
save
-142.0 971.0 translate
1 -1 scale

/cp {closepath} bind def
/ef {eofill} bind def
/gr {grestore} bind def
/gs {gsave} bind def
/sa {save} bind def
/rs {restore} bind def
/l {lineto} bind def
/m {moveto} bind def
/rm {rmoveto} bind def
/n {newpath} bind def
/s {stroke} bind def
/sh {show} bind def
/slc {setlinecap} bind def
/slj {setlinejoin} bind def
/slw {setlinewidth} bind def
/srgb {setrgbcolor} bind def
/rot {rotate} bind def
/sc {scale} bind def
/sd {setdash} bind def
/ff {findfont} bind def
/sf {setfont} bind def
/scf {scalefont} bind def
/sw {stringwidth} bind def
/tr {translate} bind def
/tnt {dup dup currentrgbcolor
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add
  4 -2 roll dup 1 exch sub 3 -1 roll mul add srgb}
  bind def
/shd {dup dup currentrgbcolor 4 -2 roll mul 4 -2 roll mul
  4 -2 roll mul srgb} bind def
/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
/$F2psEnd {$F2psEnteredState restore end} def

$F2psBegin
10 setmiterlimit
n 0 79200 m 0 0 l 61200 0 l 61200 79200 l cp clip
 0.06000 0.06000 sc
7.500 slw
% Polyline
n 2385 5385 m 10785 5385 l 10785 3585 l 2385 3585 l cp gs col-1 s gr 
% Polyline
n 2385 8940 m 10785 8940 l 10785 7140 l 2385 7140 l cp gs col-1 s gr 
60.000 slw
% Polyline
gs  clippath
6435 13410 m 6585 12690 l 6735 13410 l 6735 12480 l 6435 12480 l  cp clip
n 6585 14355 m 6585 12555 l gs col7 0.95 shd ef gr gs col-1 s gr gr

% arrowhead
n 6435 13410 m 6585 12690 l 6735 13410 l 6585 13290 l 6435 13410 l  cp gs 0.00 setgray ef gr  col-1 s
7.500 slw
% Polyline
n 2385 12555 m 10785 12555 l 10785 10755 l 2385 10755 l cp gs col-1 s gr 
45.000 slw
% Polyline
gs  clippath
6465 9624 m 6585 9048 l 6705 9624 l 6705 8880 l 6465 8880 l  cp clip
n 6585 10740 m 6585 8940 l gs col7 0.95 shd ef gr gs col-1 s gr gr

% arrowhead
n 6465 9624 m 6585 9048 l 6705 9624 l 6585 9528 l 6465 9624 l  cp gs 0.00 setgray ef gr  col-1 s
30.000 slw
% Polyline
gs  clippath
6495 5898 m 6585 5466 l 6675 5898 l 6675 5340 l 6495 5340 l  cp clip
n 6585 7185 m 6585 5385 l gs col7 0.95 shd ef gr gs col-1 s gr gr

% arrowhead
n 6495 5898 m 6585 5466 l 6675 5898 l 6585 5826 l 6495 5898 l  cp gs 0.00 setgray ef gr  col-1 s
15.000 slw
% Polyline
gs  clippath
6540 1542 m 6600 1254 l 6660 1542 l 6660 1170 l 6540 1170 l  cp clip
n 6600 3600 m 6600 1200 l gs col7 0.95 shd ef gr gs col-1 s gr gr

% arrowhead
n 6540 1542 m 6600 1254 l 6660 1542 l 6600 1494 l 6540 1542 l  cp gs 0.00 setgray ef gr  col-1 s
% Polyline
 [100.0] 0 sd
gs  clippath
3060 10506 m 3000 10746 l 2940 10506 l 2940 10830 l 3060 10830 l  cp clip
n 3000 9000 m 3000 10800 l gs col7 0.95 shd ef gr gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 3060 10506 m 3000 10746 l 2940 10506 l 3000 10506 l 3060 10506 l  cp gs col7 1.00 shd ef gr  col-1 s
% Polyline
 [100.0] 0 sd
gs  clippath
3060 6906 m 3000 7146 l 2940 6906 l 2940 7230 l 3060 7230 l  cp clip
n 3000 5400 m 3000 7200 l gs col7 0.95 shd ef gr gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 3060 6906 m 3000 7146 l 2940 6906 l 3000 6906 l 3060 6906 l  cp gs col7 1.00 shd ef gr  col-1 s
% Polyline
 [100.0] 0 sd
gs  clippath
3060 3306 m 3000 3546 l 2940 3306 l 2940 3630 l 3060 3630 l  cp clip
n 3000 1200 m 3000 3600 l gs col7 0.95 shd ef gr gs col-1 s gr gr
 [] 0 sd
% arrowhead
n 3060 3306 m 3000 3546 l 2940 3306 l 3000 3306 l 3060 3306 l  cp gs col7 1.00 shd ef gr  col-1 s
7.500 slw
% Polyline
n 2385 14355 m 10785 14355 l 10785 16155 l 2385 16155 l cp gs col7 0.50 shd ef gr gs col-1 s gr 
/Helvetica-Bold ff 540.00 scf sf
5520 15442 m
gs 1 -1 sc (Network) col-1 sh gr
/Helvetica ff 360.00 scf sf
6885 6405 m
gs 1 -1 sc (Event stream) col-1 sh gr
/Helvetica ff 360.00 scf sf
6855 2835 m
gs 1 -1 sc (Record to disk) col-1 sh gr
/Helvetica ff 360.00 scf sf
6825 2265 m
gs 1 -1 sc (Real-time notification) col-1 sh gr
/Helvetica ff 360.00 scf sf
6885 9960 m
gs 1 -1 sc (Filtered packet stream) col-1 sh gr
/Times-Bold ff 540.00 scf sf
6615 8220 m
gs 1 -1 sc (Event Engine) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Helvetica ff 360.00 scf sf
3210 2505 m
gs 1 -1 sc (Policy script) col-1 sh gr
/Helvetica ff 360.00 scf sf
3210 6405 m
gs 1 -1 sc (Event control) col-1 sh gr
/Helvetica ff 360.00 scf sf
3210 10005 m
gs 1 -1 sc (Tcpdump filter) col-1 sh gr
/Helvetica ff 360.00 scf sf
6885 13575 m
gs 1 -1 sc (Packet stream) col-1 sh gr
/Times-Bold ff 540.00 scf sf
6615 4665 m
gs 1 -1 sc (Policy Script Interpreter) dup sw pop 2 div neg 0 rm  col-1 sh gr
/Courier-Bold ff 540.00 scf sf
6615 11835 m
gs 1 -1 sc (libpcap) dup sw pop 2 div neg 0 rm  col-1 sh gr
$F2psEnd
rs
%%EndDocument

 endTexFig
 220 2398 a Fs(Figure)19 b(1:)25 b(Structure)20 b(of)f(the)i(Bro)f
(system)-150 2675 y(monitoring)f(system.)27 b Fi(x)21
b Fs(6)g(looks)g(at)g(the)g(specialized)f(analysis)h(Bro)-150
2775 y(does)d(for)f(four)h(Internet)e(applications:)24
b(FTP)-9 b(,)18 b(Finger)m(,)f(Portmapper)m(,)-150 2874
y(and)g(T)-6 b(elnet.)24 b Fi(x)18 b Fs(7)g(gi)n(v)o(es)f(the)g(status)
i(of)e(the)h(implementation,)d(a)j(brief)-150 2974 y(assessment)25
b(of)e(its)j(performance,)21 b(its)26 b(a)n(v)n(ailability)-5
b(,)23 b(and)h(thoughts)-150 3074 y(on)17 b(future)f(directions.)23
b(Finally)-5 b(,)17 b(an)g(Appendix)e(illustrates)j(ho)n(w)f(the)-150
3173 y(dif)n(ferent)k(elements)h(of)g(the)g(system)h(come)e(together)g
(for)h(monitor)n(-)-150 3273 y(ing)e(Finger)f(traf)n(\002c.)-150
3580 y Ft(2)119 b(Structur)n(e)31 b(of)f(the)g(system)-150
3775 y Fs(Bro)e(is)g(conceptually)e(di)n(vided)g(into)h(an)h(\223e)n(v)
o(ent)f(engine\224)f(that)i(re-)-150 3874 y(duces)15
b(a)g(stream)h(of)f(\(\002ltered\))f(pack)o(ets)h(to)g(a)h(stream)f(of)
g(higher)n(-le)n(v)o(el)-150 3974 y(netw)o(ork)i(e)n(v)o(ents,)i(and)f
(an)g(interpreter)f(for)h(a)h(specialized)f(language)-150
4074 y(that)25 b(is)i(used)e(to)g(e)o(xpress)g(a)h(site')-5
b(s)26 b(security)f(polic)o(y)-5 b(.)39 b(More)25 b(gener)n(-)-150
4173 y(ally)-5 b(,)20 b(the)g(system)h(is)g(structured)e(in)i(layers,)f
(as)h(sho)n(wn)e(in)i(Figure)f(1.)-150 4273 y(The)26
b(lo)n(wer)n(-most)f(layers)h(process)g(the)h(greatest)f(v)n(olume)f
(of)h(data,)-150 4373 y(and)20 b(hence)f(must)i(limit)g(the)f(w)o(ork)g
(performed)d(to)k(a)g(minimum.)j(As)-150 4472 y(we)i(go)g(higher)e(up)h
(through)f(the)i(layers,)g(the)g(data)g(stream)g(dimin-)-150
4572 y(ishes,)g(allo)n(wing)d(for)g(more)h(processing)f(per)g(data)h
(item.)38 b(This)24 b(ba-)-150 4671 y(sic)h(design)f(re\003ects)h(the)g
(need)f(to)h(conserv)o(e)e(processing)g(as)j(much)-150
4771 y(as)i(possible,)h(in)f(order)e(to)i(meet)f(the)h(goals)f(of)h
(monitoring)d(high-)-150 4871 y(speed,)20 b(lar)o(ge)f(v)n(olume)g
(traf)n(\002c)h(\003o)n(ws)g(without)g(dropping)d(pack)o(ets.)-150
5135 y Fh(2.1)99 b Fg(libpcap)-150 5300 y Fs(From)18
b(the)h(perspecti)n(v)o(e)f(of)g(the)h(rest)h(of)f(the)g(system,)g
(just)g(abo)o(v)o(e)f(the)-150 5400 y(netw)o(ork)24 b(itself)i(is)g
Fm(libpcap)e Fs([MLJ94)n(],)j(the)e(pack)o(et-capture)d(li-)2049
-104 y(brary)j(used)h(by)g Fm(tcpdump)f Fs([JLM89)o(].)43
b(Using)26 b Fm(libpcap)f Fs(gains)2049 -5 y(signi\002cant)34
b(adv)n(antages:)51 b(it)35 b(isolates)g(Bro)f(from)f(details)i(of)f
(the)2049 95 y(netw)o(ork)k(link)g(technology)f(\(Ethernet,)42
b(FDDI,)d(SLIP)-9 b(,)39 b(etc.\);)48 b(it)2049 194 y(greatly)21
b(aids)h(in)g(porting)f(Bro)g(to)i(dif)n(ferent)d(Unix)h(v)n(ariants)g
(\(which)2049 294 y(also)28 b(mak)o(es)f(it)h(easier)f(to)h(upgrade)d
(to)j(f)o(aster)f(hardw)o(are)f(as)i(it)g(be-)2049 394
y(comes)23 b(a)n(v)n(ailable\);)h(and)e(it)i(means)f(that)g(Bro)h(can)e
(also)i(operate)e(on)2049 493 y Fm(tcpdump)d Fs(sa)n(v)o(e)h(\002les,)g
(making)e(of)n(f-line)g(de)n(v)o(elopment)f(and)i(anal-)2049
593 y(ysis)i(easy)-5 b(.)2132 693 y(Another)24 b(major)g(adv)n(antage)f
(of)h Fm(libpcap)h Fs(is)g(that)g(if)h(the)f(host)2049
792 y(operating)41 b(system)i(pro)o(vides)e(a)i(suf)n(\002ciently)e(po)
n(werful)g(k)o(ernel)2049 892 y(pack)o(et)32 b(\002lter)m(,)k(such)d
(as)h(BPF)g([MJ93)o(],)i(then)d Fm(libpcap)f Fs(do)n(wn-)2049
991 y(loads)18 b(the)f(\002lter)h(used)g(to)g(reduce)e(the)i(traf)n
(\002c)f(into)h(the)g(k)o(ernel.)23 b(Con-)2049 1091
y(sequently)-5 b(,)17 b(rather)g(than)h(ha)n(ving)g(to)g(haul)g(e)n(v)o
(ery)f(pack)o(et)h(up)g(to)h(user)n(-)2049 1191 y(le)n(v)o(el)30
b(merely)f(so)i(the)f(majority)f(can)h(be)g(discarded)f(\(if)h(the)g
(\002lter)2049 1290 y(accepts)e(only)g(a)h(small)f(proportion)e(of)i
(the)g(traf)n(\002c\),)i(the)e(rejected)2049 1390 y(pack)o(ets)d(can)f
(instead)h(be)g(discarded)e(in)i(the)g(k)o(ernel,)g(without)f(suf-)2049
1490 y(fering)i(a)i(conte)o(xt)e(switch)h(or)g(data)h(cop)o(ying.)44
b(W)m(inno)n(wing)26 b(do)n(wn)2049 1589 y(the)c(pack)o(et)g(stream)g
(as)h(soon)f(as)g(possible)g(greatly)g(abets)g(monitor)n(-)2049
1689 y(ing)e(at)h(high)e(speeds)h(without)f(losing)h(pack)o(ets.)2132
1788 y(The)26 b(k)o(e)o(y)g(to)h(pack)o(et)f(\002ltering)g(is,)j(of)d
(course,)h(judicious)e(selec-)2049 1888 y(tion)e(of)f(which)g(pack)o
(ets)h(to)g(k)o(eep)f(and)h(which)f(to)h(discard.)32
b(F)o(or)23 b(the)2049 1988 y(application)17 b(protocols)f(that)j(Bro)f
(kno)n(ws)f(about,)h(it)h(captures)e(e)n(v)o(ery)2049
2087 y(pack)o(et,)25 b(so)g(it)g(can)f(analyze)g(ho)n(w)g(the)g
(application)f(is)j(being)d(used.)2049 2187 y(In)d Fm(tcpdump)p
Fs(')-5 b(s)20 b(\002ltering)f(language,)g(this)h(looks)g(lik)o(e:)2208
2313 y Ff(tcp)40 b(port)f(finger)g(or)h(tcp)f(port)g(ftp)h(or)2208
2391 y(tcp)g(port)f(telnet)g(or)h(port)f(111)2049 2538
y Fs(That)25 b(is,)h(the)f(\002lter)g(accepts)g(an)o(y)f(TCP)i(pack)o
(ets)e(with)h(a)h(source)e(or)2049 2637 y(destination)18
b(port)h(of)h(79)f(\(Finger\),)f(21)h(\(FTP\),)g(or)g(23)h(\(T)-6
b(elnet\),)18 b(and)2049 2737 y(an)o(y)g(TCP)h(or)f(UDP)h(pack)o(ets)f
(with)h(a)g(source)f(or)g(destination)f(port)h(of)2049
2837 y(111)h(\(Portmapper\).)j(In)e(addition,)f(Bro)h(uses:)2208
2962 y Ff(tcp[13])39 b(&)h(7)g(!=)f(0)2049 3109 y Fs(to)19
b(capture)f(an)o(y)g(TCP)i(pack)o(ets)e(with)h(the)g(SYN,)g(FIN,)g(or)g
(RST)g(con-)2049 3208 y(trol)i(bits)g(set.)27 b(These)21
b(pack)o(ets)f(delimit)h(the)f(be)o(ginning)f(\(SYN\))h(and)2049
3308 y(end)f(\(FIN)g(or)h(RST\))g(of)f(each)g(TCP)i(connection.)h
(Because)e(TCP/IP)2049 3407 y(pack)o(et)i(headers)g(contain)f
(considerable)g(information)f(about)i(each)2049 3507
y(TCP)36 b(connection,)i(from)c(just)i(these)g(control)e(pack)o(ets)i
(one)f(can)2049 3607 y(e)o(xtract)30 b(connection)e(start)j(time,)j
(duration,)d(participating)e(hosts,)2049 3706 y(ports)17
b(\(and)f(hence,)g(generally)-5 b(,)16 b(the)h(name)f(of)h(the)g
(application\),)e(and)2049 3806 y(the)22 b(number)e(of)h(bytes)h(sent)g
(in)g(each)f(direction.)29 b(Thus,)21 b(by)h(captur)n(-)2049
3906 y(ing)c(on)h(the)g(order)e(of)h(only)g(4)h(pack)o(ets)g(\(the)f
(tw)o(o)h(initial)g(SYN)h(pack-)2049 4005 y(ets)e(e)o(xchanged,)d(and)h
(the)i(\002nal)f(tw)o(o)g(FIN)h(pack)o(ets)f(e)o(xchanged\),)d(we)2049
4105 y(can)26 b(determine)f(a)i(great)f(deal)g(about)g(a)h(connection)d
(e)n(v)o(en)h(though)2049 4204 y(we)c(\002lter)f(out)g(all)h(of)f(its)h
(data)f(pack)o(ets.)2132 4304 y(When)k(using)f(a)i(pack)o(et)e
(\002lter)m(,)i(one)e(must)h(also)g(choose)f(a)i Fr(snap-)2049
4404 y(shot)37 b(length)p Fs(,)j(which)c(determines)g(ho)n(w)h(much)f
(of)g(each)h(pack)o(et)2049 4503 y(should)20 b(be)g(captured.)25
b(F)o(or)20 b(e)o(xample,)f(by)h(def)o(ault)g Fm(tcpdump)g
Fs(uses)2049 4603 y(a)g(snapshot)e(length)g(of)h(68)g(bytes,)g(which)f
(suf)n(\002ces)i(to)f(capture)f(link-)2049 4703 y(layer)g(and)g(TCP/IP)
i(headers,)e(b)n(ut)h(generally)e(discards)h(most)h(of)g(the)2049
4802 y(data)j(in)h(the)f(pack)o(et.)32 b(The)22 b(smaller)g(the)h
(snapshot)e(length,)h(the)g(less)2049 4902 y(data)e(per)f(accepted)g
(pack)o(et)g(needs)h(to)g(copied)e(up)i(to)g(the)g(user)n(-le)n(v)o(el)
2049 5001 y(by)29 b(the)g(pack)o(et)g(\002lter)m(,)i(which)d(aids)i(in)
f(accelerating)f(pack)o(et)h(pro-)2049 5101 y(cessing)j(and)g(a)n(v)n
(oiding)f(loss.)61 b(On)32 b(the)g(other)f(hand,)j(to)e(analyze)2049
5201 y(connections)14 b(at)i(the)g(application)e(le)n(v)o(el,)i(Bro)g
(requires)f(the)h(full)g(data)2049 5300 y(contents)25
b(of)h(each)g(pack)o(et.)42 b(Consequently)-5 b(,)25
b(it)i(sets)g(the)f(snapshot)2049 5400 y(length)19 b(to)i(capture)e
(entire)h(pack)o(ets.)1929 5649 y(3)p eop
%%Page: 4 4
4 3 bop -150 -104 a Fh(2.2)99 b(Ev)o(ent)26 b(engine)-150
70 y Fs(The)21 b(resulting)g(\002ltered)g(pack)o(et)g(stream)h(is)g
(then)g(handed)e(up)h(to)h(the)-150 170 y(ne)o(xt)g(layer)m(,)g(the)h
(Bro)g(\223e)n(v)o(ent)f(engine.)-6 b(\224)32 b(This)22
b(layer)h(\002rst)g(performs)-150 269 y(se)n(v)o(eral)d(inte)o(grity)g
(checks)h(to)g(assure)g(that)g(the)g(pack)o(et)f(headers)h(are)-150
369 y(well-formed.)g(If)15 b(these)h(checks)e(f)o(ail,)j(then)e(Bro)g
(generates)f(an)h(e)n(v)o(ent)-150 469 y(indicating)k(the)h(problem)f
(and)g(discards)h(the)g(pack)o(et.)-67 578 y(If)37 b(the)h(checks)f
(succeed,)k(then)c(the)g(e)n(v)o(ent)g(engine)f(looks)h(up)-150
678 y(the)f(connection)f(state)i(associated)f(with)g(the)h(tuple)f(of)g
(the)g(tw)o(o)-150 777 y(IP)30 b(addresses)g(and)f(the)h(tw)o(o)g(TCP)h
(or)f(UDP)g(port)f(numbers,)i(cre-)-150 877 y(ating)22
b(ne)n(w)g(state)i(if)f(none)e(already)g(e)o(xists.)33
b(It)23 b(then)f(dispatches)g(the)-150 977 y(pack)o(et)32
b(to)g(a)h(handler)e(for)h(the)g(corresponding)d(connection)h(\(de-)
-150 1076 y(scribed)24 b(shortly\).)35 b(Bro)25 b(maintains)e(a)i
Fm(tcpdump)e Fs(trace)i(\002le)f(asso-)-150 1176 y(ciated)i(with)g(the)
f(traf)n(\002c)h(it)g(sees.)43 b(The)25 b(connection)f(handler)g(indi-)
-150 1276 y(cates)17 b(upon)f(return)f(whether)h(the)h(engine)f(should)
g(record)f(the)i(entire)-150 1375 y(pack)o(et)j(to)h(the)f(trace)h
(\002le,)g(just)g(its)h(header)m(,)c(or)j(nothing)e(at)i(all.)26
b(This)-150 1475 y(triage)f(trades)g(of)n(f)f(the)h(completeness)f(of)h
(the)g(traf)n(\002c)g(trace)g(v)o(ersus)-150 1574 y(its)h(size)g(and)f
(time)h(spent)f(generating)e(the)i(trace.)41 b(Generally)-5
b(,)24 b(Bro)-150 1674 y(records)f(full)h(pack)o(ets)g(if)h(it)g
(analyzed)e(the)h(entire)g(pack)o(et;)i(just)f(the)-150
1774 y(header)16 b(if)h(it)h(only)e(analyzed)f(the)i(pack)o(et)f(for)h
(SYN/FIN/RST)g(com-)-150 1873 y(putations;)j(and)h(skips)g(recording)e
(the)h(pack)o(et)h(if)g(it)h(did)e(not)h(do)f(an)o(y)-150
1973 y(processing)f(on)h(it.)-67 2082 y(W)-7 b(e)25 b(no)n(w)e(gi)n(v)o
(e)g(an)h(o)o(v)o(ervie)n(w)e(of)h(general)g(processing)f(done)h(for)
-150 2182 y(TCP)28 b(and)f(UDP)h(pack)o(ets.)46 b(In)27
b(both)g(cases,)i(the)f(processing)e(ends)-150 2282 y(with)j(in)m(v)n
(oking)d(a)j(handler)e(to)i(process)f(the)g(data)g(payload)f(of)i(the)
-150 2381 y(pack)o(et.)24 b(F)o(or)c(applications)e(kno)n(wn)g(to)i
(Bro,)g(this)g(results)g(in)g(further)-150 2481 y(analysis,)g(as)g
(discussed)f(in)h Fi(x)g Fs(6.)25 b(F)o(or)19 b(other)g(applications,)g
(analysis)-150 2581 y(ends)h(at)h(this)f(point.)-67 2690
y Fl(TCP)41 b(pr)o(ocessing)o(.)87 b Fs(F)o(or)40 b(each)h(TCP)g(pack)o
(et,)k(the)c(connec-)-150 2790 y(tion)25 b(handler)e(\(a)i(C++)h
(virtual)e(function\))f(v)o(eri\002es)i(that)g(the)g(entire)-150
2889 y(TCP)c(header)e(is)j(present)d(and)h(v)n(alidates)g(the)h(TCP)g
(checksum)e(o)o(v)o(er)-150 2989 y(the)30 b(pack)o(et)g(header)f(and)h
(payload.)53 b(If)30 b(successful,)j(it)e(then)e(tests)-150
3089 y(whether)23 b(the)g(TCP)i(header)e(includes)g(an)o(y)g(of)g(the)h
(SYN/FIN/RST)-150 3188 y(control)35 b(\003ags,)41 b(and)36
b(if)h(so)g(adjusts)g(the)f(connection')-5 b(s)35 b(state)j(ac-)-150
3288 y(cordingly)-5 b(.)46 b(Finally)-5 b(,)29 b(it)f(processes)g(an)o
(y)f(data)h(ackno)n(wledgement)-150 3388 y(present)23
b(in)h(the)f(header)m(,)g(and)g(then)g(in)m(v)n(ok)o(es)f(a)i(handler)e
(to)i(process)-150 3487 y(the)c(payload)f(data,)h(if)g(an)o(y)-5
b(.)-67 3597 y(Dif)n(ferent)28 b(changes)g(in)i(the)f(connection')-5
b(s)28 b(state)i(generate)e(dif-)-150 3696 y(ferent)42
b(e)n(v)o(ents.)93 b(When)43 b(the)g(initial)h(SYN)g(pack)o(et)e
(requesting)-150 3796 y(a)37 b(connection)e(is)j(seen,)j(the)c(e)n(v)o
(ent)f(engine)g(schedules)g(a)i(timer)-150 3896 y(for)i
Fj(T)52 b Fs(seconds)40 b(in)g(the)h(future)e(\(presently)-5
b(,)43 b(\002)n(v)o(e)e(minutes\);)49 b(if)-150 3995
y(the)h(timer)g(e)o(xpires)g(and)f(the)i(connection)d(has)i(not)g
(changed)-150 4095 y(state,)23 b(then)e(the)h(engine)f(generates)g(a)h
Fm(connection)p 1479 4095 25 4 v 28 w(attempt)-150 4195
y Fs(e)n(v)o(ent.)125 b(If)54 b(before)f(that)h(time,)62
b(ho)n(we)n(v)o(er)m(,)e(the)54 b(other)f(con-)-150 4294
y(nection)g(endpoint)f(replies)h(with)h(a)g(correct)f(SYN)h(ackno)n(w-)
-150 4394 y(ledgement)35 b(pack)o(et,)k(then)d(the)g(engine)f
(immediately)g(generates)-150 4493 y(a)44 b Fm(connection)p
436 4493 V 28 w(established)e Fs(e)n(v)o(ent,)48 b(and)42
b(cancels)i(the)-150 4593 y(connection)49 b(attempt)i(timer)-5
b(.)118 b(On)51 b(the)g(other)g(hand,)57 b(if)52 b(the)-150
4693 y(endpoint)c(replies)h(with)h(a)g(RST)g(pack)o(et,)57
b(then)49 b(the)g(connec-)-150 4792 y(tion)38 b(attempt)g(has)h(been)e
(rejected,)42 b(and)c(the)g(engine)g(generates)-150 4892
y Fm(connection)p 355 4892 V 28 w(rejected)p Fs(.)47
b(Similarly)-5 b(,)28 b(if)h(a)f(connection)d(ter)n(-)-150
4992 y(minates)31 b(via)g(a)h(normal)e(FIN)i(e)o(xchange,)f(then)g(the)
g(engine)f(gen-)-150 5091 y(erates)23 b Fm(connection)p
572 5091 V 28 w(finished)p Fs(.)34 b(It)23 b(also)h(generates)e(se)n(v)
o(eral)-150 5191 y(other)f(e)n(v)o(ents)g(re\003ecting)g(more)g
(unusual)g(w)o(ays)h(in)g(which)f(connec-)-150 5290 y(tions)f(can)g
(terminate.)-67 5400 y Fl(UDP)j(pr)o(ocessing)o(.)34
b Fs(UDP)24 b(processing)e(is)i(similar)f(b)n(ut)h(simpler)m(,)2049
-104 y(since)k(there)f(is)h(no)f(connection)f(state,)k(e)o(xcept)c(in)i
(one)f(re)o(gard.)45 b(If)2049 -5 y(host)16 b Fj(A)g
Fs(sends)g(a)g(UDP)g(pack)o(et)f(to)h(host)g Fj(B)k Fs(with)c(a)g
(source)f(port)g(of)g Fj(p)3996 7 y Fe(A)2049 95 y Fs(and)k(a)h
(destination)e(port)h(of)g Fj(p)2915 107 y Fe(B)2972
95 y Fs(,)h(then)f(Bro)h(considers)e Fj(A)i Fs(as)h(ha)n(ving)2049
194 y(initiated)16 b(a)h(\223request\224)e(to)i Fj(B)t
Fs(,)g(and)f(establishes)h(pseudo-connection)2049 294
y(state)27 b(associated)g(with)f(that)h(request.)43 b(If)27
b Fj(B)k Fs(subsequently)25 b(sends)2049 394 y(a)31 b(UDP)g(pack)o(et)e
(to)i Fj(A)g Fs(with)f(a)h(source)e(port)h(of)g Fj(p)3549
406 y Fe(B)3636 394 y Fs(and)g(destina-)2049 493 y(tion)d
Fj(p)2248 505 y Fe(A)2302 493 y Fs(,)j(then)e(Bro)f(considers)g(this)i
(pack)o(et)e(to)h(re\003ect)f(a)i(\223reply\224)2049
593 y(to)23 b(the)f(request.)32 b(The)22 b(handlers)g(\(virtual)f
(functions\))g(for)h(the)h(UDP)2049 693 y(payload)j(data)i(can)f(then)g
(readily)g(distinguish)g(between)g(requests)2049 792
y(and)22 b(replies)g(for)g(the)g(usual)h(case)g(when)e(UDP)i(traf)n
(\002c)f(follo)n(ws)g(that)2049 892 y(pattern.)43 b(The)26
b(def)o(ault)g(handlers)f(for)h(UDP)h(requests)f(and)g(replies)2049
991 y(simply)20 b(generate)f Fm(udp)p 2753 991 V 29 w(request)h
Fs(and)f Fm(udp)p 3442 991 V 30 w(reply)g Fs(e)n(v)o(ents.)2049
1233 y Fh(2.3)124 b(P)n(olicy)24 b(script)h(inter)o(pr)n(eter)2049
1391 y Fs(After)30 b(the)g(e)n(v)o(ent)f(engine)g(has)h(\002nished)g
(processing)f(a)h(pack)o(et,)i(it)2049 1490 y(then)h(checks)g(whether)f
(the)h(processing)f(generated)g(an)o(y)g(e)n(v)o(ents.)2049
1590 y(\(These)26 b(are)h(k)o(ept)f(on)g(a)h(FIFO)g(queue.\))43
b(If)27 b(so,)h(it)g(processes)e(each)2049 1689 y(e)n(v)o(ent)h(until)h
(the)f(queue)g(is)i(empty)-5 b(,)28 b(as)h(described)d(belo)n(w)-5
b(.)47 b(It)28 b(also)2049 1789 y(checks)19 b(whether)f(an)o(y)h(timer)
g(e)n(v)o(ents)g(ha)n(v)o(e)g(e)o(xpired,)e(and)i(if)h(so)g(pro-)2049
1889 y(cesses)h(them,)f(too.)2613 1859 y Fn(2)2132 1989
y Fs(A)d(k)o(e)o(y)e(f)o(acet)i(of)f(Bro')-5 b(s)17 b(design)e(is)i
(the)g(clear)f(distinction)f(between)2049 2089 y(the)33
b(generation)d(of)j(e)n(v)o(ents)e(v)o(ersus)i(what)f(to)h(do)f(in)h
(response)e(to)2049 2188 y(the)26 b(e)n(v)o(ents.)40
b(These)26 b(are)g(sho)n(wn)f(as)h(separate)f(box)o(es)g(in)h(Figure)f
(1,)2049 2288 y(and)18 b(this)h(structure)f(re\003ects)g(the)h
(separation)e(between)h(mechanism)2049 2388 y(and)25
b(polic)o(y)g(discussed)g(in)h Fi(x)h Fs(1.)42 b(The)25
b(\223polic)o(y)g(script)g(interpreter\224)2049 2487
y(e)o(x)o(ecutes)17 b(scripts)h(written)g(in)g(the)g(specialized)f
Fm(Bro)h Fs(language)e(\(de-)2049 2587 y(tailed)h(in)h
Fi(x)g Fs(3\).)24 b(These)17 b(scripts)h(specify)f(e)n(v)o(ent)f
(handlers,)h(which)g(are)2049 2687 y(essentially)26 b(identical)f(to)h
(Bro)g(functions)e(e)o(xcept)h(that)h(the)o(y)f(don')o(t)2049
2786 y(return)19 b(a)i(v)n(alue.)k(F)o(or)20 b(each)g(e)n(v)o(ent)f
(passed)i(to)f(the)h(interpreter)m(,)d(it)j(re-)2049
2886 y(trie)n(v)o(es)g(the)h(\(semi-\)compiled)d(code)i(for)g(the)g
(corresponding)d(han-)2049 2985 y(dler)m(,)28 b(binds)e(the)h(v)n
(alues)f(of)h(the)f(e)n(v)o(ents)h(to)f(the)h(ar)o(guments)e(of)i(the)
2049 3085 y(handler)m(,)c(and)h(interprets)g(the)g(code.)37
b(This)25 b(code)e(in)i(turn)e(can)i(e)o(x)o(e-)2049
3185 y(cute)19 b(arbitrary)e(Bro)i(scripting)f(commands,)f(including)h
(generating)2049 3284 y(ne)n(w)27 b(e)n(v)o(ents,)h(logging)e
(real-time)g(noti\002cations)g(\(using)h(the)g(Unix)2049
3384 y Fr(syslo)o(g)d Fs(function\),)e(recording)g(data)h(to)h(disk,)g
(or)g(modifying)d(inter)n(-)2049 3484 y(nal)k(state)g(for)f(access)i
(by)e(subsequently)f(in)m(v)n(ok)o(ed)g(e)n(v)o(ent)h(handlers)2049
3583 y(\(or)c(by)f(the)i(e)n(v)o(ent)e(engine)g(itself\).)2132
3684 y(Finally)-5 b(,)41 b(along)c(with)g(separating)g(mechanism)f
(from)g(polic)o(y)-5 b(,)2049 3783 y(Bro')g(s)23 b(emphasis)g(on)f
(asynchronous)e(e)n(v)o(ents)i(as)i(the)f(link)f(between)2049
3883 y(the)c(e)n(v)o(ent)f(engine)g(and)h(the)g(polic)o(y)e(script)i
(interpreter)f(b)n(uys)h(a)g(great)2049 3982 y(deal)28
b(in)f(terms)h(of)f(e)o(xtensibility)-5 b(.)46 b(Adding)26
b(ne)n(w)i(functionality)d(to)2049 4082 y(Bro)e(generally)f(consists)i
(of)f(adding)e(a)j(ne)n(w)f(protocol)e(analyzer)h(to)2049
4182 y(the)e(e)n(v)o(ent)f(engine)g(and)h(then)g(writing)f(ne)n(w)h(e)n
(v)o(ent)f(handlers)g(for)h(the)2049 4281 y(e)n(v)o(ents)27
b(generated)f(by)h(the)h(analyzer)-5 b(.)46 b(Neither)27
b(the)h(analyzer)e(nor)2049 4381 y(the)g(e)n(v)o(ent)f(handlers)g(tend)
h(to)g(ha)n(v)o(e)g(much)f(o)o(v)o(erlap)f(with)i(e)o(xisting)p
2049 4455 801 4 v 2134 4509 a Fk(2)2169 4532 y Fp(There)f(is)f(a)h
(subtle)h(design)g(decision)g(in)m(v)o(olv)o(ed)h(with)e(processing)i
(all)e(of)g(the)2049 4611 y(generated)g(e)n(v)o(ents)f(before)g
(proceeding)h(to)e(read)g(the)g(ne)o(xt)g(pack)o(et.)39
b(W)-5 b(e)22 b(might)h(be)2049 4690 y(tempted)f(to)e(defer)h(e)n(v)o
(ent)h(processing)g(until)g(a)e(period)h(of)g(relati)n(v)o(ely)j(light)
d(acti)n(vity)l(,)2049 4769 y(to)g(aid)g(the)g(engine)h(with)f(k)o
(eeping)i(up)d(during)h(periods)h(of)e(hea)o(vy)h(load.)32
b(Ho)n(we)n(v)o(er)m(,)2049 4848 y(doing)24 b(so)f(can)h(lead)h(to)f
(races:)35 b(the)24 b(\223e)n(v)o(ent)h(control\224)h(arro)n(w)e(in)g
(Figure)g(1)f(re\003ects)2049 4927 y(the)e(f)o(act)h(that)g(the)f
(polic)o(y)h(script)g(can,)f(to)g(a)g(limited)h(de)o(gree,)h
(manipulate)g(the)e(con-)2049 5006 y(nection)h(state)f(maintained)i
(inside)e(the)f(engine.)31 b(If)19 b(e)n(v)o(ent)j(processing)f(is)f
(deferred,)2049 5085 y(then)k(such)f(control)h(may)f(happen)h(after)g
(the)f(connection)j(state)e(has)f(already)i(been)2049
5163 y(changed)20 b(due)f(to)f(more)g(recently-recei)n(v)o(ed)24
b(traf)n(\002c.)h(So,)18 b(to)g(ensure)h(that)g(e)n(v)o(ent)h(pro-)2049
5242 y(cessing)e(al)o(w)o(ays)i(re\003ects)e(fresh)g(data,)g(and)g
(does)g(not)g(inadv)o(ertently)j(lead)e(to)e(incon-)2049
5321 y(sistent)k(connection)i(state,)e(we)f(process)h(e)n(v)o(ents)g
(immediately)l(,)h(before)f(mo)o(ving)g(on)2049 5400
y(to)c(ne)n(wly-arri)n(v)o(ed)k(netw)o(ork)e(traf)n(\002c.)1929
5649 y Fs(4)p eop
%%Page: 5 5
5 4 bop -150 -104 a Fs(functionality)-5 b(,)16 b(so)k(for)e(the)h(most)
f(part)h(we)g(can)g(a)n(v)n(oid)f(the)h(subtle)g(in-)-150
-5 y(teractions)25 b(between)g(loosely)g(coupled)f(modules)h(that)h
(can)f(easily)-150 95 y(lead)20 b(to)g(maintenance)f(headaches)g(and)g
(b)n(uggy)g(programs.)-150 423 y Ft(3)119 b(The)31 b
Fd(Bro)e Ft(language)-150 625 y Fs(As)21 b(discussed)g(abo)o(v)o(e,)d
(we)j(e)o(xpress)f(security)g(policies)h(in)f(terms)h(of)-150
725 y(scripts)i(written)g(in)g(the)g(specialized)f Fm(Bro)h
Fs(language.)31 b(In)23 b(this)g(sec-)-150 825 y(tion)18
b(we)g(gi)n(v)o(e)f(an)g(o)o(v)o(ervie)n(w)f(of)h(the)h(language')-5
b(s)17 b(features.)23 b(The)17 b(aim)-150 924 y(is)25
b(to)g(con)m(v)o(e)o(y)d(the)i(\003a)n(v)n(or)h(of)f(the)g(language,)g
(rather)f(than)h(describe)-150 1024 y(it)d(precisely)-5
b(.)-67 1132 y(Our)23 b(goal)f(of)h(\223a)n(v)n(oid)g(simple)g(mistak)o
(es\224)g(\()p Fi(x)g Fs(1\),)h(while)f(perhaps)-150
1232 y(sounding)28 b(trite,)k(in)e(f)o(act)g(hea)n(vily)g(in\003uenced)
e(the)i(design)f(of)h(the)-150 1331 y Fm(Bro)24 b Fs(language.)35
b(Because)24 b(intrusion)f(detection)g(can)h(form)f(a)h(cor)n(-)-150
1431 y(nerstone)18 b(of)i(the)f(security)g(measures)g(a)n(v)n(ailable)g
(to)h(a)g(site,)g(we)g(v)o(ery)-150 1531 y(much)26 b(w)o(ant)g(our)g
(polic)o(y)f(scripts)i(to)g(beha)n(v)o(e)e(as)j(e)o(xpected.)42
b(From)-150 1630 y(our)20 b(o)n(wn)h(e)o(xperience,)e(a)j(big)f(step)g
(to)n(w)o(ards)g(a)n(v)n(oiding)f(surprises)h(is)-150
1730 y(to)d(use)g(a)g(strongly)f(typed)g(language)f(that)i(detects)g
(typing)e(inconsis-)-150 1830 y(tencies)21 b(at)h(compile-time,)e(and)g
(that)i(guarantees)e(that)h(all)h(v)n(ariable)-150 1929
y(references)h(at)i(run-time)d(will)j(be)f(to)h(v)n(alid)f(v)n(alues.)
36 b(Furthermore,)-150 2029 y(we)26 b(ha)n(v)o(e)e(come)h(to)g
(appreciate)f(the)h(bene\002ts)g(of)g(domain-speci\002c)-150
2128 y(languages,)32 b(that)f(is,)j(languages)29 b(tailored)h(for)g(a)h
(particular)e(task.)-150 2228 y(Ha)n(ving)c(cobbled)f(together)g(our)h
(\002rst)h(monitoring)d(system)j(out)f(of)-150 2328 y
Fm(tcpdump)p Fs(,)30 b Fm(awk)p Fs(,)h(and)d(shell)h(scripts,)i(we)e
(thirsted)f(for)g(w)o(ays)h(to)-150 2427 y(deal)j(directly)g(with)h
(hostnames,)h(IP)f(addresses,)i(port)c(numbers,)-150
2527 y(and)20 b(the)g(lik)o(e,)g(rather)f(than)h(de)n(vising)f(ASCII)h
(pseudo-equi)n(v)n(alents.)-150 2627 y(By)c(making)e(these)h(sorts)g
(of)g(entities)h(\002rst-class)g(v)n(alues)f(in)g Fm(Bro)p
Fs(,)h(we)-150 2726 y(both)k(increase)g(the)h(ease)g(of)g(e)o
(xpression)e(of)n(fered)g(by)h(the)h(language)-150 2826
y(and,)h(due)f(to)h(strong)f(typing,)g(catch)h(errors)f(\(such)g(as)i
(comparing)c(a)-150 2925 y(port)h(to)g(an)g(IP)h(address\))e(that)h
(might)g(otherwise)f(slip)i(by)-5 b(.)-150 3211 y Fh(3.1)99
b(Data)25 b(types)g(and)h(constants)-150 3384 y Fl(Atomic)d(types.)35
b Fm(Bro)23 b Fs(supports)f(se)n(v)o(eral)h(types)g(f)o(amiliar)g(to)g
(users)-150 3483 y(of)32 b(traditional)g(languages:)48
b Fm(bool)32 b Fs(for)g(booleans,)i Fm(int)f Fs(for)f(in-)-150
3583 y(te)o(gers,)25 b Fm(count)f Fs(for)g(non-ne)o(gati)n(v)o(e)d
(inte)o(gers)j(\(\223unsigned\224)e(in)j(C\),)-150 3682
y Fm(double)k Fs(for)g(double-precision)d(\003oating)j(point,)i(and)e
Fm(string)-150 3782 y Fs(for)18 b(a)h(series)g(of)f(bytes.)24
b(The)19 b(\002rst)g(four)e(of)h(these)h(\(all)g(b)n(ut)f
Fm(string)p Fs(\))-150 3882 y(are)h(termed)g Fr(arithmetic)g
Fs(types,)g(and)g(mixing)f(them)h(in)h(e)o(xpressions)-150
3981 y(promotes)35 b Fm(bool)h Fs(to)h Fm(count)p Fs(,)i
Fm(count)d Fs(to)h Fm(int)p Fs(,)j(and)c Fm(int)g Fs(to)-150
4081 y Fm(double)p Fs(.)-67 4189 y Fm(Bro)e Fs(pro)o(vides)d
Fm(T)j Fs(and)f Fm(F)h Fs(as)g Fm(bool)g Fs(constants)f(for)g(true)g
(and)-150 4289 y(f)o(alse;)38 b(a)33 b(series)f(of)g(digits)g(for)g
Fm(count)f Fs(constants;)38 b(and)31 b(C-style)-150 4389
y(constants)20 b(for)f Fm(double)h Fs(and)g Fm(string)p
Fs(.)-67 4497 y(Unlik)o(e)27 b(in)g(C,)g(ho)n(we)n(v)o(er)m(,)f
Fm(Bro)h Fs(strings)g(are)g(represented)e(inter)n(-)-150
4597 y(nally)j(as)g(a)h(count)e(and)g(a)i(v)o(ector)d(of)i(bytes,)i
(rather)d(than)g(a)i(NUL-)-150 4696 y(terminated)24 b(series)j(of)e
(bytes.)41 b(This)26 b(dif)n(ference)d(is)k(important)d(be-)-150
4796 y(cause)34 b(NULs)g(can)g(easily)g(be)g(introduced)d(into)j
(strings)f(deri)n(v)o(ed)-150 4895 y(from)22 b(netw)o(ork)f(traf)n
(\002c,)i(either)f(by)h(the)f(nature)g(of)h(the)f(application,)-150
4995 y(inadv)o(ertently)-5 b(,)35 b(or)f(maliciously)g(by)g(an)g
(attack)o(er)g(attempting)f(to)-150 5095 y(sub)o(v)o(ert)21
b(the)i(monitor)-5 b(.)30 b(An)23 b(e)o(xample)e(of)h(the)h(latter)g
(is)g(sending)f(the)-150 5194 y(follo)n(wing)d(to)h(an)g(FTP)h(serv)o
(er:)9 5400 y Ff(USER)40 b(nice\\0USER)e(root)2049 -104
y Fs(where)20 b(\223)p Fm(\\0)p Fs(\224)g(represents)f(a)i(NUL.)f
(Depending)f(on)h(ho)n(w)f(it)i(is)h(writ-)2049 -5 y(ten,)33
b(the)e(FTP)h(application)d(recei)n(ving)h(this)h(te)o(xt)g(might)f
(well)i(in-)2049 95 y(terpret)i(it)h(as)h(tw)o(o)f(separate)f
(commands,)j(\223)p Fm(USER)49 b(nice)p Fs(\224)34 b(fol-)2049
194 y(lo)n(wed)d(by)g(\223)p Fm(USER)49 b(root)p Fs(\224.)58
b(But)32 b(if)g(the)g(monitoring)d(program)2049 294 y(uses)18
b(NUL-terminated)c(strings,)k(then)e(it)i(will)g(ef)n(fecti)n(v)o(ely)d
(see)i(only)2049 394 y(\223)p Fm(USER)49 b(nice)p Fs(\224)27
b(and)h(ha)n(v)o(e)f(no)h(opportunity)c(to)k(detect)g(the)g(sub-)2049
493 y(v)o(ersi)n(v)o(e)19 b(action.)2132 596 y(Similarly)-5
b(,)22 b(it)h(is)h(important)c(that)j(when)f(Bro)g(logs)h(such)f
(strings,)2049 696 y(or)33 b(prints)g(them)f(as)i(te)o(xt)f(to)g(a)h
(\002le,)i(that)e(it)f(e)o(xpands)f(embedded)2049 796
y(NULs)19 b(into)g(visible)f(escape)h(sequences)f(to)h(\003ag)f(their)h
(appearance.)2132 899 y Fm(Bro)44 b Fs(also)f(includes)g(a)h(number)e
(of)h(non-traditional)e(types,)2049 999 y(geared)35 b(to)n(w)o(ards)h
(its)i(speci\002c)f(problem)d(domain.)73 b(A)37 b(v)n(alue)f(of)2049
1098 y(type)23 b Fm(time)h Fs(re\003ects)g(an)g(absolute)f(time,)i(and)
e Fm(interval)g Fs(a)h(dif-)2049 1198 y(ference)35 b(in)h(time.)74
b(Subtracting)34 b(tw)o(o)j Fm(time)f Fs(v)n(alues)g(yields)g(an)2049
1297 y Fm(interval)p Fs(;)17 b(adding)e(or)h(subtracting)f(an)i
Fm(interval)e Fs(to)i(a)g Fm(time)2049 1397 y Fs(yields)25
b(a)h Fm(time)p Fs(;)j(adding)24 b(tw)o(o)i Fm(time)f
Fs(v)n(alues)g(is)i(an)e(error)-5 b(.)40 b(There)2049
1497 y(are)24 b(presently)e(no)i Fm(time)f Fs(constants,)h(b)n(ut)g
Fm(interval)f Fs(constants)2049 1596 y(can)33 b(be)h(speci\002ed)f
(using)g(a)h(numeric)f(\(possibly)f(\003oating-point\))2049
1696 y(v)n(alue)i(follo)n(wed)f(by)h(a)g(unit)h(of)f(time,)j(such)e(as)
g(\223)p Fm(30)49 b(min)p Fs(\224)34 b(for)2049 1796
y(thirty)20 b(minutes.)2132 1899 y(The)k Fm(port)g Fs(type)g
(corresponds)e(to)i(a)h(TCP)g(or)e(UDP)i(port)f(num-)2049
1998 y(ber)-5 b(.)35 b(TCP)25 b(and)e(UDP)h(ports)f(are)h(distinct)g
(\(internally)-5 b(,)22 b(Bro)i(distin-)2049 2098 y(guishes)18
b(between)f(the)g(tw)o(o,)i(both)e(of)g(which)h(are)g(16-bit)e
(quantities,)2049 2198 y(by)21 b(storing)f Fm(port)h
Fs(v)n(alues)f(in)h(a)h(32-bit)e(inte)o(ger)f(and)i(setting)g(bit)g(17)
2049 2297 y(for)i(UDP)g(ports\).)33 b(Thus,)24 b(a)f(v)n(ariable)f(of)h
(type)g Fm(port)g Fs(can)g(hold)f(ei-)2049 2397 y(ther)e(a)g(TCP)h(or)f
(a)h(UDP)f(port,)f(b)n(ut)h(at)h(an)o(y)e(gi)n(v)o(en)g(time)h(it)h(is)
g(holding)2049 2497 y(e)o(xactly)e(one)h(of)g(these.)2132
2600 y(There)29 b(are)h(tw)o(o)h(forms)e(of)h Fm(port)g
Fs(constants.)55 b(The)30 b(\002rst)g(con-)2049 2699
y(sists)h(of)f(an)g(unsigned)e(inte)o(ger)h(follo)n(wed)f(by)i(either)f
(\223)p Fm(/tcp)p Fs(\224)h(or)2049 2799 y(\223)p Fm(/udp)p
Fs(.)-6 b(\224)46 b(So,)28 b(for)f(e)o(xample,)g(\223)p
Fm(80/tcp)p Fs(\224)g(corresponds)d(to)k(TCP)2049 2899
y(port)c(80)h(\(the)f(HTTP)h(protocol)e(used)i(by)f(the)h(W)-7
b(orld)25 b(W)m(ide)f(W)-7 b(eb\).)2049 2998 y(The)24
b(second)g(form)f(of)h(constant)g(is)i(speci\002ed)e(using)g(an)g
(identi\002er)2049 3098 y(that)17 b(matches)g(one)g(of)f(the)i
(services)f(kno)n(wn)e(to)j(the)f Fr(g)o(etservbyname)2049
3197 y Fs(library)e(routine.)22 b(\(Probably)13 b(these)j(service)g
(names)f(should)g(instead)2049 3297 y(be)29 b(b)n(uilt)g(directly)g
(into)g(Bro,)i(to)e(a)n(v)n(oid)g(problems)f(when)g(porting)2049
3397 y Fm(Bro)h Fs(scripts)f(between)g(operating)f(systems.\))50
b(So,)30 b(for)e(e)o(xample,)2049 3496 y(\223)p Fm(telnet)p
Fs(\224)19 b(is)i(a)g Fm(Bro)f Fs(constant)g(equi)n(v)n(alent)e(to)j
(\223)p Fm(23/tcp)p Fs(.)-6 b(\224)2132 3600 y(This)24
b(second)f(form)f(of)i Fm(port)f Fs(constant,)h(while)f(highly)g(con)m
(v)o(e-)2049 3699 y(nient)29 b(and)f(readable,)i(brings)e(with)h(it)g
(a)h(subtle)e(problem.)50 b(Some)2049 3799 y(names,)39
b(such)c(as)i(\223)p Fm(domain)p Fs(,)-6 b(\224)38 b(on)e(man)o(y)e
(systems)i(correspond)2049 3898 y(to)j(tw)o(o)h(dif)n(ferent)d(ports;)
48 b(in)40 b(this)f(e)o(xample,)j(to)e Fm(53/tcp)e Fs(and)2049
3998 y Fm(53/udp)p Fs(.)54 b(Therefore,)29 b(the)h(type)g(of)g(\223)p
Fm(domain)p Fs(\224)f(is)h(not)g(a)g(sim-)2049 4098 y(ple)e
Fm(port)f Fs(v)n(alue,)h(b)n(ut)g(instead)f(a)h Fm(list)f
Fs(of)h Fm(port)f Fs(v)n(alues.)47 b(Ac-)2049 4197 y(cordingly)-5
b(,)18 b(a)j(constant)f(lik)o(e)h(\223)p Fm(domain)p
Fs(\224)f(cannot)g(be)g(used)h(in)g Fm(Bro)2049 4297
y Fs(e)o(xpressions)j(\(such)g(as)i(\223)p Fm(dst)p 2953
4297 25 4 v 30 w(port)49 b(==)g(domain)p Fs(\224\),)25
b(because)2049 4397 y(it)j(is)h(ambiguous)c(which)i(v)n(alue)g(is)i
(intended.)45 b(W)-7 b(e)29 b(return)d(to)i(this)2049
4496 y(point)19 b(shortly)-5 b(.)2132 4599 y(V)c(alues)20
b(of)g(type)g Fm(port)g Fs(may)g(be)g(compared)e(for)i(equality)f(or)h
(or)n(-)2049 4699 y(dering)31 b(\(for)g(e)o(xample,)j(\223)p
Fm(20/tcp)48 b(<)i(telnet)p Fs(\224)31 b(yields)i(true\),)2049
4799 y(b)n(ut)20 b(otherwise)g(cannot)f(be)h(operated)f(on.)2132
4902 y(Another)j(netw)o(orking)f(type)i(pro)o(vided)e(by)i
Fm(Bro)g Fs(is)h Fm(addr)p Fs(,)g(cor)n(-)2049 5001 y(responding)29
b(to)j(an)f(IP)h(address.)59 b(These)31 b(are)h(represented)e(inter)n
(-)2049 5101 y(nally)17 b(as)h(unsigned,)e(32-bit)g(inte)o(gers,)h(b)n
(ut)g(in)h Fm(Bro)f Fs(scripts)h(the)f(only)2049 5201
y(operations)26 b(that)h(can)g(be)g(performed)d(on)j(them)f(are)h
(comparisons)2049 5300 y(for)e(equality)g(or)h(inequality)e(\(also,)j
(a)f(b)n(uilt-in)f(function)f(pro)o(vides)2049 5400 y(masking,)19
b(as)h(discussed)g(belo)n(w\).)k(Constants)c(of)g(type)f
Fm(addr)h Fs(ha)n(v)o(e)1929 5649 y(5)p eop
%%Page: 6 6
6 5 bop -150 -104 a Fs(the)22 b(f)o(amiliar)g(\223dotted)f(quad\224)g
(format,)h Fj(A)1075 -92 y Fn(1)1112 -104 y Fj(:A)1197
-92 y Fn(2)1235 -104 y Fj(:A)1320 -92 y Fn(3)1357 -104
y Fj(:A)1442 -92 y Fn(4)1480 -104 y Fs(,)h(where)f(the)-150
-5 y Fj(A)-88 7 y Fe(i)-39 -5 y Fs(all)e(lie)h(between)f(0)g(and)g
(255.)-67 95 y(More)37 b(interesting)g(are)g Fr(hostname)f
Fs(constants.)77 b(There)37 b(is)h(no)-150 194 y Fm(Bro)45
b Fs(type)f(corresponding)d(to)j(Internet)g(hostnames,)49
b(because)-150 294 y(hostnames)26 b(can)g(correspond)e(to)j(multiple)f
(IP)h(addresses,)g(so)g(one)-150 394 y(quickly)34 b(runs)g(into)h
(ambiguities)f(if)h(comparing)d(one)j(hostname)-150 493
y(with)h(another)-5 b(.)71 b Fm(Bro)36 b Fs(does,)j(ho)n(we)n(v)o(er)m
(,)e(support)e(hostnames)g(as)-150 593 y(constants.)81
b(An)o(y)38 b(series)i(of)e(tw)o(o)i(or)e(more)h(identi\002ers)f
(delim-)-150 693 y(ited)c(by)f(dots)h(forms)f(a)i(hostname)d(constant,)
37 b(so,)g(for)c(e)o(xample,)-150 792 y(\223)p Fm(lbl.gov)p
Fs(\224)23 b(and)h(\223)p Fm(www.microsoft.com)p Fs(\224)d(are)j(both)f
(host-)-150 892 y(name)f(constants)g(\(the)h(latter)m(,)g(as)g(of)f
(this)i(writing,)e(corresponds)e(to)-150 991 y(13)j(distinct)g(IP)h
(addresses\).)33 b(The)23 b(v)n(alue)g(of)g(a)g(hostname)f(constant)
-150 1091 y(is)f(a)g Fm(list)g Fs(of)f Fm(addr)g Fs(containing)f(one)h
(or)g(more)g(elements.)26 b(These)-150 1191 y(lists)37
b(\(as)f(with)g(the)g(lists)h(associated)e(with)h(certain)f
Fm(port)g Fs(con-)-150 1290 y(stants,)22 b(discussed)f(abo)o(v)o(e\))e
(cannot)h(be)h(used)g(in)h Fm(Bro)f Fs(e)o(xpressions;)-150
1390 y(b)n(ut)h(the)o(y)f(play)g(a)h(central)f(role)g(in)h
(initializing)f Fm(Bro)g(table)p Fs(')-5 b(s)22 b(and)-150
1490 y Fm(set)p Fs(')-5 b(s,)20 b(discussed)g(in)h Fi(x)f
Fs(3.3)g(belo)n(w)-5 b(.)-67 1589 y Fl(Aggr)o(egate)22
b(types.)38 b Fm(Bro)24 b Fs(also)h(supports)e(a)i(number)e(of)h
(aggre-)-150 1689 y(gate)j(types.)46 b(A)28 b Fm(record)f
Fs(is)h(a)g(collection)e(of)h(elements)g(of)g(arbi-)-150
1788 y(trary)19 b(type.)25 b(F)o(or)19 b(e)o(xample,)f(the)i
(prede\002ned)e Fm(conn)p 1370 1788 25 4 v 29 w(id)j
Fs(type,)e(used)-150 1888 y(to)f(hold)g(connection)e(identi\002ers,)i
(is)i(de\002ned)d(in)h(the)h Fm(Bro)f Fs(run-time)-150
1988 y(initialization)i(\002le)g(as:)9 2140 y Ff(type)40
b(conn_id:)e(record)h({)169 2219 y(orig_h:)g(addr;)169
2298 y(orig_p:)g(port;)169 2377 y(resp_h:)g(addr;)169
2455 y(resp_p:)g(port;)9 2534 y(};)-150 2707 y Fs(The)27
b Fm(orig)p 212 2707 V 29 w(h)h Fs(and)f Fm(resp)p 667
2707 V 29 w(h)h Fs(elements)f(\(or)g(\223\002elds\224\))g(ha)n(v)o(e)g
(type)-150 2807 y Fm(addr)e Fs(and)g(hold)g(the)h(connection)d
(originator')-5 b(s)24 b(and)h(responder')-5 b(s)-150
2907 y(IP)21 b(addresses.)26 b(Similarly)-5 b(,)20 b
Fm(orig)p 862 2907 V 29 w(p)h Fs(and)f Fm(resp)p 1303
2907 V 29 w(p)h Fs(hold)f(the)h(orig-)-150 3006 y(inator)g(and)f
(responder)f(ports.)28 b(Record)21 b(\002elds)h(are)f(accessed)g(using)
-150 3106 y(the)f(\223)p Fm($)p Fs(\224)g(operator)-5
b(.)-67 3205 y(F)o(or)20 b(specifying)e(security)i(policies,)f(a)i
(particularly)d(useful)i Fm(Bro)-150 3305 y Fs(type)26
b(is)i Fm(table)p Fs(.)44 b Fm(Bro)26 b Fs(tables)h(ha)n(v)o(e)f(tw)o
(o)h(components,)f(a)h(set)h(of)-150 3405 y Fr(indices)c
Fs(and)g(a)h Fr(yield)g(type)p Fs(.)37 b(The)24 b(indices)h(may)f(be)g
(of)g(an)o(y)g(atomic)-150 3504 y(\(non-aggre)o(gate\))c(type,)25
b(and/or)e(an)o(y)h Fm(record)g Fs(types)h(that,)g(when)-150
3604 y(\(recursi)n(v)o(ely\))i(e)o(xpanded)g(into)i(all)h(of)f(their)g
(elements,)i(are)e(com-)-150 3704 y(prised)h(of)h(only)f(atomic)h
(types.)57 b(\(Thus,)32 b Fm(Bro)f Fs(tables)g(pro)o(vide)e(a)-150
3803 y(form)19 b(of)h(associati)n(v)o(e)g(array)-5 b(.\))23
b(So,)d(for)g(e)o(xample,)9 3956 y Ff(table[port])39
b(of)g(string)-150 4108 y Fs(can)20 b(be)g(inde)o(x)o(ed)e(by)i(a)h
Fm(port)f Fs(v)n(alue,)f(yielding)g(a)h Fm(string)p Fs(,)g(and:)9
4245 y Ff(table[conn_id])38 b(of)i(ftp_session_info)-150
4404 y Fs(is)34 b(inde)o(x)o(ed)c(by)i(a)h Fm(conn)p
623 4404 V 30 w(id)f Fs(record\227or)m(,)h(equi)n(v)n(alently)-5
b(,)33 b(by)g(an)-150 4503 y Fm(addr)p Fs(,)42 b(a)d
Fm(port)p Fs(,)j(another)36 b Fm(addr)p Fs(,)43 b(and)37
b(another)g Fm(port)p Fs(\227and)-150 4603 y(yields)20
b(an)g Fm(ftp)p 323 4603 V 30 w(session)p 703 4603 V
28 w(info)g Fs(record)f(as)i(a)f(result.)-67 4703 y(Closely)i(related)e
(to)i Fm(table)e Fs(types)h(are)h Fm(set)f Fs(types.)28
b(These)21 b(are)-150 4802 y(simply)d Fm(table)f Fs(types)h(that)h(do)e
(not)h(yield)g(a)g(v)n(alue.)24 b(Their)17 b(purpose)-150
4902 y(is)j(to)f(maintain)f(collections)h(of)g(tuples,)g(e)o(xpressed)e
(in)j(terms)f(of)g(the)-150 5001 y(set')-5 b(s)18 b(indices.)23
b(The)16 b(e)o(xamples)f(in)i Fi(x)g Fs(3.3)f(clarify)f(ho)n(w)h(this)h
(is)g(useful.)-67 5101 y(Another)27 b(aggre)o(gate)e(type)i(supported)f
(is)j Fm(file)p Fs(.)48 b(Support)26 b(for)-150 5201
y(\002les)d(is)g(presently)d(crude:)28 b(a)22 b(script)g(can)g(open)f
(\002les)h(for)g(writing)f(or)-150 5300 y(appending,)j(and)g(can)h
(pass)h(the)g(resulting)e Fm(file)h Fs(v)n(ariable)f(to)i(the)-150
5400 y Fm(print)e Fs(command)f(to)i(specify)f(where)g(it)i(should)e
(write,)i(b)n(ut)e(that)2049 -104 y(is)j(all.)42 b(Also,)27
b(these)f(\002les)h(are)f(simple)f(ASCII.)h(In)g(the)f(future,)h(we)
2049 -5 y(plan)g(to)h(e)o(xtend)f(\002les)i(to)f(support)e(reading,)i
(ASCII)g(parsing,)g(and)2049 95 y(binary)19 b(\(typed\))f(reading)h
(and)h(writing.)2132 196 y(W)-7 b(e)33 b(also)g(note)f(that)g(a)h(k)o
(e)o(y)f(type)f(missing)i(from)e Fm(Bro)h Fs(is)h(that)2049
295 y(of)h Fm(pattern)p Fs(,)j(for)d(supporting)e(re)o(gular)h(e)o
(xpression)g(matching)2049 395 y(against)20 b(te)o(xt.)k(W)-7
b(e)22 b(plan)d(to)i(add)e(patterns)h(in)g(the)h(near)e(future.)2132
496 y(Finally)-5 b(,)24 b(abo)o(v)o(e)d(we)j(alluded)f(to)h(the)f
Fm(list)g Fs(type,)h(which)f(holds)2049 595 y(zero)31
b(or)h(more)f(instances)h(of)g(a)h(v)n(alue.)59 b(Currently)-5
b(,)34 b(this)e(type)g(is)2049 695 y(not)i(directly)f(a)n(v)n(ailable)h
(to)g(the)g Fm(Bro)h Fs(script)f(writer)m(,)j(other)c(than)2049
795 y(implicitly)27 b(when)g(using)g Fm(port)h Fs(or)f
Fr(hostname)g Fs(constants.)47 b(Since)2049 894 y(its)29
b(present)f(use)g(is)h(primarily)d(internal)i(to)g(the)g(script)g
(interpreter)2049 994 y(\(when)20 b(initializing)g(v)n(ariables,)f(per)
h Fi(x)h Fs(3.3\),)f(we)h(do)f(not)g(describe)g(it)2049
1094 y(further)-5 b(.)2049 1338 y Fh(3.2)99 b(Operators)2049
1496 y Fm(Bro)27 b Fs(pro)o(vides)e(a)j(number)d(of)i(C-lik)o(e)g
(operators)f(\()p Fm(+)p Fs(,)j Fm(-)p Fs(,)g Fm(*)p
Fs(,)f Fm(/)p Fs(,)h Fm(\045)p Fs(,)2049 1596 y Fm(!)p
Fs(,)g Fm(&&)p Fs(,)f Fm(||)p Fs(,)h Fm(?:)p Fs(,)f(relationals)e(lik)o
(e)h Fm(<=)p Fs(\))g(with)g(which)f(we)i(assume)2049
1696 y(the)e(reader)f(is)i(f)o(amiliar)m(,)f(and)g(will)h(not)e(detail)
h(here.)42 b(Assignment)2049 1795 y(is)28 b(done)e(using)h
Fm(=)p Fs(,)i(table)e(and)f(set)i(inde)o(xing)d(with)i
Fm([])p Fs(,)i(and)e(func-)2049 1895 y(tion)19 b(in)m(v)n(ocation)f
(and)h(e)n(v)o(ent)g(generation)e(with)j Fm(\(\))p Fs(.)25
b(Numeric)18 b(v)n(ari-)2049 1994 y(ables)g(can)f(be)g(incremented)f
(and)h(decremented)e(using)i Fm(++)h Fs(and)f Fm(--)p
Fs(.)2049 2094 y(Record)22 b(\002elds)h(are)g(accessed)f(using)g
Fm($)p Fs(,)h(to)g(a)n(v)n(oid)g(ambiguity)d(with)2049
2194 y Fr(hostname)d Fs(constants.)23 b(Assignment)17
b(of)h(aggre)o(gate)d(v)n(alues)i(is)i Fr(shal-)2049
2293 y(low)p Fs(\227the)25 b(ne)n(wly-assigned)e(v)n(ariable)h(refers)h
(to)g(the)g(same)g(aggre-)2049 2393 y(gate)h(v)n(alue)h(as)g(the)g
(right-hand)e(side)i(of)g(the)g(assignment)f(e)o(xpres-)2049
2493 y(sion.)55 b(This)30 b(choice)g(w)o(as)h(made)e(to)h(f)o
(acilitate)h(performance;)h(we)2049 2592 y(ha)n(v)o(e)20
b(not)f(yet)i(been)e(bitten)h(by)g(the)g(semantics)g(\(which)g(dif)n
(fer)f(from)2049 2692 y(C\).)25 b(W)-7 b(e)26 b(may)f(in)g(the)g
(future)e(add)i(a)g Fm(copy)g Fs(operator)e(to)i(construct)2049
2791 y(\223deep\224)19 b(copies.)2132 2892 y(From)30
b(the)g(perspecti)n(v)o(e)e(of)i(C,)g(the)g(only)g(no)o(v)o(el)e
(operators)h(are)2049 2992 y Fm(in)f Fs(and)e Fm(!in)p
Fs(.)47 b(These)27 b(in\002x)g(operators)f(yield)h Fm(bool)g
Fs(v)n(alues)g(de-)2049 3092 y(pending)16 b(on)h(whether)g(or)g(not)h
(a)g(gi)n(v)o(en)e(inde)o(x)h(is)h(in)g(a)g(gi)n(v)o(en)f
Fm(table)2049 3191 y Fs(or)k Fm(set)p Fs(.)26 b(F)o(or)21
b(e)o(xample,)e(if)i Fm(sensitive)p 3322 3191 V 29 w(services)f
Fs(is)h(a)h Fm(set)2049 3291 y Fs(inde)o(x)o(ed)c(by)i(a)h(single)f
Fm(port)p Fs(,)f(then)2208 3459 y Ff(23/tcp)39 b(in)h
(sensitive_services)2049 3647 y Fs(returns)20 b(true)g(if)h(the)g(set)h
(has)f(an)g(element)f(corresponding)d(to)k(an)g(in-)2049
3746 y(de)o(x)c(of)h(TCP)h(port)f(23,)g(f)o(alse)g(if)h(it)g(does)f
(not)g(ha)n(v)o(e)f(such)h(an)g(element.)2049 3846 y(Similarly)-5
b(,)25 b(if)f Fm(RPC)p 2630 3846 V 30 w(okay)g Fs(is)i(a)e
Fm(set)h Fs(\(or)f Fm(table)p Fs(\))g(inde)o(x)o(ed)e(by)i(a)2049
3946 y(source)30 b(address,)i(a)f(destination)e(address,)k(and)d(an)g
(RPC)i(service)2049 4045 y(number)18 b(\(a)j Fm(count)p
Fs(\),)e(then)2129 4213 y Ff([src_addr,)38 b(dst_addr,)h(serv])g(in)g
(RPC_okay)2049 4401 y Fs(yields)34 b(true)f(if)h(the)g(gi)n(v)o(en)e
(ordered)g(triple)h(is)i(present)e(as)h(an)g(in-)2049
4501 y(de)o(x)26 b(into)h Fm(RPC)p 2507 4501 V 30 w(okay)p
Fs(.)45 b(The)27 b Fm(!in)g Fs(operator)f(simply)g(returns)h(the)2049
4600 y(boolean)19 b(ne)o(gation)f(of)i(the)g Fm(in)g
Fs(operator)-5 b(.)2132 4701 y(Presently)g(,)17 b(inde)o(xing)e(a)j
(table)g(or)f(set)h(with)g(a)g(v)n(alue)f(that)h(does)f(not)2049
4801 y(correspond)24 b(to)i(one)g(of)g(its)h(elements)f(leads)g(to)h(a)
g(run-time)d(error)m(,)2049 4901 y(so)d(such)g(operations)e(need)h(to)h
(be)g(preceded)e(by)h Fm(in)h Fs(tests.)28 b(W)-7 b(e)22
b(\002nd)2049 5000 y(this)g(not)f(entirely)f(satisfying,)h(and)g(plan)f
(to)i(add)f(a)g(mechanism)f(for)2049 5100 y(optionally)28
b(specifying)g(the)h(action)g(to)h(tak)o(e)f(in)h(such)f(cases)h(on)f
(a)2049 5199 y(per)n(-table)19 b(basis.)2132 5300 y(Finally)-5
b(,)56 b Fm(Bro)49 b Fs(includes)g(a)g(number)f(of)h(prede\002ned)e
(func-)2049 5400 y(tions)42 b(to)g(perform)e(operations)g(not)i
(directly)f(a)n(v)n(ailable)g(in)i(the)1929 5649 y(6)p
eop
%%Page: 7 7
7 6 bop -150 -104 a Fs(language.)123 b(Some)54 b(of)f(the)g(more)g
(interesting:)91 b Fm(fmt)54 b Fs(pro-)-150 -5 y(vides)40
b Fr(sprintf)12 b Fs(-style)41 b(formatting)d(for)i(use)h(in)g
(printing)e(or)h(ma-)-150 95 y(nipulating)e(strings;)50
b Fm(edit)39 b Fs(returns)g(a)h(cop)o(y)f(of)h(a)g(string)f(that)-150
194 y(has)j(been)g(edited)f(using)h(the)g(gi)n(v)o(en)f(editing)g
(characters)g(\(cur)n(-)-150 294 y(rently)54 b(it)i(only)e(kno)n(ws)h
(about)f(single-character)e(deletions\);)-150 394 y Fm(mask)p
55 394 25 4 v 29 w(addr)24 b Fs(tak)o(es)g(an)f Fm(addr)h
Fs(and)f(returns)g(another)f Fm(addr)i Fs(cor)n(-)-150
493 y(responding)34 b(to)j(its)h(top)f Fj(n)g Fs(bits;)46
b Fm(open)36 b Fs(and)h Fm(close)f Fs(manipu-)-150 593
y(late)28 b Fm(file)p Fs(s;)j Fm(network)p 639 593 V
29 w(time)c Fs(returns)g(the)g(timestamp)g(of)h(the)-150
693 y(most)41 b(recently)f(recei)n(v)o(ed)f(pack)o(et;)51
b Fm(getenv)41 b Fs(pro)o(vides)e(access)-150 792 y(to)29
b(en)m(vironment)d(v)n(ariables;)33 b Fm(skip)p 950 792
V 29 w(further)p 1329 792 V 29 w(processing)-150 892
y Fs(marks)45 b(a)g(connection)e(as)j(not)f(requiring)e(an)o(y)h
(further)g(analy-)-150 991 y(sis;)62 b Fm(set)p 177 991
V 29 w(record)p 506 991 V 29 w(packets)47 b Fs(instructs)g(the)g(e)n(v)
o(ent)g(engine)-150 1091 y(whether)g(or)h(not)g(to)g(record)f(an)o(y)h
(of)g(a)g(connection')-5 b(s)47 b(future)-150 1191 y(pack)o(ets)32
b(\(though)f(SYN/FIN/RST)i(are)g(al)o(w)o(ays)g(recorded\);)j(and)-150
1290 y Fm(parse)p 105 1290 V 29 w(ftp)p 284 1290 V 29
w(port)18 b Fs(tak)o(es)h(an)f(FTP)h(\223POR)-5 b(T\224)19
b(command)d(and)i(re-)-150 1390 y(turns)i(a)g Fm(record)g
Fs(with)g(the)h(corresponding)16 b Fm(addr)k Fs(and)g
Fm(port)p Fs(.)-150 1657 y Fh(3.3)99 b(V)-9 b(ariables)-150
1823 y Fm(Bro)28 b Fs(supports)f(tw)o(o)h(le)n(v)o(els)g(of)f(scoping:)
40 b(local)27 b(to)h(a)h(function)d(or)-150 1923 y(e)n(v)o(ent)31
b(handler)m(,)i(and)e(global)g(to)h(the)g(entire)f Fm(Bro)h
Fs(script.)60 b(Expe-)-150 2023 y(rience)28 b(has)h(already)f(sho)n(wn)
g(that)i(we)f(w)o(ould)f(bene\002t)g(by)h(adding)-150
2122 y(a)37 b(third,)i(intermediate)c(le)n(v)o(el)h(of)g(scoping,)j
(perhaps)c(as)i(part)f(of)-150 2222 y(a)f(\223module\224)d(or)j
(\223object\224)e(f)o(acility)-5 b(,)37 b(or)d(e)n(v)o(en)g(as)h
(simple)f(as)h(C')-5 b(s)-150 2321 y Fm(static)33 b Fs(scoping.)65
b(Local)33 b(v)n(ariables)g(are)h(declared)e(using)i(the)-150
2421 y(k)o(e)o(yw)o(ork)20 b Fm(local)p Fs(,)i(and)f(the)h
(declarations)f(must)g(come)h(inside)g(the)-150 2521
y(body)c(of)i(a)g(function)e(or)h(e)n(v)o(ent)g(handler)-5
b(.)24 b(There)19 b(is)i(no)e(requirement)-150 2620 y(to)31
b(declare)f(v)n(ariables)g(at)i(the)f(be)o(ginning)d(of)j(the)g
(function.)55 b(The)-150 2720 y(scope)21 b(of)h(the)g(v)n(ariable)e
(ranges)h(from)g(the)h(point)f(of)g(declaration)f(to)-150
2820 y(the)j(end)e(of)i(the)f(body)-5 b(.)30 b(Global)22
b(v)n(ariables)g(are)g(declared)g(using)g(the)-150 2919
y(k)o(e)o(yw)o(ord)28 b Fm(global)h Fs(and)g(the)g(declarations)g(must)
g(come)g(outside)-150 3019 y(of)g(an)o(y)f(function)g(bodies.)51
b(F)o(or)29 b(either)f(type)h(of)g(declaration,)h(the)-150
3118 y(k)o(e)o(yw)o(ord)17 b(can)h(be)g(replaced)f(instead)i(by)f
Fm(const)p Fs(,)g(which)g(indicates)-150 3218 y(that)i(the)g(v)n
(ariable')-5 b(s)20 b(v)n(alue)f(is)j(constant)d(and)h(cannot)f(be)h
(changed.)-67 3323 y(Syntactically)-5 b(,)19 b(a)h(v)n(ariable)f
(declaration)g(looks)h(lik)o(e:)-150 3512 y Ff({class})39
b({identifier})f([':')h({type}])g(['=')g({init}])-150
3716 y Fs(That)29 b(is,)j(a)d(class)h(\()p Fm(local)e
Fs(or)h Fm(global)g Fs(scope,)h(or)f(the)g Fm(const)-150
3816 y Fs(quali\002er\),)21 b(the)h(name)f(of)h(the)f(v)n(ariable,)g
(an)h(optional)f(type,)g(and)h(an)-150 3916 y(optional)k
(initialization)g(v)n(alue.)45 b(One)27 b(of)g(the)g(latter)g(tw)o(o)h
(must)f(be)-150 4015 y(speci\002ed.)43 b(If)26 b(both)f(are,)i(then)f
(naturally)f(the)h(type)g(of)f(the)i(initial-)-150 4115
y(ization)22 b(much)g(agree)g(with)h(the)f(speci\002ed)g(type.)32
b(If)23 b(only)e(a)i(type)g(is)-150 4215 y(gi)n(v)o(en,)e(then)g(the)h
(v)n(ariable)f(is)i(mark)o(ed)d(as)j(not)e(ha)n(ving)g(a)h(v)n(alue)f
(yet;)-150 4314 y(attempting)f(to)i(access)h(its)f(v)n(alue)f(before)g
(\002rst)h(setting)g(it)g(results)g(in)-150 4414 y(a)f(run-time)d
(error)-5 b(.)-67 4519 y(If)23 b(only)f(an)g(initializer)h(is)h
(speci\002ed,)f(then)f(Bro)h(infers)f(the)h(v)n(ari-)-150
4618 y(able')-5 b(s)19 b(type)g(from)f(the)h(form)f(of)h(the)g
(initializer)-5 b(.)25 b(This)19 b(pro)o(v)o(es)f(quite)-150
4718 y(con)m(v)o(enient,)i(as)j(does)f(the)g(ease)h(with)f(which)g
(comple)o(x)f(tables)h(and)-150 4818 y(sets)f(can)f(be)g(initialized.)
25 b(F)o(or)20 b(e)o(xample,)-150 5007 y Ff(const)39
b(IRC)h(=)f({)h(6666/tcp,)e(6667/tcp,)h(6668/tcp)g(};)-150
5211 y Fs(infers)20 b(a)g(type)g(of)g Fm(set[port])f
Fs(for)h Fm(IRC)p Fs(,)g(while:)-150 5400 y Ff(const)39
b(ftp_serv)g(=)g({)h(ftp.lbl.gov,)e(www.lbl.gov)g(};)2049
-104 y Fs(infers)33 b(a)h(type)g(of)f Fm(set[addr])f
Fs(for)i Fm(ftp)p 3393 -104 V 29 w(serv)p Fs(,)i(and)e(initial-)2049
-5 y(izes)i(it)g(to)g(consist)f(of)g(the)h(IP)f(addresses)g(for)g
Fm(ftp.lbl.gov)2049 95 y Fs(and)30 b Fm(www.lbl.gov)p
Fs(,)i(which,)g(as)g(noted)d(abo)o(v)o(e,)j(may)e(encom-)2049
194 y(pass)22 b(more)e(than)h(tw)o(o)h(addresses.)28
b(Bro)21 b(infers)g(compound)e(indices)2049 294 y(by)h(use)g(of)g
Fm([])g Fs(notation:)2049 458 y Ff(const)39 b(allowed_services)f(=)h({)
2169 537 y([ftp.lbl.gov,)e(ftp],)j([ftp.lbl.gov,)d(smtp],)2169
616 y([ftp.lbl.gov,)g(auth],)i([ftp.lbl.gov,)f(20/tcp],)2169
695 y([www.lbl.gov,)f(ftp],)j([www.lbl.gov,)d(smtp],)2169
774 y([www.lbl.gov,)g(auth],)i([www.lbl.gov,)f(20/tcp],)2169
852 y([nntp.lbl.gov,)f(nntp])2049 931 y(};)2049 1116
y Fs(results)25 b(in)g Fm(allowed)p 2736 1116 V 29 w(services)f
Fs(ha)n(ving)f(type)i Fm(set[addr,)2049 1215 y(port])p
Fs(.)47 b(Here)28 b(again,)g(the)g Fr(hostname)f Fs(constants)g(may)h
(result)f(in)2049 1315 y(more)20 b(than)f(one)h(IP)h(address.)k(An)o(y)
19 b(time)i(Bro)f(encounters)f(a)i Fm(list)2049 1415
y Fs(of)33 b(v)n(alues)g(in)h(an)g(initialization,)h(it)g(replicates)e
(the)g(correspond-)2049 1514 y(ing)22 b(inde)o(x.)31
b(Furthermore,)21 b(one)h(can)g(e)o(xplicitly)g(introduce)e(lists)k(in)
2049 1614 y(initializers)h(by)f(enclosing)f(a)i(series)g(of)f(v)n
(alues)g(\(with)g(compatible)2049 1714 y(types\))c(in)g
Fm([])p Fs(')-5 b(s,)21 b(so)f(the)g(abo)o(v)o(e)f(could)g(be)h
(written:)2049 1878 y Ff(const)39 b(allowed_services:)e(set[addr,)i
(port])g(=)h({)2169 1956 y([ftp.lbl.gov,)d([ftp,)j(smtp,)f(auth,)g
(20/tcp]],)2169 2035 y([www.lbl.gov,)e([ftp,)j(smtp,)f(auth,)g
(20/tcp]],)2169 2114 y([nntp.lbl.gov,)e(nntp])2049 2193
y(};)2049 2377 y Fs(The)18 b(only)f(cost)i(of)f(such)g(an)g
(initialization)g(is)h(that)f(Bro')-5 b(s)19 b(algorithm)2049
2477 y(for)k(inferring)e(the)i(v)n(ariable')-5 b(s)23
b(type)g(from)f(its)i(initializer)f(currently)2049 2577
y(gets)17 b(confused)d(by)i(these)h(embedded)d(lists,)k(so)f(the)f
(type)g(no)n(w)g(needs)2049 2676 y(to)k(be)g(e)o(xplicitly)g(supplied,)
f(as)h(sho)n(wn.)2132 2776 y(In)h(addition,)e(an)o(y)h(pre)n
(viously-de\002ned)d(global)j(v)n(ariable)g(can)h(be)2049
2876 y(used)j(in)h(the)f(initialization)g(of)g(a)h(subsequent)e(global)
h(v)n(ariable.)37 b(If)2049 2976 y(the)19 b(v)n(ariable)f(used)g(in)h
(this)h(f)o(ashion)e(is)i(a)f Fm(set)p Fs(,)g(then)f(its)i(indices)f
(are)2049 3075 y(e)o(xpanded)e(as)j(if)f(enclosed)g(in)g(their)g(o)n
(wn)g(list.)26 b(So)20 b(the)f(abo)o(v)o(e)f(could)2049
3175 y(be)i(further)f(simpli\002ed)h(to:)2049 3339 y
Ff(const)39 b(allowed_services:)e(set[addr,)i(port])g(=)h({)2169
3418 y([ftp_serv,)e([ftp,)h(smtp,)g(auth,)g(20/tcp]],)2169
3497 y([nntp.lbl.gov,)e(nntp])2049 3576 y(};)2049 3760
y Fs(Initializing)17 b Fm(table)g Fs(v)n(alues)g(looks)g(v)o(ery)g
(similar)m(,)g(with)h(the)g(dif)n(fer)n(-)2049 3860 y(ence)h(that)g(a)h
Fm(table)f Fs(initializer)g(includes)f(a)i Fr(yield)h
Fs(v)n(alue,)e(too.)24 b(F)o(or)2049 3959 y(e)o(xample:)2049
4123 y Ff(global)39 b(port_names)f(=)i({)2169 4202 y([7/tcp])e(=)i
("echo",)2169 4281 y([9/tcp])e(=)i("discard",)2169 4360
y([11/tcp])e(=)i("systat",)2169 4439 y(...)2049 4518
y(};)2049 4702 y Fs(which)20 b(infers)f(a)i(type)f(of)g
Fm(table[port])47 b(of)j(string)p Fs(.)2132 4802 y(W)-7
b(e)35 b(\002nd)e(that)h(these)g(forms)f(of)g(initialization)g
(shorthand)f(are)2049 4902 y(much)k(more)g(than)g(syntactic)h(sugar)-5
b(.)74 b(Because)37 b(the)o(y)f(allo)n(w)h(us)2049 5001
y(to)29 b(de\002ne)g(lar)o(ge)f(tables)i(in)f(a)g(succinct)g(f)o
(ashion,)i(by)d(referring)f(to)2049 5101 y(pre)n(viously-de\002ned)16
b(objects)j(and)g(by)h(concisely)e(capturing)g(forms)2049
5201 y(of)i(replication)e(in)j(the)f(table,)g(we)g(can)g(specify)f
(intricate)h(polic)o(y)f(re-)2049 5300 y(lationships)31
b(in)g(a)h(f)o(ashion)e(that')-5 b(s)32 b(both)e(easy)i(to)f(write)h
(and)e(easy)2049 5400 y(to)d(v)o(erify)-5 b(.)41 b(Certainly)-5
b(,)27 b(we)g(w)o(ould)f(prefer)f(the)h(\002nal)h(de\002nition)e(of)
1929 5649 y(7)p eop
%%Page: 8 8
8 7 bop -150 -104 a Fm(allowed)p 205 -104 25 4 v 29 w(services)25
b Fs(abo)o(v)o(e)f(to)i(an)o(y)g(of)f(its)i(predecessors,)f(in)-150
-5 y(terms)20 b(of)g(kno)n(wing)e(e)o(xactly)i(what)g(the)g(set)h
(consists)g(of.)-67 95 y(Along)39 b(with)h(clarity)f(and)g
(conciseness,)44 b(another)38 b(important)-150 195 y(adv)n(antage)31
b(of)h Fm(Bro)p Fs(')-5 b(s)33 b(emphasis)f(on)g(tables)g(and)g(sets)i
(is)f(speed.)-150 295 y(Consider)c(the)h(common)d(problem)h(of)i
(attempting)e(to)i(determine)-150 394 y(whether)18 b(access)h(is)h
(allo)n(wed)e(to)h(service)g Fm(S)g Fs(of)g(host)f Fm(H)p
Fs(.)h(Rather)g(than)-150 494 y(using)h(\(conceptually\):)-150
659 y Ff(if)40 b(\()f(H)h(==)g(ftp.lbl.gov)e(||)h(H)h(==)g(www.lbl.gov)
e(\))9 737 y(if)i(\()g(S)f(==)h(ftp)f(||)h(S)g(==)f(smtp)g(||)h(...)f
(\))-150 816 y(else)g(if)h(\()g(H)f(==)h(nntp.lbl.gov)e(\))9
895 y(if)i(\()g(S)f(==)h(nntp)f(\))-150 974 y(...)-150
1159 y Fs(we)21 b(can)f(simply)f(use:)-150 1324 y Ff(if)40
b(\()f([S,)h(H])f(in)h(allowed_services)d(\))49 1403
y(...)j(it's)f(okay)g(...)-150 1588 y Fs(The)23 b Fm(in)h
Fs(operation)d(translates)j(into)f(a)h(single)f(hash)g(table)h(lookup,)
-150 1687 y(a)n(v)n(oiding)17 b(the)i(cascaded)f Fm(if)p
Fs(')-5 b(s)19 b(and)f(clearly)g(sho)n(wing)g(the)h(intent)f(of)-150
1787 y(the)i(test.)-150 2028 y Fh(3.4)99 b(Statements)-150
2184 y Fm(Bro)26 b Fs(currently)e(supports)h(only)g(a)i(modest)e(group)
f(of)i(statements,)-150 2284 y(which)g(we)i(ha)n(v)o(e)e(so)h(f)o(ar)g
(found)e(suf)n(\002cient.)45 b(Along)26 b(with)h(C-style)-150
2384 y Fm(if)17 b Fs(and)g Fm(return)g Fs(and)g(e)o(xpression)e(e)n(v)n
(aluation,)h(other)g(statements)-150 2483 y(are:)38 b
Fm(print)27 b Fs(a)g(list)h(of)e(e)o(xpressions)g(to)g(a)i
Fm(file)e Fs(\()p Fr(stdout)i Fs(by)e(de-)-150 2583 y(f)o(ault\);)f
Fm(log)e Fs(a)h(list)h(of)e(e)o(xpressions;)h Fm(add)g
Fs(an)f(element)g(to)h(a)f Fm(set)p Fs(;)-150 2682 y
Fm(delete)g Fs(an)h(element)f(from)g(a)h Fm(set)g Fs(or)f(a)i
Fm(table)p Fs(;)g(and)e Fm(event)p Fs(,)-150 2782 y(which)d(generates)f
(a)i(ne)n(w)f(e)n(v)o(ent.)-67 2882 y(In)h(particular)m(,)e(the)h
(language)g(does)g(not)h(support)e(looping)g(using)-150
2982 y(a)27 b Fm(for)p Fs(-style)g(construct.)43 b(W)-7
b(e)28 b(are)f(w)o(ary)g(of)f(loops)h(in)g(e)n(v)o(ent)e(han-)-150
3082 y(dlers)33 b(because)f(the)o(y)f(can)i(lead)f(to)h(arbitrarily)e
(lar)o(ge)h(processing)-150 3181 y(delays,)c(which)e(in)h(turn)f(could)
g(lead)g(to)h(pack)o(et)g(\002lter)g(drops.)43 b(W)-7
b(e)-150 3281 y(w)o(anted)23 b(to)g(see)h(whether)e(we)i(could)e(still)
i(adequately)e(e)o(xpress)g(se-)-150 3380 y(curity)g(policies)g(in)g
Fm(Bro)g Fs(without)g(resorting)f(to)i(loops;)f(if)h(so,)g(then)-150
3480 y(we)17 b(ha)n(v)o(e)e(some)h(con\002dence)f(that)h(e)n(v)o(ery)f
(e)n(v)o(ent)g(is)i(handled)e(quickly)-5 b(.)-150 3580
y(So)23 b(f)o(ar)m(,)g(this)g(e)o(xperiment)e(has)i(been)f(successful.)
33 b(Looping)21 b(is)i(still)-150 3679 y(possible)29
b(via)g(recursion)f(\(either)g(functions)g(calling)h(themselv)o(es,)
-150 3779 y(or)23 b(e)n(v)o(ent)g(handlers)f(generating)g(their)h(o)n
(wn)g(e)n(v)o(ents\),)h(b)n(ut)f(we)h(ha)n(v)o(e)-150
3879 y(not)c(found)e(a)j(need)e(to)i(resort)f(to)g(it.)-67
3979 y(Lik)o(e)i(in)h(C,)g(we)g(can)f(group)f(sets)j(of)e(statements)g
(into)g Fr(bloc)n(ks)h Fs(by)-150 4078 y(enclosing)c(them)h(within)g
Fi(fg)p Fs(')-5 b(s.)25 b(Function)19 b(de\002nitions)g(look)g(lik)o
(e:)-150 4243 y Ff(function)39 b(endpoint_id\(h:)e(addr,)j(p:)f
(port\):)g(string)-30 4322 y({)-30 4401 y(if)g(\()h(p)g(in)f
(port_names)f(\))89 4480 y(return)h(fmt\("\045s/\045s",)f(h,)i
(port_names[p]\);)-30 4559 y(else)89 4637 y(return)f
(fmt\("\045s/\045d",)f(h,)i(p\);)-30 4716 y(})-150 4901
y Fs(Ev)o(ent)63 b(handler)f(de\002nitions)h(look)f(the)i(same)g(e)o
(xcept)e(that)-150 5001 y Fm(function)18 b Fs(is)i(replaced)d(by)i
Fm(event)f Fs(and)g(the)o(y)g(cannot)g(specify)g(a)-150
5101 y(return)h(type.)24 b(See)d(Appendix)d(A)j(for)f(an)g(e)o(xample.)
-67 5201 y(Functions)f(are)i(in)m(v)n(ok)o(ed)d(the)j(usual)f(w)o(ay)-5
b(,)20 b(as)h(e)o(xpressions)e(spec-)-150 5300 y(i\002ed)28
b(by)f(the)g(function')-5 b(s)26 b(name)h(follo)n(wed)f(by)h(its)i(ar)o
(guments)c(en-)-150 5400 y(closed)d(within)f(parentheses.)29
b(Ev)o(ents)21 b(are)h(generated)e(in)i(a)g(similar)2049
-104 y(f)o(ashion,)31 b(e)o(xcept)d(using)h(the)g(k)o(e)o(yw)o(ord)f
Fm(event)h Fs(before)f(the)h(han-)2049 -5 y(dler')-5
b(s)30 b(name)g(and)f(ar)o(gument)f(list.)56 b(Since)31
b(e)n(v)o(ents)e(do)h(not)g(return)2049 95 y(v)n(alues)17
b(\(the)o(y)f(can')o(t,)h(since)g(the)o(y)g(are)g(processed)f
(asynchronously\),)2049 194 y(e)n(v)o(ent)g(generation)e(is)k(a)e
(statement)h(in)f Fm(Bro)h Fs(and)f(not)g(an)g(e)o(xpression.)2132
299 y Fm(Bro)22 b Fs(also)f(allo)n(ws)h(\223global\224)f(statements)g
(that)h(are)f(not)h(part)f(of)g(a)2049 398 y(function)15
b(or)i(e)n(v)o(ent)f(handler)f(de\002nition.)23 b(These)16
b(are)h(e)o(x)o(ecuted)e(after)2049 498 y(parsing)30
b(the)g(full)h(script,)i(and)d(can)h(of)g(course)f(in)m(v)n(ok)o(e)f
(functions)2049 598 y(or)e(generate)e(e)n(v)o(ents.)45
b(The)26 b(e)n(v)o(ent)g(engine)g(also)h(generates)f(e)n(v)o(ents)2049
697 y(during)21 b(dif)n(ferent)f(phases)j(of)f(its)h(operation:)28
b Fm(bro)p 3555 697 V 29 w(init)22 b Fs(when)g(it)2049
797 y(is)27 b(about)f(to)g(be)o(gin)f(operation,)h Fm(bro)p
3162 797 V 29 w(done)g Fs(when)g(it)h(is)g(about)e(to)2049
896 y(terminate,)18 b(and)f Fm(bro)p 2696 896 V 30 w(signal)h
Fs(when)f(it)j(recei)n(v)o(es)d(a)i(Unix)f(signal.)2132
1001 y(One)32 b(dif)n(ference)e(between)h(de\002ning)g(functions)f(and)
i(de\002ning)2049 1100 y(e)n(v)o(ent)24 b(handlers)f(is)i(that)g
Fm(Bro)f Fs(allo)n(ws)h(multiple,)f(dif)n(ferent)f(de\002ni-)2049
1200 y(tions)j(for)g(a)h(gi)n(v)o(en)e(e)n(v)o(ent)h(handler)-5
b(.)42 b(Whene)n(v)o(er)25 b(an)i(e)n(v)o(ent)e(is)i(gen-)2049
1300 y(erated,)f(each)f(instance)h(of)f(a)h(handler)e(is)j(in)m(v)n(ok)
o(ed)c(in)j(turn)f(\(in)h(the)2049 1399 y(order)g(the)o(y)h(appear)f
(in)h(the)h(script\).)46 b(So,)29 b(for)e(e)o(xample,)g(dif)n(ferent)
2049 1499 y(\(conceptual\))f(modules)i(can)g(each)g(de\002ne)g
Fm(bro)p 3516 1499 V 29 w(init)h Fs(handlers)2049 1598
y(to)23 b(tak)o(e)f(care)g(of)h(their)f(initialization.)31
b(W)-7 b(e)24 b(\002nd)e(this)h(considerably)2049 1698
y(simpli\002es)17 b(the)g(task)h(of)e(creating)g(modular)f(sets)j(of)f
(e)n(v)o(ent)f(handlers,)2049 1798 y(b)n(ut)21 b(we)h(anticipate)f
(requiring)e(greater)i(control)f(in)h(the)h(future)e(o)o(v)o(er)2049
1897 y(the)g(e)o(xact)g(order)f(in)h(which)g Fm(Bro)g
Fs(in)m(v)n(ok)o(es)f(multiple)h(handlers.)2049 2203
y Ft(4)119 b(Implementation)30 b(issues)2049 2397 y Fs(W)-7
b(e)24 b(implemented)c(the)j(Bro)g(e)n(v)o(ent)e(engine)h(and)g(script)
g(interpreter)2049 2497 y(in)35 b(C++,)k(currently)33
b(about)g(22,000)g(lines.)69 b(In)34 b(this)i(section)e(we)2049
2597 y(discuss)40 b(some)f(of)g(the)g(signi\002cant)g(implementation)e
(decisions)2049 2696 y(and)29 b(tradeof)n(fs.)53 b(W)-7
b(e)31 b(defer)e(to)h Fi(x)g Fs(5)g(discussion)f(of)h(ho)n(w)f(Bro)h
(de-)2049 2796 y(fends)i(against)f(attacks)h(on)g(the)g(monitoring)e
(system,)35 b(and)d(post-)2049 2895 y(pone)23 b(application-speci\002c)
f(issues)k(until)e Fi(x)g Fs(6,)i(as)f(that)f(discussion)2049
2995 y(bene\002ts)c(from)f(notions)g(de)n(v)o(eloped)f(in)i
Fi(x)h Fs(5.)2132 3099 y Fl(Single-thr)o(eaded)h(design.)37
b Fs(Since)23 b(e)n(v)o(ent)g(handling)f(lies)i(at)h(the)2049
3199 y(heart)20 b(of)g(the)g(system,)h(it)g(is)g(natural)f(to)g
(consider)f(a)i(multi-threaded)2049 3299 y(design,)e(with)h(one)f
(thread)g(per)h(acti)n(v)o(e)f(e)n(v)o(ent)g(handler)-5
b(.)24 b(W)-7 b(e)21 b(ha)n(v)o(e)e(so)2049 3398 y(f)o(ar)25
b(resisted)g(this)g(approach,)e(because)h(of)h(concerns)e(that)i(it)h
(could)2049 3498 y(lead)20 b(to)g(subtle)h(race)e(conditions)g(in)i
Fm(Bro)f Fs(scripts.)2132 3602 y(An)25 b(important)f(consequence)e(of)j
(a)h(single-threaded)c(design)j(is)2049 3702 y(that)j(the)g(system)g
(must)g(be)g(careful)f(before)g(initiating)g(an)o(y)g(acti)n(v-)2049
3801 y(ity)h(that)g(may)f(potentially)f(block)h(w)o(aiting)h(for)f(a)h
(resource,)g(lead-)2049 3901 y(ing)d(to)h(pack)o(et)f(\002lter)h(drops)
e(as)j(the)e(engine)g(f)o(ails)h(to)g(consume)e(in-)2049
4001 y(coming)g(traf)n(\002c.)41 b(A)26 b(particular)e(concern)g(is)i
(performing)d(Domain)2049 4100 y(Name)18 b(System)h(\(DNS\))f(lookups,)
f(which)h(can)g(tak)o(e)g(man)o(y)f(seconds)2049 4200
y(to)24 b(complete)e(or)i(time)g(out.)35 b(Currently)-5
b(,)22 b(Bro)i(only)f(performs)f(such)2049 4299 y(lookups)k(when)h
(parsing)g(its)i(input)e(\002le,)j(b)n(ut)e(we)g(w)o(ant)g(in)f(the)h
(fu-)2049 4399 y(ture)19 b(to)g(be)f(able)h(to)g(mak)o(e)f(address)h
(and)f(hostname)g(translations)g(on)2049 4499 y(the)23
b(\003y)-5 b(,)22 b(both)g(to)h(generate)e(clearer)h(messages,)h(and)f
(to)h(detect)g(cer)n(-)2049 4598 y(tain)17 b(types)f(of)h(attacks.)24
b(Consequently)-5 b(,)15 b(Bro)i(includes)f(customized)2049
4698 y(non-blocking)d(DNS)18 b(routines)e(that)i(perform)d(DNS)j
(lookups)d(asyn-)2049 4798 y(chronously)-5 b(.)2132 4902
y(W)e(e)43 b(may)e(yet)h(adopt)f(a)h(multi-threaded)d(design.)89
b(A)42 b(more)2049 5001 y(lik)o(ely)30 b(possibility)f(is)i(e)n(v)n
(olving)d(Bro)i(to)n(w)o(ards)g(a)g(distrib)n(uted)f(de-)2049
5101 y(sign,)i(in)e(which)g(loosely-coupled,)f(multiple)g(Bro')-5
b(s)29 b(on)g(separate)2049 5201 y(processors)22 b(monitor)f(the)i
(same)g(netw)o(ork)f(link.)32 b(Each)22 b(Bro)h(w)o(ould)2049
5300 y(w)o(atch)32 b(a)h(dif)n(ferent)d(type)i(of)g(traf)n(\002c)f
(\(e.g.,)j(HTTP)f(or)f(NFS\))g(and)2049 5400 y(communicate)26
b(only)h(at)i(a)f(high)g(le)n(v)o(el,)h(to)g(con)m(v)o(e)o(y)c(current)
i(threat)1929 5649 y(8)p eop
%%Page: 9 9
9 8 bop -150 -104 a Fs(information.)266 -135 y Fn(3)-67
0 y Fl(Managing)27 b(timers.)49 b Fs(Bro)28 b(uses)g(numerous)e(timers)
i(internally)-150 100 y(for)18 b(operations)g(such)g(as)i(timing)f(out)
f(a)i(connection)c(establishment)-150 199 y(attempt.)57
b(It)31 b(sometimes)g(has)g(thousands)e(of)i(timers)g(pending)e(at)-150
299 y(a)g(gi)n(v)o(en)f(moment.)50 b(Consequently)-5
b(,)29 b(it)h(is)g(important)d(that)i(timers)-150 398
y(be)j(v)o(ery)g(lightweight:)49 b(quick)31 b(to)i(set)g(and)f(to)h(e)o
(xpire.)60 b(Our)33 b(ini-)-150 498 y(tial)f(implementation)e(used)h(a)
h(single)f(priority)g(heap,)i(which)e(we)-150 598 y(found)d(attracti)n
(v)o(e)h(since)h(insert)g(and)f(delete)h(operations)e(both)h(re-)-150
697 y(quire)19 b(only)f Fj(O)r Fc(\(log)q(\()p Fj(N)9
b Fc(\)\))21 b Fs(time)f(if)f(the)h(heap)f(contains)f
Fj(N)29 b Fs(elements.)-150 797 y(Ho)n(we)n(v)o(er)m(,)22
b(we)i(found)e(that)h(when)g(the)h(heap)f(gro)n(ws)f(quite)i(lar)o
(ge\227)-150 897 y(such)29 b(as)g(during)f(a)h(hostile)g(port)f(scan)h
(that)g(creates)g(hundreds)e(of)-150 996 y(ne)n(w)d(connections)e(each)
i(second\227then)e(this)i(o)o(v)o(erhead)e(becomes)-150
1096 y(signi\002cant.)43 b(Consequently)-5 b(,)25 b(we)i(percei)n(v)o
(ed)d(a)j(need)e(to)i(redesign)-150 1196 y(timers)21
b(to)g(bring)e(the)i(o)o(v)o(erhead)d(closer)i(to)h Fj(O)r
Fc(\(1\))p Fs(.)28 b(T)-7 b(o)21 b(achie)n(v)o(e)e(this,)-150
1295 y(Bro)25 b(is)h(no)n(w)f(in)g(the)g(process)g(of)g(being)f(con)m
(v)o(erted)f(to)i(using)g(\223cal-)-150 1395 y(endar)19
b(queues\224)g(instead)h([Br88)o(].)-67 1499 y(A)36 b(related)e(issue)i
(with)f(managing)e(timers)j(concerns)d(e)o(xactly)-150
1599 y(when)15 b(to)i(e)o(xpire)e(timers.)23 b(Bro)16
b(deri)n(v)o(es)g(its)h(notion)d(of)i(time)h(from)e(the)-150
1698 y(timestamps)28 b(pro)o(vided)d(by)j Fm(libpcap)g
Fs(with)g(each)g(pack)o(et)f(it)i(de-)-150 1798 y(li)n(v)o(ers.)d
(Whene)n(v)o(er)19 b(this)i(clock)f(adv)n(ances)g(to)h(a)g(time)g
(later)f(than)h(the)-150 1898 y(\002rst)e(element)e(on)g(the)h(timer)g
(queue,)e(Bro)i(be)o(gins)f(remo)o(ving)e(timers)-150
1997 y(from)27 b(the)h(queue)f(and)g(processing)g(their)g(e)o
(xpiration,)h(continuing)-150 2097 y(until)22 b(the)h(queue)e(is)i
(empty)f(or)g(its)i(\002rst)f(element)f(has)g(a)h(timestamp)-150
2197 y(later)29 b(than)f(the)h(current)f(time.)51 b(This)29
b(approach)d(is)k(\003a)o(wed,)g(ho)n(w-)-150 2296 y(e)n(v)o(er)m(,)i
(because)e(in)g(some)h(situations\227such)e(as)j(port)e(scans\227the)
-150 2396 y(e)n(v)o(ent)23 b(engine)g(may)g(\002nd)h(it)g(needs)g(to)g
(e)o(xpire)e(hundreds)g(of)h(timers)-150 2495 y(that)29
b(ha)n(v)o(e)e(suddenly)g(become)g(due,)j(because)e(the)g(clock)g(has)h
(ad-)-150 2595 y(v)n(anced)d(by)h(a)h(lar)o(ge)e(amount)g(due)h(to)g(a)
h(lull)g(in)f(incoming)f(traf)n(\002c.)-150 2695 y(Clearly)-5
b(,)18 b(what)h(we)h(should)d(do)i(instead)f(is)i(\(again\))d
(sacri\002ce)i(e)o(xact-)-150 2794 y(ness)k(as)g(to)g(when)f(timers)g
(are)h(e)o(xpired,)e(and)h(\(1\))f(e)o(xpire)h(at)h(most)f
Fj(k)-150 2894 y Fs(for)15 b(an)o(y)g(single)h(adv)n(ance)f(of)g(the)h
(clock,)g(and)f(\(2\))h(also)g(e)o(xpire)e(timers)-150
2994 y(when)k(there)g(has)h(been)f(a)h(processing)f(lull)h(\(as)g(this)
g(is)h(precisely)e(the)-150 3093 y(time)30 b(when)e(we)i(ha)n(v)o(e)f
(e)o(xcess)g(CPU)i(c)o(ycles)e(a)n(v)n(ailable\),)h(without)-150
3193 y(w)o(aiting)22 b(for)g(a)i(pack)o(et)e(to)g(\002nally)h(arri)n(v)
o(e)e(and)h(end)g(the)h(lull.)33 b(These)-150 3292 y(changes)22
b(are)h(also)h(part)e(of)h(our)g(current)e(re)n(visions)i(to)g(Bro')-5
b(s)24 b(timer)-150 3392 y(management.)-67 3497 y Fl(Inter)o(pr)o
(eting)d(vs.)31 b(compiling)o(.)g Fs(Presently)-5 b(,)21
b(Bro)h(interprets)g(the)-150 3596 y(polic)o(y)j(script:)38
b(that)27 b(is,)i(it)e(parses)g(the)f(script)h(into)f(a)h(tree)g(of)f
(C++)-150 3696 y(objects)i(that)h(re\003ect)f(an)g(abstract)g(syntax)g
(tree)g(\(AST\),)g(and)g(then)-150 3795 y(e)o(x)o(ecutes)i(portions)g
(of)h(the)g(tree)g(as)h(needed)e(by)h(in)m(v)n(oking)e(a)j(vir)n(-)-150
3895 y(tual)27 b(e)n(v)n(aluation)f(method)f(at)j(the)f(root)f(of)h(a)h
(gi)n(v)o(en)d(subtree.)45 b(This)-150 3995 y(method)17
b(in)h(turn)g(recursi)n(v)o(ely)e(in)m(v)n(ok)o(es)i(e)n(v)n(aluation)e
(methods)i(on)g(its)-150 4094 y(children.)-67 4199 y(Such)32
b(a)g(design)g(has)g(the)g(virtues)g(of)g(simplicity)g(and)f(ease)i(of)
-150 4298 y(deb)n(ugging,)24 b(b)n(ut)h(comes)g(at)h(the)f(cost)h(of)f
(considerable)e(o)o(v)o(erhead.)-150 4398 y(From)h(its)h(inception,)f
(we)h(intended)e Fm(Bro)h Fs(to)h(readily)e(admit)h(com-)-150
4498 y(pilation)29 b(to)h(a)f(lo)n(w-le)n(v)o(el)g(virtual)g(machine.)
51 b(Ex)o(ecution)28 b(pro\002les)-150 4597 y(of)h(the)f(current)g
(implementation)f(indicate)h(that)h(the)g(interpreti)n(v)o(e)-150
4697 y(o)o(v)o(erhead)17 b(is)j(indeed)e(signi\002cant,)h(so)h(we)g
(anticipate)f(de)n(v)o(eloping)d(a)-150 4797 y(compiler)23
b(and)h(optimizer)-5 b(.)36 b(\(The)23 b(current)g(interpreter)g(does)h
(some)-150 4896 y(simple)40 b(constant)f(folding)g(and)g(peephole)g
(optimization)f(when)-150 4996 y(b)n(uilding)19 b(the)h(AST)-6
b(,)20 b(b)n(ut)g(no)g(more.\))p -150 5086 801 4 v -65
5140 a Fk(3)-30 5163 y Fp(Some)f(systems,)g(such)g(as)g(DIDS)g(and)h
(CSM,)e(orchestrate)23 b(multiple)e(monitors)-150 5242
y(w)o(atching)g(multiple)f(netw)o(ork)h(links,)e(in)g(order)g(to)g
(track)h(users)e(as)h(the)o(y)g(mo)o(v)o(e)g(from)-150
5321 y(machine)d(to)e(machine)i([MHL94,)d(WFP96].)19
b(These)c(dif)n(fer)g(from)f(what)g(we)h(en)m(vision)-150
5400 y(for)i(Bro)g(in)h(that)g(the)o(y)g(require)g(each)h(host)e(in)g
(the)h(netw)o(ork)h(to)e(run)g(a)g(monitor)l(.)2132 -104
y Fs(Using)25 b(an)f(interpreter)f(also)i(inadv)o(ertantly)d
(introduced)g(an)j(im-)2049 -5 y(plementation)k(problem.)55
b(By)31 b(structuring)e(the)i(interpreter)e(such)2049
95 y(that)23 b(it)h(recursi)n(v)o(ely)d(in)m(v)n(ok)o(es)h(virtual)g(e)
n(v)n(aluation)f(methods)h(on)h(the)2049 194 y(AST)-6
b(,)23 b(we)h(wind)e(up)h(intricately)f(tying)h(the)g
Fm(Bro)g Fs(e)n(v)n(aluation)e(stack)2049 294 y(with)i(the)h(C++)f
(run-time)f(stack.)34 b(Consequently)-5 b(,)22 b(we)h(cannot)f(eas-)
2049 394 y(ily)f(b)n(undle)e(up)h(a)h Fm(Bro)f Fs(function')-5
b(s)19 b(e)o(x)o(ecution)f(state)j(into)f(a)h(closure)2049
493 y(to)i(e)o(x)o(ecute)f(at)i(some)f(later)g(point)f(in)i(time.)34
b(Y)-8 b(et)23 b(we)h(w)o(ould)e(lik)o(e)h(to)2049 593
y(ha)n(v)o(e)g(this)g(functionality)-5 b(,)21 b(so)j
Fm(Bro)f Fs(scripts)g(ha)n(v)o(e)g(timers)g(a)n(v)n(ailable)2049
693 y(to)e(them;)f(the)h(semantics)f(of)h(these)f(timers)h(are)g(to)f
(e)o(x)o(ecute)g(a)h(block)2049 792 y(of)k(statements)h(when)f(a)i
(timer)e(e)o(xpires,)h(including)e(access)j(to)f(the)2049
892 y(local)j(v)n(ariables)g(of)g(the)h(function)e(or)h(e)n(v)o(ent)f
(handler)g(scheduling)2049 991 y(the)23 b(timer)-5 b(.)35
b(Therefore,)22 b(adding)g(timers)h(to)h Fm(Bro)f Fs(will)h(require)e
(at)i(a)2049 1091 y(minimum)g(implementing)g(an)i(e)o(x)o(ecution)d
(stack)j(for)f Fm(Bro)h Fs(scripts)2049 1191 y(separate)20
b(from)f(that)h(of)g(the)g(interpreter)-5 b(.)2132 1295
y Fl(Checkpointing)o(.)30 b Fs(W)-7 b(e)23 b(run)e(Bro)h(continuously)e
(to)i(monitor)e(our)2049 1395 y(DMZ)d(netw)o(ork.)22
b(Ho)n(we)n(v)o(er)m(,)16 b(we)h(need)f(to)h(periodically)e(checkpoint)
2049 1495 y(its)24 b(operation,)e(both)h(to)g(reclaim)g(memory)f(tied)h
(up)g(in)g(remember)n(-)2049 1594 y(ing)16 b(state)h(for)f
(long-dormant)d(connections)h(\(because)h(we)i(don')o(t)e(yet)2049
1694 y(ha)n(v)o(e)j(timers)i(in)f(the)g(scripting)f(language;)g(see)h
(abo)o(v)o(e\),)e(and)i(to)g(col-)2049 1793 y(lect)i(a)f(snapshot)f
(for)h(archi)n(ving)e(and)h(of)n(f-line)g(analysis)h(\(discussed)2049
1893 y(belo)n(w\).)2132 1998 y(Checkpointing)15 b(is)j(currently)e(a)i
(three-stage)e(process.)24 b(First,)18 b(we)2049 2097
y(run)27 b(a)g(ne)n(w)h(instance)f(of)g(Bro)g(that)h(parses)f(the)g
(polic)o(y)g(script)g(and)2049 2197 y(resolv)o(es)d(all)h(of)f(the)g
(DNS)h(names)f(in)h(it.)38 b(Because)24 b(we)h(ha)n(v)o(e)f(non-)2049
2297 y(blocking)e(DNS)j(routines,)f(Bro)h(can)f(perform)e(a)j(lar)o(ge)
e(number)g(of)2049 2396 y(lookups)30 b(in)h(parallel,)i(as)f(well)f(as)
h(timing)f(out)f(lookup)g(attempts)2049 2496 y(whene)n(v)o(er)c(it)i
(chooses.)47 b(F)o(or)27 b(each)h(lookup,)f(it)i(compares)d(the)i(re-)
2049 2595 y(sults)e(with)e(an)o(y)g(it)i(may)e(ha)n(v)o(e)g(pre)n
(viously)f(cached)g(and)i(generates)2049 2695 y(corresponding)19
b(e)n(v)o(ents)k(\(mapping)d(v)n(alid,)j(mapping)e(un)m(v)o(eri\002ed)f
(if)2049 2795 y(it)25 b(had)e(to)i(time)f(out)g(the)g(lookup,)f(or)h
(mapping)e(changed\).)35 b(It)24 b(then)2049 2894 y(updates)19
b(the)i(DNS)f(cache)g(\002le)h(and)f(e)o(xits.)2132 2999
y(In)25 b(the)h(second)e(stage,)j(we)f(run)e(another)g(instance)h(of)g
(Bro,)i(this)2049 3099 y(time)j(specifying)e(that)i(it)g(should)e(only)
h(consult)g(the)h(DNS)g(cache)2049 3198 y(and)15 b(not)g(perform)f
(lookups.)21 b(Because)16 b(it)g(w)o(orks)f(directly)g(out)g(of)h(the)
2049 3298 y(cache,)27 b(it)g(starts)g(v)o(ery)e(quickly)-5
b(.)42 b(After)26 b(w)o(aiting)g(a)h(short)f(interv)n(al,)2049
3397 y(we)k(then)e(send)h(a)h(signal)f(to)g(the)g(long-running)c(Bro)30
b(telling)f(it)g(to)2049 3497 y(terminate.)24 b(When)c(it)h(e)o(xits,)f
(the)g(checkpointing)d(is)22 b(complete.)2132 3602 y(W)-7
b(e)31 b(\002nd)f(the)g(checkpointing)d(de\002cient)j(in)g(tw)o(o)h(w)o
(ays.)55 b(First,)2049 3701 y(it)26 b(w)o(ould)f(be)h(simpler)f(to)h
(coordinate)e(a)i(checkpoint)d(if)j(a)g(ne)n(w)g(in-)2049
3801 y(stance)33 b(of)g(Bro)g(could)f(directly)g(signal)h(an)g(old)g
(instance)g(to)g(an-)2049 3901 y(nounce)20 b(that)h(it)i(is)f(ready)f
(to)g(tak)o(e)h(o)o(v)o(er)e(monitoring.)27 b(Second,)20
b(and)2049 4000 y(more)25 b(important,)g(currently)f(no)h(state)i
(survi)n(v)o(es)d(the)i(checkpoint-)2049 4100 y(ing.)43
b(In)26 b(particular)m(,)h(if)f(the)h(older)e(Bro)i(has)f(identi\002ed)
g(some)g(sus-)2049 4199 y(pect)f(acti)n(vity)g(and)g(is)i(w)o(atching)e
(it)h(particularly)e(closely)h(\(say)-5 b(,)26 b(by)2049
4299 y(recording)16 b(all)i(of)g(its)h(pack)o(ets\),)f(this)h
(information)c(is)k(lost)g(when)f(the)2049 4399 y(ne)n(w)i(Bro)g(tak)o
(es)h(o)o(v)o(er)-5 b(.)24 b(Clearly)-5 b(,)19 b(we)i(need)e(to)i
(\002x)f(this.)2132 4503 y Fl(Off-line)30 b(analysis.)56
b Fs(As)31 b(mentioned)e(abo)o(v)o(e,)i(one)f(reason)g(for)2049
4603 y(checkpointing)j(the)i(system)h(is)h(to)f(f)o(acilitate)g(of)n
(f-line)e(analysis.)2049 4703 y(The)24 b(\002rst)i(step)f(of)f(this)h
(analysis)g(is)g(to)g(cop)o(y)f(the)g Fm(libpcap)g Fs(sa)n(v)o(e)2049
4802 y(\002le)k(and)g(an)o(y)e(\002les)j(generated)d(by)h(the)h(polic)o
(y)f(script)h(to)f(an)h(anal-)2049 4902 y(ysis)h(machine.)46
b(Our)28 b(polic)o(y)f(script)h(generates)f(six)h(such)g(\002les:)41
b(a)2049 5001 y(summary)24 b(of)h(all)h(connection)d(acti)n(vity)-5
b(,)25 b(including)f(starting)h(time,)2049 5101 y(duration,)g(size)h
(in)g(each)g(direction,)f(protocol,)g(endpoints)f(\(IP)i(ad-)2049
5201 y(dresses\),)37 b(connection)32 b(state,)37 b(and)d(an)o(y)f
(additional)f(information)2049 5300 y(\(such)23 b(as)i(username,)e
(when)h(identi\002ed\);)g(a)h(summary)d(of)i(the)g(net-)2049
5400 y(w)o(ork)f(interf)o(ace)f(and)h(pack)o(et)f(\002lter)i
(statistics;)i(a)e(list)g(of)f(all)h(gener)n(-)1929 5649
y(9)p eop
%%Page: 10 10
10 9 bop -150 -104 a Fs(ated)15 b(log)g(messages;)i(summaries)e(of)g
(Finger)g(and)f(FTP)i(commands;)-150 -5 y(and)k(a)g(list)i(of)d(all)i
(unusual)e(netw)o(orking)f(e)n(v)o(ents.)-67 99 y(Re)o(garding)k(this)j
(last,)h(the)e(e)n(v)o(ent)g(engine)f(identi\002es)i(more)e(than)-150
199 y(50)17 b(dif)n(ferent)f(types)h(of)g(unusual)f(beha)n(vior)m(,)f
(such)j(as)g(incorrect)d(con-)-150 299 y(nection)h(initiations)h(and)f
(terminations,)g(checksum)g(errors,)g(pack)o(et)-150
398 y(length)h(mismatches,)h(and)f(protocol)f(violations.)24
b(F)o(or)17 b(each,)h(it)g(gen-)-150 498 y(erates)g(a)h
Fm(conn)p 323 498 25 4 v 29 w(weird)f Fs(or)g Fm(net)p
858 498 V 29 w(weird)g Fs(e)n(v)o(ent,)f(identifying)g(the)-150
598 y(beha)n(vior)32 b(with)i(a)g(prede\002ned)d(string.)65
b(Our)33 b(polic)o(y)f(script)i(uses)-150 697 y(a)g Fm(table[string])47
b(of)j(count)33 b Fs(to)g(map)g(these)h(strings)f(to)-150
797 y(three)d(dif)n(ferent)e(v)n(alues,)k(\223ignore,)-6
b(\224)31 b(\223\002le,)-6 b(\224)33 b(and)c(\223log,)-6
b(\224)32 b(meaning)-150 896 y(ignore)20 b(the)i(beha)n(vior)e
(entirely)-5 b(,)21 b(record)f(it)j(to)e(the)h(anomaly)e(\002le,)j(or)
-150 996 y(log)g(it)i(\(real-time)e(noti\002cation\))f(and)h(record)f
(it)j(to)f(the)g(\002le.)36 b(Some)-150 1096 y(anomalies)22
b(pro)o(v)o(e)e(surprisingly)h(common,)g(and)g(on)h(a)h(typical)f(day)
-150 1195 y(the)f(anomaly)f(\002le)i(contains)f(on)g(the)g(order)f(of)i
(1,000)d(entries,)j(e)n(v)o(en)-150 1295 y(though)c(our)i(script)g
(suppresses)g(duplicate)f(messages.)-67 1399 y(All)24
b(of)e(the)h(copied)f(\002les)h(thus)g(form)f(an)h(archi)n(v)n(al)f
(record)f(of)i(the)-150 1499 y(day')-5 b(s)17 b(traf)n(\002c.)23
b(W)-7 b(e)18 b(k)o(eep)e(these)h(\002les)h(inde\002nitely)-5
b(.)22 b(The)o(y)16 b(can)g(pro)o(v)o(e)-150 1598 y(in)m(v)n(aluable)28
b(when)i(we)h(disco)o(v)o(er)e(a)h(break-in)f(that)h(\002rst)i
(occurred)-150 1698 y(weeks)19 b(or)f(months)g(in)h(the)g(past.)25
b(In)18 b(addition,)g(once)g(we)h(ha)n(v)o(e)f(iden-)-150
1798 y(ti\002ed)25 b(an)f(attacking)g(site,)i(we)f(can)f(run)g(it)h
(through)e(the)h(archi)n(v)o(e)f(to)-150 1897 y(\002nd)k(an)o(y)f
(other)h(hosts)g(it)h(may)f(ha)n(v)o(e)g(attack)o(ed)f(that)i(the)f
(monitor)n(-)-150 1997 y(ing)h(f)o(ailed)f(to)h(detect)g(\(quite)f
(common,)h(for)f(e)o(xample,)h(when)g(the)-150 2097 y(attack)o(er)d
(has)g(obtained)f(a)i(list)g(of)f(passw)o(ords)g(using)g(a)h(passw)o
(ord-)-150 2196 y(snif)n(fer\).)-67 2300 y(In)33 b(addition,)h(after)f
(each)f(checkpoint)f(the)i(analysis)g(machine)-150 2400
y(further)24 b(studies)j(the)f(traf)n(\002c)f(logs,)i(looking)e(for)g
(possible)h(attacks,)-150 2500 y(the)33 b(most)f(signi\002cant)g(being)
g(port)g(scans)g(and)g(address)g(sweeps.)-150 2599 y(W)-7
b(e)20 b(intend)f(to)g(e)n(v)o(entually)e(mo)o(v)o(e)h(this)i(analysis)
f(into)g(the)g(real-time)-150 2699 y(portion)d(of)h(the)g(system;)i
(for)e(no)n(w)-5 b(,)16 b(it)j(w)o(aits)f(upon)e(adding)g(timers)h(to)
-150 2799 y Fm(Bro)24 b Fs(so)f(we)h(can)g(time)f(out)h(connection)d
(state)j(and)f(a)n(v)n(oiding)f(con-)-150 2898 y(suming)g(huge)g
(amounts)f(of)i(memory)e(trying)h(to)h(remember)e(e)n(v)o(ery)-150
2998 y(distinct)f(port)g(and)f(address)h(to)g(which)g(each)g(host)g
(has)h(connected.)-67 3102 y(Finally)-5 b(,)28 b(the)f(of)n(f-line)f
(analysis)h(generates)f(a)i(traf)n(\002c)f(summary)-150
3202 y(highlighting)c(the)j(b)n(usiest)h(hosts)f(and)g(gi)n(ving)e(the)
i(v)n(olume)f(\(num-)-150 3301 y(ber)18 b(of)h(connections)d(and)i
(bytes)h(transferred\))d(due)i(to)h(dif)n(ferent)e(ap-)-150
3401 y(plications.)43 b(As)28 b(of)e(this)h(writing,)h(on)e(a)h
(typical)f(day)g(our)g(site)h(en-)-150 3501 y(gages)i(in)h(about)e
(600,000)g(connections)f(transferring)h(20)h(GB)i(of)-150
3600 y(data.)53 b(The)29 b(great)g(majority)g(\(75\22680\045\))e(of)i
(the)h(connections)e(are)-150 3700 y(HTTP;)16 b(the)f(highest)g(byte)g
(v)n(olume)f(comes)h(from)g(HTTP)-9 b(,)15 b(FTP)h(data,)-150
3799 y(NNTP)h(\(netw)o(ork)d(ne)n(ws\),)j(and,)f(sometimes,)h(X11,)f
(with)h(the)f(order)n(-)-150 3899 y(ing)k(among)f(them)g(v)n(ariable.)
-150 4205 y Ft(5)119 b(Attacks)30 b(on)g(the)g(monitor)-150
4399 y Fs(In)21 b(this)i(section)e(we)h(discuss)g(the)g(dif)n(\002cult)
f(problem)f(of)h(defending)-150 4499 y(the)h(monitor)f(against)h
(attacks)h(upon)e(itself.)32 b(W)-7 b(e)24 b(defer)d(discussion)-150
4598 y(of)26 b(Bro')-5 b(s)27 b(application-speci\002c)d(processing)h
(until)h(after)g(this)h(sec-)-150 4698 y(tion,)c(because)g(elements)g
(of)g(that)g(processing)f(re\003ect)h(attempts)g(to)-150
4798 y(defeat)d(the)g(types)g(of)g(attacks)g(we)h(describe)e(here.)-67
4902 y(As)28 b(discussed)f(in)g Fi(x)g Fs(1,)i(we)e(assume)g(that)h
(such)e(attack)o(ers)h(ha)n(v)o(e)-150 5001 y(full)c(access)g(to)h(the)
f(monitor')-5 b(s)21 b(algorithms)h(and)h(source)f(code;)i(b)n(ut)-150
5101 y(also)e(that)f(the)o(y)g(ha)n(v)o(e)g(control)f(o)o(v)o(er)g
(only)h(one)g(of)g(the)h(tw)o(o)f(connec-)-150 5201 y(tion)g
(endpoints.)26 b(In)21 b(addition,)f(we)i(assume)f(that)g(the)h(crack)o
(er)e(does)-150 5300 y Fr(not)f Fs(ha)n(v)o(e)e(access)h(to)g(the)g
Fm(Bro)f Fs(polic)o(y)g(script,)h(which)f(each)g(site)i(will)-150
5400 y(ha)n(v)o(e)h(customized,)e(and)i(should)f(k)o(eep)h(well)g
(protected.)2132 -104 y(While)42 b(pre)n(vious)f(w)o(ork)g(has)h
(addressed)f(the)h(general)f(prob-)2049 -5 y(lem)22 b(of)g(testing)g
(intrusion)f(detection)f(systems)j([PZCMO96)o(],)f(this)2049
95 y(w)o(ork)i(has)h(focussed)f(on)h(correctness)e(of)i(the)g(system)g
(in)g(terms)g(of)2049 194 y(whether)18 b(it)h(does)g(indeed)e
(recognize)g(the)i(attacks)g(claimed.)k(T)-7 b(o)19 b(our)2049
294 y(kno)n(wledge,)h(the)i(literature)f(does)h(not)f(contain)g(an)o(y)
g(discussion)h(of)2049 394 y(attacks)j(speci\002cally)g(aimed)f(at)h
(sub)o(v)o(erting)e(a)i(netw)o(ork)f(intrusion)2049 493
y(detection)i(system,)j(other)d(than)h(the)g(discussion)f(in)i
([PZCMO96)n(])2049 593 y(of)21 b(the)g(general)e(problem)h(of)g(the)h
(monitor)f(f)o(ailing)g(to)h(k)o(eep)g(up)f(due)2049
693 y(to)g(high)g(load.)2132 795 y(F)o(or)c(our)f(purposes,)g(we)h
(classify)h(netw)o(ork)d(monitor)h(attacks)h(into)2049
894 y(three)28 b(cate)o(gories:)42 b Fr(o)o(verload)p
Fs(,)29 b Fr(cr)o(ash)p Fs(,)i(and)d Fr(subterfug)o(e)p
Fs(.)50 b(The)29 b(re-)2049 994 y(mainder)17 b(of)h(this)h(section)g
(de\002nes)f(each)g(cate)o(gory)f(and)h(brie\003y)f(dis-)2049
1093 y(cusses)k(the)f(de)o(gree)f(to)h(which)g(Bro)g(meets)h(that)f
(class)h(of)f(threat.)2049 1345 y Fh(5.1)99 b(Ov)o(erload)25
b(attacks)2049 1505 y Fs(W)-7 b(e)24 b(term)e(an)g(attack)h(as)g(an)f
Fr(o)o(verload)i Fs(if)f(the)f(goal)g(of)h(the)f(attack)h(is)2049
1604 y(to)f(o)o(v)o(erb)n(urden)d(the)j(monitor)f(to)h(the)g(point)g
(where)f(it)i(f)o(ails)g(to)f(k)o(eep)2049 1704 y(up)h(with)g(the)g
(data)g(stream)g(it)g(must)h(process.)33 b(The)22 b(attack)h(has)g(tw)o
(o)2049 1804 y(phases,)k(the)g(\002rst)f(in)h(which)e(the)i(attack)o
(er)e(dri)n(v)o(es)h(the)g(monitor)e(to)2049 1903 y(the)i(point)f(of)h
(o)o(v)o(erload,)f(and)h(the)g(second)f(in)h(which)g(the)g(attack)o(er)
2049 2003 y(attempts)c(a)h(netw)o(ork)e(intrusion.)30
b(The)22 b(monitor)f(w)o(ould)h(ordinarily)2049 2103
y(detect)i(this)g(second)f(phase,)h(b)n(ut)f(f)o(ails)i(to)f(do)f
(so\227or)g(at)h(least)h(f)o(ails)2049 2202 y(to)20 b(do)f(so)h(with)g
(some)g(non-ne)o(gligible)c(probability\227because)g(it)21
b(is)2049 2302 y(no)27 b(longer)e(tracking)h(all)h(of)g(the)g(data)g
(necessary)f(to)h(detect)g(e)n(v)o(ery)2049 2401 y(current)19
b(threat.)2132 2504 y(It)40 b(is)g(this)g(last)h(consideration,)h(that)
e(the)f(attack)g(might)g(still)2049 2603 y(be)30 b(detected)e(because)h
(the)h(monitor)e(w)o(as)j(not)e(suf)n(\002ciently)g(o)o(v)o(er)n(-)2049
2703 y(whelmed,)18 b(that)g(complicates)g(the)g(use)h(of)f(o)o(v)o
(erload)e(attacks;)j(so,)g(in)2049 2802 y(turn,)d(this)i(pro)o(vides)d
(a)i(defensi)n(v)o(e)e(strate)o(gy)-5 b(,)16 b(namely)f(to)i(lea)n(v)o
(e)g(some)2049 2902 y(doubt)i(as)i(to)f(the)g(e)o(xact)g(po)n(wer)f
(and)h(typical)g(load)f(of)h(the)g(monitor)-5 b(.)2132
3004 y(Another)19 b(defensi)n(v)o(e)g(strate)o(gy)g(is)j(for)d(the)i
(monitor)e(to)h Fr(shed)g(load)2049 3104 y Fs(when)26
b(it)h(becomes)f(unduly)f(stressed)i(\(see)f([CT94)o(])h(for)f(a)h
(discus-)2049 3203 y(sion)f(of)g(shedding)f(load)h(in)g(a)h(dif)n
(ferent)e(conte)o(xt\).)41 b(F)o(or)26 b(e)o(xample,)2049
3303 y(the)21 b(monitor)f(might)h(decide)f(to)i(cease)f(to)h(capture)e
(HTTP)h(pack)o(ets,)2049 3403 y(as)26 b(these)g(form)e(a)i(high)e
(proportion)f(of)i(the)g(traf)n(\002c.)40 b(Of)26 b(course,)f(if)2049
3502 y(the)31 b(attack)o(er)f(kno)n(ws)h(the)g(form)f(of)g
(load-shedding)e(used)j(by)g(the)2049 3602 y(monitor)m(,)24
b(then)h(the)o(y)f(can)h(e)o(xploit)f(its)i(consequent)d(blindness)h
(and)2049 3701 y(launch)19 b(a)i(no)n(w-undetected)c(attack.)2132
3804 y(F)o(or)29 b(Bro)g(in)h(particular)m(,)f(to)h(de)n(v)o(elop)d(an)
i(o)o(v)o(erload)e(attack)i(one)2049 3903 y(might)16
b(be)o(gin)g(by)g(inspecting)g(Figure)g(1)h(to)g(see)h(ho)n(w)e(to)h
(increase)g(the)2049 4003 y(data)22 b(\003o)n(w)-5 b(.)32
b(One)23 b(step)g(is)g(to)g(send)f(pack)o(ets)h(that)f(match)h(the)f
(pack)o(et)2049 4102 y(\002lter;)35 b(another)m(,)30
b(pack)o(et)f(streams)h(that)g(in)g(turn)f(generate)f(e)n(v)o(ents;)
2049 4202 y(and)20 b(a)g(third,)g(e)n(v)o(ents)f(that)h(lead)h(to)f
(logging)e(or)i(recording)e(to)i(disk.)2132 4304 y(The)55
b(\002rst)h(of)f(these)g(is)h(particularly)e(easy)-5
b(,)63 b(because)55 b(the)2049 4404 y Fm(libpcap)26 b
Fs(\002lter)i(used)f(by)g(Bro)g(is)h(\002x)o(ed.)45 b(One)27
b(defense)f(against)2049 4503 y(it)32 b(is)g(to)f(use)g(a)g(hardw)o
(are)f(platform)f(with)i(suf)n(\002cient)g(processing)2049
4603 y(po)n(wer)23 b(to)h(k)o(eep)g(up)f(with)h(a)h(high)e(v)n(olume)g
(of)h(\002ltered)g(traf)n(\002c,)g(and)2049 4703 y(it)c(w)o(as)h(this)f
(consideration)e(that)i(lead)g(to)f(our)g(elaborating)f(the)i(goal)2049
4802 y(of)f(\223no)h(pack)o(et)f(\002lter)h(drops\224)e(in)i
Fi(x)g Fs(1.)25 b(The)19 b(second)g(le)n(v)o(el)h(of)f(attack,)2049
4902 y(causing)h(the)i(engine)e(to)h(generate)f(a)h(lar)o(ge)g(v)n
(olume)f(of)h(e)n(v)o(ents,)f(is)i(a)2049 5001 y(bit)d(more)f(dif)n
(\002cult)g(to)h(achie)n(v)o(e)f(because)g(Bro)h(e)n(v)o(ents)f(are)h
(designed)2049 5101 y(to)30 b(be)g(lightweight.)53 b(It)30
b(is)h(only)e(the)h(e)n(v)o(ents)g(for)f(which)g(the)h(pol-)2049
5201 y(ic)o(y)24 b(speci\002es)g(quite)g(a)g(bit)h(of)f(w)o(ork)f(that)
h(pro)o(vide)e(much)h(le)n(v)o(erage)2049 5300 y(for)31
b(an)h(attack)f(at)i(this)f(le)n(v)o(el,)i(and)d(we)i(do)e
Fr(not)i Fs(assume)f(that)g(the)2049 5400 y(attack)o(er)24
b(has)i(access)f(to)g(the)g(polic)o(y)f(scripts.)39 b(This)25
b(same)h(consid-)1908 5649 y(10)p eop
%%Page: 11 11
11 10 bop -150 -104 a Fs(eration)20 b(mak)o(es)i(an)f(attack)g(at)h
(the)f(\002nal)h(le)n(v)o(el\227ele)n(v)n(ating)d(the)i(log-)-150
-5 y(ging)27 b(or)g(recording)e(rate\227dif)n(\002cult,)j(because)f
(the)h(attack)o(er)f(does)-150 95 y(not)20 b(necessarily)f(kno)n(w)h
(which)f(e)n(v)o(ents)h(lead)g(to)g(logging.)-67 197
y(Finally)-5 b(,)22 b(to)g(help)g(defend)e(against)h(o)o(v)o(erload)f
(attacks,)i(the)g(e)n(v)o(ent)-150 296 y(engine)16 b(generates)f(a)i
Fm(net)p 628 296 25 4 v 30 w(stats)p 908 296 V 29 w(update)f
Fs(e)n(v)o(ent)g(e)n(v)o(ery)f Fj(T)28 b Fs(sec-)-150
396 y(onds.)c(The)18 b(v)n(alue)f(of)i(this)f(e)n(v)o(ent)g(gi)n(v)o
(es)g(the)g(number)f(of)h(pack)o(ets)g(re-)-150 496 y(cei)n(v)o(ed,)d
(the)g(number)f(dropped)f(by)i(the)g(pack)o(et)g(\002lter)h(due)f(to)g
(insuf)n(\002-)-150 595 y(cient)g(b)n(uf)n(fer)m(,)g(and)f(the)i
(number)d(reported)h(dropped)f(by)h(the)i(netw)o(ork)-150
695 y(interf)o(ace)21 b(because)g(the)g(k)o(ernel)g(f)o(ailed)h(to)f
(consume)g(them)g(quickly)-150 795 y(enough.)h(Thus,)d
Fm(Bro)g Fs(scripts)g(at)g(least)h(ha)n(v)o(e)e(some)h(basic)g
(informa-)-150 894 y(tion)28 b(a)n(v)n(ailable)g(to)h(them)f(to)h
(determine)e(whether)g(the)i(monitor)e(is)-150 994 y(becoming)18
b(o)o(v)o(erloaded.)-150 1245 y Fh(5.2)99 b(Crash)25
b(attacks)-150 1405 y Fr(Cr)o(ash)30 b Fs(attacks)f(aim)g(to)h(knock)d
(the)j(monitor)d(completely)h(out)h(of)-150 1505 y(action)17
b(by)h(causing)f(it)i(to)f(either)f(f)o(ault)h(or)g(run)f(out)h(of)g
(resources.)23 b(As)-150 1604 y(with)e(an)g(o)o(v)o(erload)d(attack,)j
(the)g(crash)g(attack)f(has)i(tw)o(o)f(phases,)g(the)-150
1704 y(\002rst)27 b(during)d(which)i(the)g(attack)o(er)f(crashes)h(the)
h(monitor)m(,)e(and)h(the)-150 1804 y(second)19 b(during)g(which)g(the)
o(y)h(then)g(proceed)e(with)j(an)f(intrusion.)-67 1906
y(Crash)25 b(attacks)g(can)g(be)f(much)g(more)g(subtle)h(than)f(o)o(v)o
(erload)e(at-)-150 2005 y(tacks,)32 b(though.)52 b(By)30
b(careful)f(source)g(code)g(analysis,)j(it)e(may)g(be)-150
2105 y(possible)g(to)g(\002nd)g(a)h(series)f(of)g(pack)o(ets,)i(or)e(e)
n(v)o(en)f(just)i(one,)h(that,)-150 2205 y(when)18 b(recei)n(v)o(ed)f
(by)h(the)h(monitor)m(,)e(causes)i(it)g(to)g(f)o(ault)g(due)f(to)g(a)h
(cod-)-150 2304 y(ing)h(error)-5 b(.)24 b(The)c(ef)n(fect)g(can)g(be)g
(immediate)f(and)h(violent.)-67 2406 y(W)-7 b(e)29 b(can)e(perhaps)f
(defend)g(against)g(this)i(form)f(of)g(crash)g(attack)-150
2506 y(by)22 b(careful)g(coding)g(and)g(testing.)33 b(Another)21
b(type)i(of)f(crash)h(attack,)-150 2606 y(harder)15 b(to)j(defend)d
(against,)i(is)g(one)g(that)g(causes)g(the)g(monitor)e(to)i(e)o(x-)-150
2705 y(haust)f(its)h(a)n(v)n(ailable)e(resources:)23
b(dynamic)14 b(memory)g(or)i(disk)g(space.)-150 2805
y(Ev)o(en)28 b(if)i(the)f(monitor)f(has)h(no)g(memory)f(leaks,)j(it)f
(still)h(needs)d(to)-150 2904 y(maintain)21 b(state)h(for)g(an)o(y)e
(acti)n(v)o(e)i(traf)n(\002c.)29 b(Therefore,)20 b(one)h(attack)h(is)
-150 3004 y(to)d(create)f(traf)n(\002c)h(that)g(consumes)f(a)h(lar)o
(ge)f(amount)f(of)i(state.)25 b(When)-150 3104 y Fm(Bro)k
Fs(supports)f(timers)h(for)g(polic)o(y)e(scripts,)32
b(this)d(attack)g(will)h(be-)-150 3203 y(come)23 b(more)g(dif)n
(\002cult,)h(because)f(it)h(will)h(be)e(harder)g(to)h(predict)f(the)
-150 3303 y(necessary)k(le)n(v)o(el)g(of)h(bogus)f(traf)n(\002c.)47
b(Attacks)28 b(on)f(disk)h(space)g(are)-150 3403 y(lik)o(e)n(wise)33
b(dif)n(\002cult,)h(unless)f(one)f(kno)n(ws)f(the)h(a)n(v)n(ailable)g
(disk)h(ca-)-150 3502 y(pacity)-5 b(.)39 b(In)25 b(addition,)g(the)g
(monitor)f(might)g(continue)g(to)h(run)g(e)n(v)o(en)-150
3602 y(with)j(no)g(disk)g(space)g(a)n(v)n(ailable,)h(sacri\002cing)f
(an)g(archi)n(v)n(al)f(record)-150 3701 y(b)n(ut)20 b(still)h
(producing)c(real-time)i(noti\002cations,)g(so)h(a)g(disk)g(space)f
(at-)-150 3801 y(tack)h(might)g(f)o(ail)g(to)h(mask)f(a)g(follo)n(w-on)
e(attack.)-67 3903 y(Bro)30 b(pro)o(vides)e(tw)o(o)i(features)f(to)g
(aid)h(with)g(defending)d(against)-150 4003 y(crash)k(attacks.)57
b(First,)34 b(the)d(e)n(v)o(ent)f(engine)f(maintains)i(a)g(\223w)o
(atch-)-150 4102 y(dog\224)23 b(timer)i(that)f(e)o(xpires)g(e)n(v)o
(ery)f Fj(T)36 b Fs(seconds.)i(\(This)24 b(timer)g(is)i(not)-150
4202 y(a)c(Bro)g(internal)f(timer)m(,)h(b)n(ut)g(rather)f(a)h(Unix)g
(\223alarm.)-6 b(\224\))29 b(Upon)21 b(e)o(xpi-)-150
4302 y(ration,)d(the)g(w)o(atchdog)g(handler)f(checks)h(to)g(see)h
(whether)f(the)g(e)n(v)o(ent)-150 4401 y(engine)28 b(has)i(f)o(ailed)f
(to)g(\002nish)h(processing)e(the)h(pack)o(et)g(\(and)f(sub-)-150
4501 y(sequent)c(e)n(v)o(ents\))h(it)g(w)o(as)h(w)o(orking)e(on)h
Fj(T)36 b Fs(seconds)25 b(before.)38 b(If)25 b(so,)-150
4601 y(then)16 b(the)g(w)o(atchdog)f(presumes)g(that)h(the)h(engine)e
(is)i(in)f(some)h(sort)f(of)-150 4700 y(processing)24
b(jam)h(\(perhaps)e(due)i(to)g(a)g(coding)f(error)m(,)g(perhaps)g(due)
-150 4800 y(to)i(e)o(xcessi)n(v)o(e)f(time)h(spent)g(managing)d(o)o(v)o
(erb)n(urdened)f(resources\),)-150 4899 y(and)d(terminates)f(the)h
(monitor)f(process)h(\(\002rst)g(logging)f(this)i(f)o(act,)f(of)-150
4999 y(course,)g(and)h(generating)e(a)j(core)e(image)h(for)f(later)i
(analysis\).)-67 5101 y(This)d(feature)g(might)f(not)h(seem)h
(particularly)d(useful,)i(e)o(xcept)f(for)-150 5201 y(the)f(f)o(act)h
(that)f(it)h(is)g(coupled)d(with)j(a)f(second)g(feature:)22
b(the)16 b(script)g(that)-150 5300 y(runs)24 b(Bro)g(also)h(detects)f
(if)h(it)g(e)n(v)o(er)e(unduly)g(e)o(xits,)i(and,)g(if)f(so,)i(logs)
-150 5400 y(this)d(f)o(act)f(and)g(then)f(e)o(x)o(ecutes)g(a)i(cop)o(y)
e(of)h Fm(tcpdump)f Fs(that)i(records)2049 -104 y(the)d(same)g(traf)n
(\002c)g(that)g(the)g(monitor)e(w)o(ould)i(ha)n(v)o(e)f(captured.)k
(Thus,)2049 -5 y(crash)k(attacks)h(are)g(\(1\))f(logged,)h(and)f(\(2\))
g(do)h(not)f(allo)n(w)h(a)g(subse-)2049 95 y(quent)18
b(intrusion)g(attempt)h(to)g(go)f(unrecorded,)e(only)j(to)g(e)n(v)n
(ade)f(real-)2049 194 y(time)26 b(detection.)42 b(Ho)n(we)n(v)o(er)m(,)
25 b(there)h(is)h(a)g(windo)n(w)e(of)h(opportunity)2049
294 y(between)i(the)g(time)h(when)f(the)h(Bro)g(monitor)e(crashes)h
(and)g(when)2049 394 y Fm(tcpdump)21 b Fs(runs.)29 b(If)22
b(an)f(attack)o(er)h(can)f(predict)g(e)o(xactly)g(when)g(this)2049
493 y(windo)n(w)i(occurs,)h(then)f(the)o(y)g(can)h(still)h(e)n(v)n(ade)
e(detection.)35 b(But)24 b(de-)2049 593 y(termining)g(the)h(windo)n(w)g
(is)h(dif)n(\002cult)f(without)g(kno)n(wledge)e(of)j(the)2049
693 y(e)o(xact)20 b(con\002guration)d(of)j(the)g(monitoring)e(system.)
2049 944 y Fh(5.3)99 b(Subterfuge)27 b(attacks)2049 1104
y Fs(In)j(a)h Fr(subterfug)o(e)e Fs(attack,)k(an)d(attack)o(er)g
(attempts)g(to)g(mislead)h(the)2049 1204 y(monitor)26
b(as)i(to)g(the)f(meaning)f(of)h(the)g(traf)n(\002c)h(it)g(analyzes.)46
b(These)2049 1303 y(attacks)30 b(are)g(particularly)e(dif)n(\002cult)i
(to)g(defend)f(against,)i(because)2049 1403 y(\(1\))26
b(unlik)o(e)g(o)o(v)o(erload)e(and)i(crash)h(attacks,)h(if)f
(successful)f(the)o(y)g(do)2049 1502 y(not)e(lea)n(v)o(e)g(an)o(y)f
(traces)i(that)f(the)o(y)f(ha)n(v)o(e)h(occurred,)f(and)h(\(2\))f(the)h
(at-)2049 1602 y(tacks)32 b(can)f(be)g(quite)g(subtle.)59
b(Access)32 b(to)g(the)f(monitor')-5 b(s)30 b(source)2049
1702 y(code)20 b(particularly)e(aids)i(with)h(de)n(vising)e(subterfuge)
f(attacks.)2132 1804 y(W)-7 b(e)33 b(brie\003y)f(discussed)g(an)g(e)o
(xample)e(of)i(a)h(subterfuge)d(attack)2049 1903 y(in)24
b Fi(x)g Fs(3.1,)g(in)g(which)f(the)h(attack)o(er)g(sends)f(te)o(xt)h
(with)g(an)g(embedded)2049 2003 y(NUL)d(in)g(the)f(hope)g(that)h(the)f
(monitor)f(will)j(miss)f(the)g(te)o(xt)f(after)h(the)2049
2103 y(NUL.)c(Another)g(form)f(of)h(subterfuge)f(attack)h(is)i(using)e
(fragmented)2049 2202 y(IP)24 b(datagrams)e(in)h(an)h(attempt)f(to)g
(elude)g(monitors)f(that)i(f)o(ail)f(to)h(re-)2049 2302
y(assemble)d(IP)h(fragments)e(\(an)h(attack)g(well-kno)n(wn)e(to)j(the)
f(\002re)n(w)o(all)2049 2401 y(community\).)26 b(The)21
b(k)o(e)o(y)g(principle)f(is)i(to)g(\002nd)f(a)h(traf)n(\002c)f
(pattern)g(in-)2049 2501 y(terpreted)28 b(by)i(the)f(monitor)f(in)i(a)g
(dif)n(ferent)e(f)o(ashion)h(than)g(by)h(the)2049 2601
y(recei)n(ving)19 b(endpoint.)2132 2703 y(T)-7 b(o)23
b(thw)o(art)f(subterfuge)e(attacks,)j(as)g(we)f(de)n(v)o(eloped)e(Bro)j
(we)f(at-)2049 2802 y(tempted)d(at)i(each)f(stage)h(to)f(analyze)f(the)
i(e)o(xplicit)e(and)h(implicit)g(as-)2049 2902 y(sumptions)h(made)g(by)
h(the)f(system,)i(and)e(ho)n(w)-5 b(,)21 b(by)h(violating)e(them,)2049
3002 y(an)31 b(attack)g(might)f(successfully)g(elude)h(detection.)56
b(This)31 b(can)g(be)2049 3101 y(a)26 b(dif)n(\002cult)g(process,)h
(though,)e(and)g(we)i(mak)o(e)e(no)h(claims)g(to)g(ha)n(v)o(e)2049
3201 y(found)17 b(them)h(all!)25 b(In)19 b(the)g(remainder)d(of)j(this)
g(section,)g(we)g(focus)f(on)2049 3301 y(subterfuge)k(attacks)i(on)g
(the)g(inte)o(grity)f(of)h(the)g(byte)g(stream)g(moni-)2049
3400 y(tored)e(for)h(a)g(TCP)h(connection.)31 b(Then,)23
b(in)g Fi(x)g Fs(6.4,)g(we)g(look)g(at)g(sub-)2049 3500
y(terfuge)c(attacks)h(aimed)g(at)h(hiding)d(k)o(e)o(yw)o(ords)h(in)h
(interacti)n(v)o(e)f(te)o(xt.)2132 3602 y(T)-7 b(o)27
b(analyze)f(a)h(TCP)g(connection)e(at)i(the)f(application)g(le)n(v)o
(el)g(re-)2049 3701 y(quires)17 b(e)o(xtracting)f(the)i(payload)e(data)
h(from)f(each)i(TCP)g(pack)o(et)f(and)2049 3801 y(reassembling)j(it)h
(into)g(its)h(proper)d(sequence.)26 b(W)-7 b(e)22 b(no)n(w)e(consider)g
(a)2049 3901 y(spectrum)k(of)i(approaches)d(to)j(this)g(problem,)e
(ranging)g(from)g(sim-)2049 4000 y(plest)d(and)e(easiest)i(to)g
(defeat,)e(to)h(increasingly)f(resilient.)2132 4102 y(Scanning)28
b(the)h(data)h(in)f(indi)n(vidual)f(pack)o(ets)h(without)g(remem-)2049
4202 y(bering)20 b(an)o(y)h(connection)f(state,)i(while)g(easiest,)h
(ob)o(viously)c(suf)n(fers)2049 4302 y(from)24 b(major)g(problems:)33
b(an)o(y)24 b(time)g(the)h(te)o(xt)g(of)f(interest)h(happens)2049
4401 y(to)e(straddle)g(the)g(boundary)d(between)i(the)h(end)f(of)h(one)
g(pack)o(et)f(and)2049 4501 y(the)g(be)o(ginning)d(of)i(the)h(ne)o(xt,)
f(the)g(te)o(xt)h(will)g(go)g(unobserv)o(ed.)k(Such)2049
4601 y(a)e(split)f(can)g(happen)e(simply)i(by)g(accident,)g(and)f
(certainly)g(by)h(ma-)2049 4700 y(licious)d(intent.)2132
4802 y(Some)48 b(systems)h(address)f(this)h(problem)e(by)h(remembering)
2049 4902 y(pre)n(viously-seen)16 b(te)o(xt)j(up)f(to)h(a)h(certain)e
(de)o(gree)f(\(perhaps)h(from)g(the)2049 5001 y(be)o(ginning)25
b(of)i(the)g(current)g(line\).)46 b(This)28 b(approach)d(f)o(ails)j(as)
g(soon)2049 5101 y(as)g(a)g(sequence)e(\223hole\224)h(appears:)39
b(that)28 b(is,)i(an)o(y)c(time)i(a)g(pack)o(et)f(is)2049
5201 y(missing\227due)d(to)i(loss)g(or)g(out-of-order)21
b(deli)n(v)o(ery\227then)i(the)j(re-)2049 5300 y(sulting)g
(discontinuity)f(in)i(the)f(data)h(stream)f(again)g(can)g(mask)h(the)
2049 5400 y(presence)19 b(of)h(k)o(e)o(y)g(te)o(xt)g(only)f(partially)h
(present.)1908 5649 y(11)p eop
%%Page: 12 12
12 11 bop -67 -104 a Fs(The)22 b(ne)o(xt)h(step)g(is)g(to)g(fully)g
(reassemble)f(the)h(TCP)g(data)g(stream,)-150 -5 y(based)c(on)g(the)g
(sequence)g(numbers)f(associated)h(with)g(each)g(pack)o(et.)-150
95 y(Doing)42 b(so)h(requires)e(maintaining)g(a)i(list)h(of)e
(contiguous)f(data)-150 194 y(blocks)27 b(recei)n(v)o(ed)f(so)i(f)o(ar)
m(,)h(and)e(\002tting)g(the)h(data)g(from)e(ne)n(w)i(pack-)-150
294 y(ets)23 b(into)e(the)h(blocks,)g(mer)o(ging)e(no)n(w-adjacent)f
(blocks)j(when)f(pos-)-150 394 y(sible.)26 b(At)21 b(an)o(y)e(gi)n(v)o
(en)h(moment,)f(one)g(can)i(then)e(scan)i(the)f(te)o(xt)h(from)-150
493 y(the)28 b(be)o(ginning)e(of)i(the)h(connection)d(to)i(the)h
(highest)e(in-sequence)-150 593 y(byte)20 b(recei)n(v)o(ed.)-67
699 y(Unless)54 b(we)g(are)f(careful,)60 b(e)n(v)o(en)53
b(k)o(eeping)f(track)h(of)g(non-)-150 798 y(contiguous)31
b(data)i(blocks)g(does)g(not)g(suf)n(\002ce)g(to)h(pre)n(v)o(ent)d(a)j
(TCP)-150 898 y(subterfuge)29 b(attack.)57 b(The)31 b(k)o(e)o(y)f
(observ)n(ation)f(is)j(that)f(an)g(attack)o(er)-150 998
y(can)20 b(manipulate)e(the)i(pack)o(ets)f(their)h(TCP)g(sends)g(so)g
(that)g(the)g(mon-)-150 1097 y(itor)i(sees)i(a)f(particular)e(pack)o
(et,)i(b)n(ut)f(the)h(endpoint)e(does)h(not.)32 b(One)-150
1197 y(w)o(ay)h(of)g(doing)f(so)h(is)h(to)g(transmit)f(the)g(pack)o(et)
f(with)i(an)f(in)m(v)n(alid)-150 1297 y(TCP)23 b(checksum.)31
b(\(This)23 b(particular)e(attack)i(can)f(be)h(dealt)f(with)h(by)-150
1396 y(checksumming)g(e)n(v)o(ery)g(pack)o(et,)j(and)f(discarding)f
(those)h(that)g(f)o(ail;)-150 1496 y(a)e(monitor)d(needs)i(to)h(do)e
(this)i(an)o(yw)o(ay)e(so)i(that)f(it)h(correctly)e(tracks)-150
1595 y(the)30 b(endpoint')-5 b(s)29 b(state)i(in)f(the)g(presence)f(of)
h(honest)g(data)g(corrup-)-150 1695 y(tion)22 b(errors,)g(which)g(are)h
(not)f(particularly)f(rare)h([P)o(a97)n(].\))32 b(Another)-150
1795 y(w)o(ay)18 b(is)g(to)g(launch)e(the)i(pack)o(et)f(with)g(an)h(IP)
g(\223T)m(ime)f(T)-7 b(o)18 b(Li)n(v)o(e\224)f(\(TTL\))-150
1894 y(\002eld)22 b(suf)n(\002cient)f(to)g(carry)g(the)g(pack)o(et)g
(past)h(the)f(monitoring)f(point,)-150 1994 y(b)n(ut)30
b(insuf)n(\002cient)f(to)h(carry)g(it)g(all)h(the)f(w)o(ay)g(to)g(the)g
(endpoint.)53 b(\(If)-150 2094 y(the)28 b(site)h(has)f(a)g(comple)o(x)e
(topology)-5 b(,)27 b(it)i(may)e(be)h(dif)n(\002cult)f(for)h(the)-150
2193 y(monitor)19 b(to)h(detect)g(this)h(attack.\))j(A)d(third)e(w)o
(ay)i(becomes)e(possible)-150 2293 y(if)27 b(the)f(\002nal)h(path)f(to)
h(the)g(attack)o(ed)f(endpoint)e(happens)h(to)i(ha)n(v)o(e)f(a)-150
2392 y(smaller)21 b(Maximum)f(T)m(ransmission)g(Unit)h(\(MTU\))g(than)f
(the)h(Inter)n(-)-150 2492 y(net)c(path)f(from)g(the)h(attack)o(er')-5
b(s)17 b(host)g(to)g(the)g(monitoring)e(point.)23 b(The)-150
2592 y(attack)o(er)c(then)h(sends)g(a)g(pack)o(et)g(with)g(a)g(size)h
(e)o(xceeding)d(this)j(MTU)-150 2691 y(and)c(with)h(the)g(IP)g
(\223Don')o(t)e(Fragment\224)g(header)h(bit)g(set.)25
b(This)18 b(pack)o(et)-150 2791 y(will)25 b(then)f(transit)g(past)h
(the)f(monitoring)e(point,)i(b)n(ut)h(be)f(discarded)-150
2891 y(by)c(the)g(router)f(at)i(the)f(point)f(where)h(the)g(MTU)g
(narro)n(ws.)-67 2996 y(By)28 b(manipulating)e(pack)o(ets)i(in)g(this)h
(f)o(ashion,)f(an)g(attack)o(er)g(can)-150 3096 y(send)38
b(innocuous)f(te)o(xt)h(for)g(the)h(bene\002t)f(of)g(the)h(monitor)m(,)
i(such)-150 3196 y(as)27 b(\223)p Fm(USER)49 b(nice)p
Fs(\224,)26 b(and)g(then)f(retransmit)g(\(using)g(the)h(same)g(se-)-150
3295 y(quence)d(numbers\))g(attack)i(te)o(xt)f(\(\223)p
Fm(USER)49 b(root)p Fs(\224\),)24 b(this)i(time)e(al-)-150
3395 y(lo)n(wing)k(the)i(pack)o(ets)f(to)g(tra)n(v)o(erse)g(all)h(the)f
(w)o(ay)h(to)f(the)h(endpoint.)-150 3495 y(If)19 b(the)h(monitor)e
(simply)h(discards)g(retransmitted)g(data)g(without)g(in-)-150
3594 y(specting)k(it,)j(then)d(it)i(will)g(mistak)o(enly)e(belie)n(v)o
(e)g(that)h(the)g(endpoint)-150 3694 y(recei)n(v)o(ed)19
b(the)h(innocuous)e(te)o(xt,)i(and)f(f)o(ail)i(to)f(detect)g(the)g
(attack.)-67 3800 y(A)30 b(defense)f(against)g(this)h(attack)f(is)i
(that)e(when)g(we)h(observ)o(e)e(a)-150 3899 y(retransmitted)d(pack)o
(et)g(\(one)g(with)h(data)g(that)g(wholly)g(or)f(partially)-150
3999 y(o)o(v)o(erlaps)20 b(pre)n(viously-seen)f(data\),)i(we)h(compare)
e(it)j(with)f(an)o(y)f(data)-150 4099 y(it)35 b(o)o(v)o(erlaps,)g(and)e
(sound)g(an)g(alarm)h(\(or)m(,)i(for)d(Bro,)k(generate)c(an)-150
4198 y(e)n(v)o(ent\))g(if)h(the)o(y)f(disagree.)65 b(A)35
b(properly-functioning)28 b(TCP)35 b(will)-150 4298 y(al)o(w)o(ays)c
(retransmit)g(the)f(same)i(data)e(as)i(originally)d(sent,)34
b(so)d(an)o(y)-150 4397 y(disagreement)25 b(is)j(either)f(due)f(to)h(a)
h(brok)o(en)d(TCP)j(\(unfortunately)-5 b(,)-150 4497
y(we)18 b(ha)n(v)o(e)f(observ)o(ed)e(some)i(of)h(these\),)f(undetected)
f(data)h(corruption)-150 4597 y(\(i.e.,)j(corruption)d(the)j(checksum)f
(f)o(ails)i(to)f(catch\),)g(or)g(an)g(attack.)-67 4703
y(W)-7 b(e)28 b(ha)n(v)o(e)e(ar)o(gued)f(that)i(the)g(monitor)e(must)i
(retain)f(a)h(record)f(of)-150 4802 y(pre)n(viously)34
b(transmitted)i(data,)k(both)35 b(in-sequence)g(and)g(out-of-)-150
4902 y(sequence.)30 b(The)22 b(question)f(no)n(w)g(arises)i(as)g(to)f
(ho)n(w)g(long)g(the)g(mon-)-150 5001 y(itor)f(must)g(k)o(eep)g(this)g
(data)g(around.)26 b(If)21 b(it)h(k)o(eeps)e(it)i(for)f(the)g(lifetime)
-150 5101 y(of)d(the)h(connection,)d(then)i(it)i(may)e(require)f
(prodigious)f(amounts)i(of)-150 5201 y(memory)25 b(an)o(y)g(time)i(it)g
(happens)e(upon)g(a)h(particularly)f(lar)o(ge)g(con-)-150
5300 y(nection;)i(these)e(are)g(not)g(infrequent)e([P)o(a94)n(].)40
b(W)-7 b(e)26 b(instead)f(w)o(ould)-150 5400 y(lik)o(e)31
b(to)g(discard)f(data)h(blocks)f(as)h(soon)g(as)g(possible,)i(to)e
(reclaim)2049 -104 y(the)g(associated)g(memory)-5 b(.)55
b(Clearly)-5 b(,)33 b(we)f(cannot)d(safely)i(discard)2049
-5 y(blocks)17 b(abo)o(v)o(e)f(a)j(sequencing)c(hole,)j(as)h(we)f(then)
f(lose)h(the)g(opportu-)2049 95 y(nity)i(to)h(scan)f(the)h(te)o(xt)f
(that)h(crosses)g(from)e(the)i(sequence)e(hole)h(into)2049
194 y(the)h(block.)28 b(But)22 b(we)g(w)o(ould)e(lik)o(e)i(to)g
(determine)e(when)g(it)i(is)h(safe)e(to)2049 294 y(discard)f
(in-sequence)e(data.)2132 397 y(Here)i(we)h(can)f(mak)o(e)g(use)h(of)f
(our)f(assumption)g(that)i(the)f(attack)o(er)2049 497
y(controls)j(only)f(one)h(of)h(the)f(connection)f(endpoints.)33
b(Suppose)23 b(the)2049 597 y(stream)30 b(of)g(interest)g(\003o)n(ws)g
(from)f(host)h Fj(A)h Fs(to)f(host)g Fj(B)t Fs(.)55 b(If)29
b(the)h(at-)2049 696 y(tack)o(er)i(controls)g Fj(B)t
Fs(,)k(then)c(the)o(y)g(are)g(unable)g(to)g(manipulate)g(the)2049
796 y(data)21 b(pack)o(ets)g(in)h(a)g(subterfuge)d(attack,)i(so)h(we)g
(can)f(safely)g(discard)2049 896 y(the)h(data)h(once)e(it)i(is)g
(in-sequence)e(and)h(we)g(ha)n(v)o(e)g(had)g(an)g(opportu-)2049
995 y(nity)e(to)h(analyze)e(it.)26 b(On)21 b(the)f(other)g(hand,)f(if)h
(the)o(y)g(control)f Fj(A)p Fs(,)i(then,)2049 1095 y(from)i(our)f
(assumption,)h(an)o(y)g(traf)n(\002c)h(we)g(see)g(from)e
Fj(B)29 b Fs(re\003ects)24 b(the)2049 1194 y(correct)16
b(functioning)f(of)i(its)i(TCP)f(\(this)f(assumes)h(that)f(we)h(use)g
(anti-)2049 1294 y(spoo\002ng)f(\002lters)j(so)f(that)g(the)g(attack)o
(er)f(cannot)g(for)o(ge)f(bogus)h(traf)n(\002c)2049 1394
y(purportedly)g(coming)h(from)h Fj(B)t Fs(\).)27 b(In)21
b(particular)m(,)e(we)i(can)f(trust)h(that)2049 1493
y(if)f(we)g(see)h(an)f(ackno)n(wledgement)c(from)j Fj(B)24
b Fs(for)c(sequence)e(number)2049 1593 y Fj(n)p Fs(,)26
b(then)e(indeed)f Fj(B)29 b Fs(has)c(recei)n(v)o(ed)e(all)i(data)g(in)f
(sequence)g(up)g(to)g Fj(n)p Fs(.)2049 1693 y(At)d(this)f(point,)g
Fj(B)t Fs(')-5 b(s)21 b(TCP)g(will)g(deli)n(v)o(er)m(,)d(or)i(has)h
(already)e(deli)n(v)o(ered,)2049 1792 y(this)24 b(data)f(to)h(the)f
(application)f(running)f(on)i Fj(B)t Fs(.)35 b(In)23
b(particular)m(,)f Fj(B)t Fs(')-5 b(s)2049 1892 y(TCP)31
b(cannot)e(accept)h(an)o(y)f(retransmitted)g(data)h(belo)n(w)g
(sequence)2049 1991 y Fj(n)p Fs(,)24 b(as)g(it)f(has)h(already)e
(indicated)g(it)h(has)h(no)e(more)h(interest)g(in)g(such)2049
2091 y(data.)h(Therefore,)15 b(when)h(the)i(monitor)d(sees)j(an)f
(ackno)n(wledgement)2049 2191 y(for)k Fj(n)p Fs(,)h(it)g(can)f(safely)h
(release)f(an)o(y)g(memory)f(associated)h(with)h(data)2049
2290 y(up)e(to)g(sequence)f Fj(n)p Fs(.)2049 2591 y Ft(6)119
b(A)m(pplication-speci\002c)33 b(pr)n(ocessing)2049 2784
y Fs(W)-7 b(e)27 b(\002nish)f(our)f(o)o(v)o(ervie)n(w)f(of)i(Bro)g
(with)g(a)h(discussion)e(of)h(the)g(ad-)2049 2883 y(ditional)k
(processing)f(it)i(does)f(for)f(the)i(four)e(applications)g(it)i(cur)n
(-)2049 2983 y(rently)g(kno)n(ws)f(about:)47 b(Finger)m(,)32
b(FTP)-9 b(,)32 b(Portmapper)m(,)f(and)g(T)-6 b(elnet.)2049
3082 y(Admittedly)21 b(these)g(are)h(just)g(a)h(small)f(portion)e(of)h
(the)h(dif)n(ferent)e(In-)2049 3182 y(ternet)29 b(applications)g(used)h
(in)f(attacks,)k(and)c(Bro')-5 b(s)30 b(ef)n(fecti)n(v)o(eness)2049
3282 y(will)22 b(bene\002t)f(greatly)g(as)i(more)d(are)i(added.)28
b(F)o(ortunately)-5 b(,)19 b(we)j(ha)n(v)o(e)2049 3381
y(in)17 b(general)f(found)f(that)j(the)f(system)g(meets)g(our)f(goal)h
(of)g(e)o(xtensibil-)2049 3481 y(ity)23 b(\()p Fi(x)g
Fs(1\),)g(and)f(adding)g(ne)n(w)g(applications)g(to)h(Bro)g
(is\227other)f(than)2049 3581 y(the)30 b(sometimes)g(major)f(headache)f
(of)i(rob)n(ustly)f(interpreting)f(the)2049 3680 y(application)c
(protocol)g(itself\227quite)h(straight-forw)o(ard,)f(a)i(matter)2049
3780 y(of)k(deri)n(ving)e(a)j(C++)g(class)g(to)f(analyze)g(each)g
(connection')-5 b(s)28 b(traf-)2049 3879 y(\002c,)23
b(and)f(de)n(vising)f(a)h(set)h(of)f(e)n(v)o(ents)g(corresponding)d(to)
j(signi\002cant)2049 3979 y(elements)e(of)g(the)g(application.)2049
4237 y Fh(6.1)99 b(Finger)2049 4400 y Fs(The)33 b(\002rst)i(of)e(the)h
(applications)f(is)h(the)g(Finger)f(\223User)h(Informa-)2049
4500 y(tion\224)22 b(service)f([Zi91)o(].)30 b(Structurally)-5
b(,)20 b(Finger)h(is)i(v)o(ery)e(simple:)29 b(the)2049
4599 y(connection)i(originator)f(sends)j(a)g(single)g(line,)i
(terminated)d(by)g(a)2049 4699 y(carriage-return)20 b(line-feed,)i
(specifying)f(the)i(user)g(for)f(which)g(the)o(y)2049
4799 y(request)28 b(information.)50 b(An)29 b(optional)f(\003ag)h
(requests)g(\223full\224)g(\(v)o(er)n(-)2049 4898 y(bose\))g(output.)54
b(The)29 b(responder)f(returns)h(whate)n(v)o(er)g(information)2049
4998 y(it)c(deems)f(appropriate)f(in)h(multiple)g(lines)h(of)f(te)o
(xt,)i(after)e(which)g(it)2049 5097 y(closes)d(the)f(connection.)2132
5201 y(Bro)37 b(generates)f(a)h Fm(finger)p 3024 5201
25 4 v 28 w(request)f Fs(e)n(v)o(ent)g(whene)n(v)o(er)f(it)2049
5300 y(monitors)18 b(a)i(complete)e(Finger)h(request.)24
b(A)c(handler)e(for)h(this)g(e)n(v)o(ent)2049 5400 y(looks)h(lik)o(e:)
1908 5649 y(12)p eop
%%Page: 13 13
13 12 bop -150 -104 a Ff(event)39 b(finger_request\(c:)e(connection,)
448 -26 y(user:)i(string,)g(full:)g(bool\))-150 130 y
Fs(Our)18 b(site')-5 b(s)20 b(polic)o(y)d(for)h(Finger)g(requests)g
(includes)g(testing)g(for)g(pos-)-150 230 y(sible)j(b)n(uf)n(fer)n(-o)o
(v)o(er\003o)n(w)16 b(attacks)21 b(and)e(checking)g(the)h(user)g
(against)g(a)-150 329 y(list)27 b(of)e(sensiti)n(v)o(e)h(user)g(ID')-5
b(s,)27 b(such)f(as)g(pri)n(vile)o(ged)e(accounts.)41
b(See)-150 429 y(Appendix)26 b(A)i(for)f(a)h(discussion)f(of)h(ho)n(w)f
(the)h(Finger)f(analysis)h(is)-150 528 y(inte)o(grated)19
b(into)g(Bro.)-67 628 y(Bro)89 b(currently)f(does)h(not)g(generate)f
(an)h(analogous)-150 728 y Fm(finger)p 155 728 25 4 v
29 w(reply)35 b Fs(e)n(v)o(ent.)68 b(T)-7 b(w)o(o)36
b(reasons)e(for)h(this)h(are)f(\(1\))f(we)-150 827 y(vie)n(w)f(the)g
(primary)e(threat)h(of)h(Finger)f(to)h(come)f(from)g(the)h(orig-)-150
927 y(inator)i(and)g(not)g(the)h(responder)m(,)h(so)f(adding)e
Fm(finger)p 1578 927 V 29 w(reply)-150 1027 y Fs(has)j(had)e(a)i(lo)n
(wer)f(priority)-5 b(,)39 b(and)d(\(2\))f(manipulating)f(multi-line)
-150 1126 y(strings)42 b(in)f Fm(Bro)h Fs(is)h(clumsy)e(at)h(present,)k
(because)41 b Fm(Bro)h Fs(does)-150 1226 y(not)29 b(ha)n(v)o(e)g(an)h
(iteration)f(operator)e(for)i(easily)h(mo)o(ving)e(through)f(a)-150
1325 y Fm(table[count])48 b(of)h(string)p Fs(.)-67 1425
y(A)19 b(\002nal)g(note:)24 b(if)19 b(the)f(e)n(v)o(ent)g(engine)f
(\002nds)i(that)g(the)f(polic)o(y)g(script)-150 1525
y(does)26 b(not)g(de\002ne)g(a)h Fm(finger)p 761 1525
V 29 w(request)f Fs(handler)m(,)g(then)g(it)h(does)-150
1624 y(not)21 b(bother)g(creating)f(Finger)n(-speci\002c)h(analyzers)g
(for)g(ne)n(w)g(Finger)-150 1724 y(connections.)35 b(In)23
b(general,)h(the)g(e)n(v)o(ent)f(engine)g(tries)i(to)f(determine)-150
1824 y(as)d(early)f(as)g(possible)g(whether)f(the)i(user)f(has)g
(de\002ned)f(a)i(particular)-150 1923 y(handler)m(,)h(and,)i(if)f(not,)
h(a)n(v)n(oids)f(undertaking)e(the)i(w)o(ork)g(associated)-150
2023 y(with)d(generating)f(the)h(corresponding)c(e)n(v)o(ent.)-150
2256 y Fh(6.2)99 b(FTP)-150 2411 y Fs(The)30 b(File)h(T)m(ransfer)f
(Protocol)f([PR85)o(])i(is)g(much)f(more)f(comple)o(x)-150
2511 y(than)h(the)g(Finger)f(protocol;)k(it)e(also,)h(ho)n(we)n(v)o(er)
m(,)e(is)h(highly)e(struc-)-150 2610 y(tured)34 b(and)g(easy)h(to)g
(parse,)j(so)d(interpreting)e(an)h(FTP)i(dialog)e(is)-150
2710 y(straight-forw)o(ard.)-67 2810 y(F)o(or)28 b(FTP)h(requests,)i
(Bro)d(parses)h(each)f(line)h(sent)g(by)f(the)g(con-)-150
2909 y(nection)22 b(originator)e(into)j(a)g(command)e(\(\002rst)i(w)o
(ord\))f(and)g(an)g(ar)o(gu-)-150 3009 y(ment)28 b(\(the)g
(remainder\),)f(splitting)h(the)h(tw)o(o)f(at)h(the)f(\002rst)h
(instance)-150 3109 y(of)f(whitespace)f(it)i(\002nds,)h(and)e(con)m(v)o
(erting)d(the)j(command)e(to)i(up-)-150 3208 y(percase)20
b(\(to)g(circumv)o(ent)e(problems)g(such)i(as)h(a)g(polic)o(y)e(script)
h(test-)-150 3308 y(ing)i(for)g(\223store)g(\002le\224)h(commands)e(as)
i Fm(STOR)f Fs(or)h Fm(stor)p Fs(,)f(and)g(an)g(at-)-150
3407 y(tack)o(er)j(instead)g(sending)f Fm(stOR)p Fs(,)g(which)h(the)g
(remote)g(FTP)g(serv)o(er)-150 3507 y(will)32 b(happily)e(accept\).)57
b(It)31 b(then)g(generates)f(an)h Fm(ftp)p 1478 3507
V 29 w(request)-150 3607 y Fs(e)n(v)o(ent)24 b(with)h(these)g(and)f
(the)h(corresponding)c(connection)i(as)i(ar)o(gu-)-150
3706 y(ments.)-67 3806 y(FTP)20 b(replies)f(be)o(gin)g(with)g(a)h
(status)g(code)f(\(a)h(number\),)d(follo)n(wed)-150 3906
y(by)f(an)o(y)g(accompan)o(ying)d(te)o(xt.)23 b(Replies)18
b(also)e(can)h(indicate)f(whether)-150 4005 y(the)o(y)24
b(continue)f(to)i(another)e(line.)38 b(Accordingly)-5
b(,)23 b(for)h(each)g(line)h(of)-150 4105 y(reply)31
b(the)i(e)n(v)o(ent)e(engine)g(generates)g(an)h Fm(ftp)p
1263 4105 V 29 w(reply)g Fs(with)h(the)-150 4204 y(code,)25
b(the)f(te)o(xt,)h(a)g(\003ag)g(indicating)e(continuation,)g(and)h(the)
h(corre-)-150 4304 y(sponding)18 b(connection)g(as)j(ar)o(guments.)-67
4404 y(As)35 b(f)o(ar)f(as)h(the)f(e)n(v)o(ent)f(engine)g(is)i
(concerned,)g(that')-5 b(s)34 b(it\227100)-150 4503 y(lines)18
b(of)g(straight-forw)o(ard)d(C++.)24 b(What)19 b(is)f(interesting)f
(about)g(FTP)-150 4603 y(is)32 b(that)f(all)h(the)f(remaining)f(w)o
(ork)g(can)h(be)g(done)f(in)i Fm(Bro)f Fs(\(about)-150
4703 y(300)d(lines)g(for)g(our)g(site\).)50 b(The)29
b Fm(ftp)p 983 4703 V 29 w(request)f Fs(handler)f(k)o(eeps)-150
4802 y(track)k(of)f(distinct)i(FTP)f(sessions,)j(pulls)e(out)e
(usernames)g(to)i(test)-150 4902 y(against)26 b(a)h(list)g(of)g
(sensiti)n(v)o(e)f(ID')-5 b(s)27 b(\(and)f(to)g(annotate)g(the)g
(connec-)-150 5001 y(tion')-5 b(s)24 b(general)f(summary\),)g(and,)h
(for)f(an)o(y)g(FTP)i(request)e(that)h(ma-)-150 5101
y(nipulates)29 b(a)i(\002le,)i(checks)c(for)h(access)g(to)h(sensiti)n
(v)o(e)e(\002les.)56 b(Some)-150 5201 y(of)23 b(these)g(checks)g
(depend)e(on)i(conte)o(xt;)h(for)e(e)o(xample,)h(a)g(guest)g(\(or)-150
5300 y(\223anon)o(ymous\224\))i(user)k(should)f(not)g(attempt)g(to)h
(manipulate)f(user)n(-)-150 5400 y(con\002guration)18
b(\002les,)i(while)h(for)e(other)h(users)g(doing)f(so)h(is)h(\002ne.)
2132 -104 y(A)f(\002nal)g(analysis)f(step)h(for)f Fm(ftp)p
3093 -104 V 29 w(request)g Fs(e)n(v)o(ents)g(is)h(to)g(parse)2049
-5 y(an)o(y)i Fm(PORT)g Fs(request)g(to)h(e)o(xtract)f(the)g(hostname)g
(and)g(TCP)h(port)f(as-)2049 95 y(sociated)f(with)g(an)h(upcoming)c
(transfer)-5 b(.)28 b(\(The)21 b(FTP)h(protocol)d(uses)2049
194 y(multiple)28 b(TCP)i(connections,)f(one)g(for)f(the)h(control)f
(information)2049 294 y(such)g(as)h(user)f(requests,)i(and)e(others,)h
(dynamically)e(created,)i(for)2049 394 y(each)34 b(data)f(transfer)-5
b(.\))65 b(This)34 b(is)h(an)f(important)e(step,)38 b(because)33
b(it)2049 493 y(enables)27 b(the)g(script)g(to)g(tell)h(which)e
(subsequent)g(connections)f(be-)2049 593 y(long)h(to)g(this)i(FTP)f
(session)g(and)f(which)g(do)g(not.)44 b(A)27 b(site')-5
b(s)28 b(polic)o(y)2049 693 y(might)d(allo)n(w)h(FTP)g(access)h(to)f
(particular)e(serv)o(ers,)j(b)n(ut)e(an)o(y)g(other)2049
792 y(access)f(to)f(those)g(serv)o(ers)f(merits)i(an)f(alarm;)h(b)n(ut)
f(without)g(parsing)2049 892 y(the)c Fm(PORT)h Fs(request,)e(it)j(can)e
(be)g(impossible)g(to)h(distinguish)e(a)i(le)o(git-)2049
991 y(imate)j(FTP)g(data)f(transfer)g(connection)f(from)g(an)i
(illicit,)h(non-FTP)2049 1091 y(connection.)54 b(Consequently)-5
b(,)30 b(the)h(script)f(k)o(eeps)h(track)f(of)g(pend-)2049
1191 y(ing)23 b(data)h(transfer)e(connections,)g(and)h(when)g(it)h
(encounters)e(them,)2049 1290 y(marks)g(them)g(as)h Fm(ftp-data)f
Fs(applications,)f(e)n(v)o(en)g(if)i(the)o(y)f(do)g(not)2049
1390 y(use)j(the)g(well-kno)n(wn)e(port)i(associated)g(with)g(such)f
(transfers)h(\(the)2049 1490 y(standard)19 b(does)h(not)g(require)f
(them)g(to)i(do)f(so\).)2132 1592 y(W)-7 b(e)18 b(also)f(note)f(that,)h
(in)g(addition)f(to)g(correctly)g(identifying)e(FTP-)2049
1692 y(related)30 b(traf)n(\002c,)i(parsing)d Fm(PORT)h
Fs(requests)g(mak)o(es)g(it)h(possible)e(to)2049 1792
y(detect)e(\223FTP)h(bounce\224)d(attacks.)47 b(In)27
b(these)g(attacks,)i(a)f(malicious)2049 1891 y(FTP)j(client)g
(instructs)g(an)g(FTP)g(serv)o(er)g(to)g(open)e(a)j(data)e(transfer)
2049 1991 y(connection)f(not)i(back)f(to)i(it,)i(b)n(ut)d(to)h(a)f
(third,)i(victim)e(site.)59 b(The)2049 2091 y(client)25
b(can)f(thus)h(manipulate)e(the)h(serv)o(er)g(into)h(uploading)d(data)i
(to)2049 2190 y(an)e(arbitrary)e(service)h(on)h(the)g(victim)f(site,)i
(or)f(to)g(ef)n(fecti)n(v)o(ely)e(port-)2049 2290 y(scan)h(the)g
(victim)g(site)h(\(which)e(the)h(client)g(does)g(by)g(using)f(multiple)
2049 2389 y(bogus)30 b Fm(PORT)g Fs(requests)h(and)f(observing)f(the)i
(completion)e(status)2049 2489 y(of)20 b(subsequent)f(data-transfer)g
(requests\).)25 b(Our)20 b(script)h(\003ags)g Fm(PORT)2049
2589 y Fs(requests)d(that)g(attempt)f(an)o(y)h(redirection)e(of)h(the)h
(data)g(transfer)f(con-)2049 2688 y(nection.)41 b(Interestingly)-5
b(,)25 b(we)h(added)f(this)i(check)e(mostly)g(because)2049
2788 y(it)f(w)o(as)g(easy)f(to)h(do)e(so;)j(months)e(later)m(,)g(we)h
(monitored)d(the)i(\002rst)h(of)2049 2888 y(se)n(v)o(eral)c(subsequent)
e(FTP)j(bounce)e(attacks.)2132 2990 y(F)o(or)26 b Fm(ftp)p
2428 2990 V 29 w(reply)f Fs(e)n(v)o(ents,)i(most)f(of)g(the)g(w)o(ork)f
(is)i(simply)e(for)n(-)2049 3090 y(matting)h(a)i(succinct)e(one-line)g
(summary)g(of)h(the)g(request)f(and)h(its)2049 3190 y(result)f(for)f
(recording)e(in)i(the)h(FTP)g(acti)n(vity)f(log.)41 b(In)25
b(addition,)h(an)2049 3289 y(FTP)19 b Fm(PASV)f Fs(request)g(has)g(a)h
(structure)f(similar)g(to)h(a)f Fm(PORT)g Fs(request,)2049
3389 y(e)o(xcept)c(that)i(the)f(FTP)h(serv)o(er)f(instead)g(of)g(the)g
(client)g(determines)g(the)2049 3489 y(speci\002cs)22
b(of)g(the)f(subsequent)f(data)i(transfer)f(connection.)27
b(Conse-)2049 3588 y(quently)16 b(our)h(script)h(subjects)g
Fm(PASV)f Fs(replies)h(to)g(the)g(same)g(analysis)2049
3688 y(as)24 b Fm(PORT)f Fs(requests.)34 b(Finally)-5
b(,)24 b(there)f(is)h(nothing)e(to)h(pre)n(v)o(ent)f(a)i
Fr(dif-)2049 3787 y(fer)m(ent)i Fs(remote)d(host)h(from)f(connecting)f
(to)j(the)f(data)g(transfer)f(port)2049 3887 y(of)n(fered)14
b(by)h(a)g(serv)o(er)g(via)g(a)h Fm(PASV)f Fs(reply)-5
b(.)22 b(It)16 b(is)g(hard)f(to)h(see)g(why)e(this)2049
3987 y(might)k(actually)g(occur)m(,)f(b)n(ut)h(putting)f(in)i(a)g(test)
g(for)f(it)h(is)g(simple)g(\(un-)2049 4086 y(fortunately)-5
b(,)21 b(there)h(are)h(some)g(f)o(alse)g(alarms)g(due)f(to)h
(multi-homed)2049 4186 y(clients;)h(we)f(use)f(heuristics)g(to)h
(reduce)e(these\);)i(and,)f(indeed,)g(se)n(v-)2049 4286
y(eral)29 b(months)e(after)h(adding)g(it,)j(it)e(triggered,)g(due)f(to)
h(an)f(attack)o(er)2049 4385 y(using)20 b(3-w)o(ay)f(FTP)i(as)g(\(e)n
(vidently\))d(a)i(w)o(ay)h(to)f(disguise)g(their)g(trail.)2049
4640 y Fh(6.3)99 b(P)n(ortmapper)2049 4802 y Fs(Man)o(y)26
b(services)h(based)g(on)g(Remote)g(Procedure)e(Call)k(\(RPC;)f(de-)2049
4902 y(\002ned)16 b(in)g([Sr95a)o(]\))g(do)f(not)h(listen)h(for)e
(requests)h(on)g(a)h(\223well-kno)n(wn\224)2049 5001
y(port,)k(b)n(ut)g(rather)g(pick)g(an)g(arbitrary)f(port)h(when)f
(initialized.)29 b(The)o(y)2049 5101 y(then)22 b(re)o(gister)g(this)h
(port)f(with)h(a)g(Portmapper)d(service)j(running)d(on)2049
5201 y(the)32 b(same)h(machine.)60 b(Only)32 b(the)g(Portmapper)e
(needs)i(to)g(run)g(on)2049 5300 y(a)24 b(well-kno)n(wn)e(port;)j(when)
f(clients)g(w)o(ant)g(access)g(to)g(the)g(service,)2049
5400 y(the)o(y)16 b(\002rst)i(contact)f(the)g(Portmapper)m(,)e(and)h
(it)i(tells)g(them)f(which)f(port)1908 5649 y(13)p eop
%%Page: 14 14
14 13 bop -150 -104 a Fs(the)o(y)24 b(should)g(then)g(contact)g(in)h
(order)e(to)i(reach)f(the)g(service.)38 b(This)-150 -5
y(second)25 b(port)g(may)g(be)h(for)f(TCP)h(or)g(UDP)g(access)g
(\(depending)d(on)-150 95 y(which)d(the)g(client)g(requests)g(from)f
(the)h(Portmapper\).)-67 197 y(Thus,)d(by)h(monitoring)d(Portmapper)g
(traf)n(\002c,)j(we)g(can)f(detect)g(an)o(y)-150 296
y(attempted)e(access)i(to)g(a)f(number)f(of)h(sensiti)n(v)o(e)g(RPC)i
(services,)f(such)-150 396 y(as)j(NFS)h(and)e(YP)-9 b(,)19
b(e)o(xcept)g(in)g(cases)i(where)e(the)g(attack)o(er)g(learns)h(the)
-150 496 y(port)g(for)f(those)h(services)g(some)g(other)g(w)o(ay)g
(\(e.g.,)f(port-scanning\).)-67 597 y(The)39 b(Portmapper)e(service)i
(is)h(itself)g(b)n(uilt)g(on)e(top)h(of)g(RPC,)-150 697
y(which)29 b(in)i(turn)e(uses)h(the)g(XDR)h(External)e(Data)h
(Representation)-150 797 y(Standard)23 b([Sr95b)n(].)36
b(Furthermore,)23 b(one)g(can)h(use)g(RPC)i(on)d(top)h(of)-150
896 y(either)f(TCP)i(or)e(UDP)-9 b(,)24 b(and)f(typically)g(the)h
(Portmapper)e(listens)i(on)-150 996 y(both)30 b(a)i(well-kno)n(wn)d
(TCP)j(port)e(and)h(a)g(well-kno)n(wn)f(UDP)h(port)-150
1096 y(\(both)21 b(are)h(port)f(111\).)29 b(Consequently)-5
b(,)20 b(adding)g(Portmapper)g(anal-)-150 1195 y(ysis)29
b(to)g(Bro)f(required)f(adding)g(a)i(generic)e(RPC)j(analyzer)m(,)f
(TCP-)-150 1295 y(and)22 b(UDP-speci\002c)h(analyzers)f(to)h(unwrap)e
(the)i(dif)n(ferent)e(w)o(ays)i(in)-150 1394 y(which)34
b(RPCs)i(are)e(embedded)e(in)i(TCP)h(and)f(UDP)g(pack)o(ets,)k(an)-150
1494 y(XDR)21 b(analyzer)m(,)d(and)i(a)h(Portmapper)n(-speci\002c)c
(analyzer)-5 b(.)-67 1596 y(This)32 b(last)g(generates)f(six)h(pairs)f
(of)g(e)n(v)o(ents,)j(one)d(for)g(each)g(re-)-150 1696
y(quest)23 b(and)f(reply)g(for)h(the)g(six)g(actions)g(the)g
(Portmapper)e(supports:)-150 1795 y(a)27 b(null)f(call;)j(add)d(a)h
(binding)d(between)h(a)i(service)f(and)g(a)g(port;)j(re-)-150
1895 y(mo)o(v)o(e)21 b(a)h(binding;)f(look)h(up)f(a)i(binding;)e(dump)g
(the)h(entire)g(table)g(of)-150 1994 y(bindings;)c(and)f(both)h(look)f
(up)h(a)g(service)g(and)g(call)g(it)h(directly)f(with-)-150
2094 y(out)h(requiring)f(a)i(second)e(connection.)23
b(\(This)c(last)i(is)f(a)g(monitoring)-150 2194 y(headache)i(because)g
(it)i(means)f(an)o(y)f(RPC)j(service)e(can)g(potentially)-150
2293 y(be)d(accessed)g(directly)g(through)e(a)i(Portmapper)e
(connection.\))-67 2395 y(Our)37 b(polic)o(y)f(script)i(for)f
(Portmapper)e(traf)n(\002c)i(again)g(is)h(f)o(airly)-150
2495 y(lar)o(ge,)i(more)d(than)g(200)f(lines.)76 b(Most)38
b(of)f(this)h(concerns)e(what)-150 2594 y(Portmapper)17
b(requests)j(we)g(allo)n(w)f(between)g(which)g(pairs)g(of)h(hosts,)-150
2694 y(particularly)e(for)i(NFS)h(access.)-150 2944 y
Fh(6.4)99 b(T)-9 b(elnet)-150 3104 y Fs(The)20 b(\002nal)h(application)
d(currently)h(b)n(uilt)i(into)f(Bro)g(is)h(T)-6 b(elnet,)20
b(a)h(ser)n(-)-150 3204 y(vice)c(for)g(remote)g(interacti)n(v)o(e)f
(access)j([PR83a)o(].)24 b(There)17 b(are)g(se)n(v)o(eral)-150
3303 y(signi\002cant)33 b(dif)n(\002culties)f(with)i(monitoring)c(T)-6
b(elnet)33 b(traf)n(\002c.)64 b(The)-150 3403 y(\002rst)33
b(is)g(that,)i(unlik)o(e)d(FTP)-9 b(,)32 b(T)-6 b(elnet)33
b(traf)n(\002c)f(is)h(virtually)e(unstruc-)-150 3503
y(tured.)h(There)22 b(are)h(no)g(nice)f(\223)p Fm(USER)49
b(xyz)p Fs(\224)23 b(directi)n(v)o(es)f(that)h(mak)o(e)-150
3602 y(it)h(tri)n(vial)f(to)h(identify)e(the)i(account)e(associated)h
(with)h(the)f(acti)n(vity;)-150 3702 y(instead,)f(one)f(must)h(emplo)o
(y)e(a)j(series)f(of)g(heuristics)f(and)g(hope)g(for)-150
3801 y(the)f(best.)26 b(This)20 b(problem)f(mak)o(es)h(T)-6
b(elnet)20 b(particularly)f(susceptible)-150 3901 y(to)29
b(subterfuge)d(attacks,)k(since)f(if)g(the)f(heuristics)h(ha)n(v)o(e)f
(holes,)i(an)-150 4001 y(attack)o(er)20 b(can)g(slip)g(through)e(them)i
(undetected.)-67 4103 y(Our)32 b(present)g(goal)g(is)h(to)f(determine)f
(T)-6 b(elnet)32 b(usernames)g(in)g(a)-150 4202 y(rob)n(ust)g(f)o
(ashion,)i(which)e(we)h(discuss)g(in)f(the)g(remainder)f(of)h(this)-150
4302 y(section.)24 b(Scanning)19 b(T)-6 b(elnet)19 b(sessions)h(for)f
(strings)h(re\003ecting)e(ques-)-150 4401 y(tionable)e(acti)n(vity)h
(is)i(of)e(course)f(also)i(highly)e(interesting,)h(b)n(ut)h(must)-150
4501 y(w)o(ait)j(for)e(us)i(to)f(\002rst)h(add)f(re)o(gular)f(e)o
(xpression)f(matching)h(to)h(Bro.)-67 4603 y Fl(Recognizing)29
b(the)h(authentication)e(dialog)o(.)53 b Fs(The)30 b(\002rst)h(f)o
(acet)-150 4703 y(of)25 b(analyzing)f(T)-6 b(elnet)25
b(acti)n(vity)g(is)h(to)g(accurately)e(track)h(the)g(initial)-150
4802 y(authentication)g(dialog)i(and)f(e)o(xtract)h(from)f(it)i(the)f
(usernames)f(as-)-150 4902 y(sociated)c(with)h(both)f(login)g(f)o
(ailures)h(and)f(successes.)33 b(Initially)22 b(we)-150
5001 y(attempted)e(to)h(b)n(uild)g(a)g(state)h(machine)e(that)h(w)o
(ould)g(track)f(the)h(v)n(ari-)-150 5101 y(ous)e(authentication)f
(steps:)25 b(w)o(aiting)20 b(for)e(the)i(username,)e(scanning)-150
5201 y(the)29 b(login)f(prompt)f(\(this)h(comes)h(after)f(the)h
(username,)g(since)g(the)-150 5300 y(processing)22 b(is)i
(line-oriented,)e(and)h(the)g(full,)h(ne)n(wline-terminated)-150
5400 y(prompt)14 b(line)j(does)e(not)h(appear)f(until)h(after)f(the)h
(username)f(has)h(been)2049 -104 y(entered\),)31 b(w)o(aiting)f(for)f
(the)h(passw)o(ord,)i(scanning)c(the)i(passw)o(ord)2049
-5 y(prompt,)36 b(and)e(then)h(looking)d(for)i(an)h(indication)e(that)i
(the)f(pass-)2049 95 y(w)o(ord)d(w)o(as)i(accepted)e(or)g(rejected)h
(\(in)f(which)h(case)g(the)g(process)2049 194 y(repeats\).)46
b(This)28 b(approach,)f(though,)h(founders)d(on)i(the)h(great)f(v)n(a-)
2049 294 y(riety)33 b(of)g(authentication)e(dialogs)i(used)g(by)g(dif)n
(ferent)e(operating)2049 394 y(systems,)25 b(some)e(of)g(which)h
(sometimes)f(do)g(not)g(prompt)f(for)h(pass-)2049 493
y(w)o(ords,)k(or)f(re-prompt)e(for)h(passw)o(ords)h(rather)g(than)f
(login)h(names)2049 593 y(after)34 b(a)g(passw)o(ord)f(f)o(ailure,)k
(or)d(utilize)g(tw)o(o)g(steps)h(of)e(passw)o(ord)2049
693 y(authentication,)20 b(or)h(e)o(xtract)g(usernames)f(from)h(en)m
(vironment)d(v)n(ari-)2049 792 y(ables,)f(and)e(so)i(on.)23
b(W)-7 b(e)17 b(no)n(w)f(are)g(w)o(orking)e(on)i(a)g(simpler)g
(approach,)2049 892 y(based)i(on)f(associating)h(particular)f(strings)h
(\(such)g(as)g(\223P)o(assw)o(ord:\224\))2049 991 y(with)26
b(particular)e(information,)g(and)h(not)g(attempting)f(to)i(track)f
(the)2049 1091 y(authentication)16 b(states)i(e)o(xplicitly)-5
b(.)23 b(It)18 b(appears)f(to)h(w)o(ork)f(better)m(,)g(and)2049
1191 y(its)k(w)o(orkings)e(are)h(certainly)g(easier)g(to)g(follo)n(w)-5
b(.)2132 1297 y(The)57 b(T)-6 b(elnet)57 b(analyzer)f(generates)g
Fm(telnet)p 3598 1297 25 4 v 29 w(logged)p 3927 1297
V 28 w(in)2049 1396 y Fs(upon)20 b(determining)f(that)j(a)g(user)f(has)
h(successfully)f(authenticated,)2049 1496 y Fm(telnet)p
2354 1496 V 29 w(failure)k Fs(when)g(a)h(user)f(has)h(f)o(ailed)f(to)h
(authenticate,)2049 1595 y Fm(authentication)p 2754 1595
V 27 w(skipped)e Fs(if)g(it)g(recognizes)f(the)h(authen-)2049
1695 y(tication)30 b(dialog)g(as)h(one)f(speci\002ed)g(by)g(the)g
(polic)o(y)f(script)i(as)g(not)2049 1795 y(requiring)c(further)i
(analysis,)i(and)e Fm(telnet)p 3415 1795 V 29 w(confused)g
Fs(if)h(the)2049 1894 y(analyzer)17 b(becomes)g(confused)f(re)o
(garding)g(the)i(authentication)e(dia-)2049 1994 y(log.)24
b(\(This)19 b(last)g(could,)f(for)g(e)o(xample,)g(trigger)f(full-pack)o
(et)g(record-)2049 2094 y(ing)j(of)g(the)g(subsequent)f(session,)h(for)
g(later)g(manual)f(analysis.\))2132 2199 y Fl(T)-6 b(ype-ahead.)28
b Fs(A)22 b(basic)g(dif)n(\002culty)e(that)i(complicates)f(the)g(anal-)
2049 2299 y(ysis)j(is)g(type-ahead.)32 b(W)-7 b(e)24
b(cannot)f(rely)g(on)f(the)i(most-recently)d(en-)2049
2399 y(tered)h(string)g(as)i(corresponding)19 b(to)k(the)f(current)g
(prompt)f(line.)32 b(In-)2049 2498 y(stead,)24 b(we)f(k)o(eep)f(track)h
(of)g(user)f(input)h(lines)g(separately)-5 b(,)22 b(and)g(con-)2049
2598 y(sume)27 b(them)h(as)g(we)g(observ)o(e)e(dif)n(ferent)g(prompts.)
46 b(F)o(or)27 b(e)o(xample,)2049 2698 y(if)20 b(the)g(analyzer)f
(scans)h(\223P)o(assw)o(ord:\224,)f(then)g(it)i(associates)g(with)f
(the)2049 2797 y(prompt)15 b(the)i(\002rst)h(unread)d(line)i(in)g(the)g
(user)g(type-ahead)d(b)n(uf)n(fer)m(,)i(and)2049 2897
y(consumes)i(that)h(line.)24 b(The)19 b(hazard)f(of)g(this)i(approach)d
(is)i(if)h(the)e(T)-6 b(el-)2049 2996 y(net)25 b(serv)o(er)f(e)n(v)o
(er)f(\003ushes)i(the)g(type-ahead)d(b)n(uf)n(fer)i(\(due)g(to)g(part)h
(of)2049 3096 y(its)e(authentication)c(dialog,)j(or)f(upon)f(an)i(e)o
(xplicit)f(signal)h(from)f(the)2049 3196 y(user\),)h(then)g(if)g(the)h
(monitor)d(misses)k(this)e(f)o(act)h(it)g(will)g(become)e(out)2049
3295 y(of)29 b(sync.)50 b(This)29 b(opens)f(the)h(monitor)e(to)i(a)g
(subterfuge)e(attack,)j(in)2049 3395 y(which)c(an)h(attack)o(er)f
(passes)h(of)n(f)f(an)h(innocuous)d(string)i(as)i(a)f(user)n(-)2049
3495 y(name,)20 b(and)g(the)h(polic)o(y)f(script)g(in)h(turn)f(f)o
(ails)i(to)f(recognize)e(that)i(the)2049 3594 y(attack)o(er)16
b(in)h(f)o(act)f(has)h(authenticated)e(as)i(a)g(pri)n(vile)o(ged)d
(user)-5 b(.)24 b(One)16 b(\002x)2049 3694 y(to)21 b(this)h
(problem\227re\003ecting)c(a)j(strate)o(gy)f(we)i(adopt)e(for)g(the)h
(more)2049 3793 y(general)g(\223k)o(e)o(ystrok)o(e)f(editing\224)g
(problem)g(discussed)i(belo)n(w\227is)f(to)2049 3893
y(test)i Fr(both)e Fs(usernames)h(and)f(passw)o(ords)h(against)g(an)o
(y)f(list)i(of)f(sensi-)2049 3993 y(ti)n(v)o(e)e(usernames.)2132
4099 y(Unless)37 b(we)f(are)g(careful,)j(type-ahead)34
b(also)i(opens)g(the)g(door)2049 4198 y(to)28 b(another)e(subterfuge)g
(attack.)47 b(F)o(or)27 b(e)o(xample,)h(an)g(attack)o(er)f(can)2049
4298 y(type-ahead)41 b(the)i(string)g(\223P)o(assw)o(ord:\224,)48
b(which,)g(when)43 b(echoed)2049 4397 y(by)i(the)g(T)-6
b(elnet)45 b(serv)o(er)m(,)51 b(w)o(ould)44 b(be)h(interpreted)f(by)h
(the)g(ana-)2049 4497 y(lyzer)26 b(as)i(corresponding)23
b(to)k(a)g(passw)o(ord)g(prompt,)f(when)g(in)h(f)o(act)2049
4597 y(the)40 b(dialog)f(is)i(in)f(a)h(dif)n(ferent)d(state.)85
b(The)40 b(analyzer)f(defends)2049 4696 y(against)32
b(these)i(attacks)f(by)f(checking)g(each)h(typed-ahead)d(string)2049
4796 y(against)16 b(the)g(dif)n(ferent)f(dialog)g(strings)h(it)h(kno)n
(ws)f(about,)g(generating)2049 4896 y Fm(possible)p 2454
4896 V 28 w(telnet)p 2782 4896 V 29 w(ploy)k Fs(upon)f(a)i(match.)2132
5001 y Fl(K)n(eystr)o(ok)o(e)14 b(editing)o(.)23 b Fs(Usernames)15
b(can)g(also)h(become)e(disguised)2049 5101 y(due)21
b(to)g(use)g(of)g(k)o(e)o(ystrok)o(e)e(editing.)27 b(F)o(or)21
b(e)o(xample,)e(we)j(w)o(ould)e(lik)o(e)2049 5201 y(to)29
b(recognize)d(that)j(\223)p Fm(rb<)p Fb(DEL)q Fm(>oot)p
Fs(\224)e(does)h(indeed)f(correspond)2049 5300 y(to)22
b(a)g(username)e(of)h Fm(root)p Fs(,)h(assuming)f(that)g
Fm(<)p Fb(DEL)q Fm(>)g Fs(is)h(the)g(single-)2049 5400
y(character)k(deletion)f(operator)-5 b(.)44 b(W)-7 b(e)28
b(\002nd)e(this)h(assumption,)g(ho)n(w-)1908 5649 y(14)p
eop
%%Page: 15 15
15 14 bop -150 -104 a Fs(e)n(v)o(er)m(,)24 b(problematic,)g(since)h
(some)f(systems)h(use)g Fm(<)p Fb(DEL)q Fm(>)f Fs(and)g(oth-)-150
-5 y(ers)30 b(use)g Fm(<)p Fb(BS)t Fm(>)p Fs(.)52 b(W)-7
b(e)31 b(address)e(this)h(problem)e(by)h(applying)e(both)-150
95 y(forms)h(of)h(editing)f(to)g(usernames,)i(yielding)e(possibly)g
(three)g(dif-)-150 194 y(ferent)21 b(strings,)g(each)g(of)h(which)f
(the)g(script)h(then)f(assesses)i(in)e(turn.)-150 294
y(So,)29 b(for)d(e)o(xample,)i(the)f(string)g(\223)p
Fm(rob<)p Fb(DEL)q Fm(><)p Fb(BS)t Fm(><)p Fb(BS)t Fm(>ot)p
Fs(\224)d(is)-150 394 y(tested)19 b(both)g(directly)-5
b(,)18 b(as)h(\223)p Fm(ro<)p Fb(BS)t Fm(><)p Fb(BS)t
Fm(>ot)p Fs(\224,)f(and)g(as)i(\223)p Fm(root)p Fs(\224.)-67
494 y(Editing)35 b(is)h(not)f(limited)h(to)f(deleting)g(indi)n(vidual)f
(characters,)-150 594 y(ho)n(we)n(v)o(er)-5 b(.)65 b(Some)34
b(systems)g(support)f(deleting)g(entire)h(w)o(ords)g(or)-150
693 y(lines;)24 b(others)d(allo)n(w)i(access)g(to)f(pre)n
(viously-typed)c(lines)23 b(using)f(an)-150 793 y(escape)f(sequence.)26
b(W)-7 b(ord)21 b(and)g(line)g(deletion)f(do)h(not)f(allo)n(w)h(an)g
(at-)-150 893 y(tack)o(er)d(to)g(hide)f(their)h(username,)f(if)h(tests)
h(for)f(sensiti)n(v)o(e)g(usernames)-150 992 y(check)k(for)g(an)o(y)g
(embedded)e(occurrence)g(of)j(the)f(username)g(within)-150
1092 y(the)16 b(input)f(te)o(xt.)23 b(\223History\224)16
b(access)g(to)g(pre)n(vious)f(te)o(xt)g(is)i(more)e(prob-)-150
1191 y(lematic;)j(presently)-5 b(,)17 b(the)g(analyzer)f(recognizes)g
(the)i(operating)d(sys-)-150 1291 y(tem)29 b(that)g(supports)e(this)i
(\(VMS\))g(and,)h(for)e(it)h(only)-5 b(,)29 b(e)o(xpands)f(the)-150
1391 y(escape)20 b(sequence)f(into)h(the)g(te)o(xt)g(of)g(the)g(pre)n
(vious)f(line.)-67 1491 y Fl(T)-8 b(elnet)42 b(options.)88
b Fs(The)41 b(T)-6 b(elnet)42 b(protocol)d(supports)h(a)i(rich,)-150
1591 y(comple)o(x)37 b(mechanism)h(for)g(e)o(xchanging)e(options)i
(between)h(the)-150 1690 y(client)d(and)g(serv)o(er)g([PR83b)o(])g
(\(there)g(are)g(more)g(than)g(50)g(RFCs)-150 1790 y(discussing)27
b(dif)n(ferent)e(T)-6 b(elnet)28 b(options\).)45 b(Unhappily)-5
b(,)26 b(we)i(cannot)-150 1890 y(ignore)j(the)i(possible)g(presence)e
(of)i(these)f(options)g(in)h(our)f(anal-)-150 1989 y(ysis,)j(because)c
(an)h(attack)o(er)f(can)h(embed)e(one)h(in)h(the)g(middle)f(of)-150
2089 y(te)o(xt)d(the)o(y)g(transmit)g(in)h(order)e(to)i(disguise)f
(their)g(intent\227for)f(e)o(x-)-150 2188 y(ample,)33
b(\223)p Fm(ro<)p Fr(option)p Fm(>ot)p Fs(\224.)55 b(The)31
b(T)-6 b(elnet)31 b(serv)o(er)f(will)i(dutifully)-150
2288 y(strip)25 b(out)f(the)h(option)e(before)g(passing)i(along)e(the)i
(remaining)e(te)o(xt)-150 2388 y(to)h(the)f(authentication)f(system.)35
b(W)-7 b(e)25 b(must)e(do)g(the)h(same.)35 b(On)24 b(the)-150
2487 y(other)30 b(hand,)j(parsing)e(options)f(also)i(yields)f(some)g
(bene\002ts:)47 b(we)-150 2587 y(can)20 b(detect)g(connections)e(that)i
(successfully)f(ne)o(gotiate)g(to)h(encrypt)-150 2687
y(the)29 b(data)h(session,)h(and)e(skip)h(subsequent)d(analysis)j
(\(rather)e(than)-150 2786 y(generating)21 b Fm(telnet)p
529 2786 25 4 v 29 w(confused)g Fs(e)n(v)o(ents\),)h(as)i(well)f(as)h
(analyz-)-150 2886 y(ing)g(options)g(used)g(for)g(authentication)e
(\(for)h(e)o(xample,)h(K)n(erberos\))-150 2985 y(and)g(to)g(transmit)g
(the)g(user')-5 b(s)25 b(en)m(vironment)c(v)n(ariables)j(\(some)f(sys-)
-150 3085 y(tems)f(use)h Fm($USER)e Fs(as)i(the)f(def)o(ault)f
(username)g(during)f(subsequent)-150 3185 y(authentication\).)-150
3469 y Ft(7)119 b(Status,)98 b(perf)m(ormance,)g(and)84
b(futur)n(e)29 3618 y(dir)n(ections)-150 3805 y Fs(Bro)26
b(has)g(operated)f(continuously)e(since)k(April)e(1996)g(as)i(an)f
(inte-)-150 3905 y(gral)i(part)g(of)h(our)e(site')-5
b(s)30 b(security)e(system.)50 b(It)29 b(initially)f(included)-150
4005 y(only)d(general)g(TCP/IP)i(analysis;)j(as)d(time)f(permitted,)g
(we)h(added)-150 4104 y(the)c(additional)f(modules)g(discussed)g(in)i
Fi(x)f Fs(6,)h(and)e(we)h(plan)g(to)g(add)-150 4204 y(man)o(y)c(more.)
-67 4304 y(Presently)-5 b(,)42 b(the)c(implementation)e(is)k(about)d
(22,000)f(lines)j(of)-150 4404 y(C++)30 b(and)e(another)g(1,900)f
(lines)j(of)e Fm(Bro)h Fs(\(about)f(1,650)f(lines)j(of)-150
4503 y(which)17 b(are)g(\223boilerplate\224)f(not)h(speci\002c)h(to)f
(our)g(site\).)24 b(It)18 b(runs)f(under)-150 4603 y(Digital)j(Unix,)f
(FreeBSD,)h(IRIX,)g(SunOS,)f(and)g(Solaris)h(operating)-150
4703 y(systems.)25 b(It)19 b(generates)g(about)f(40)h(MB)g(of)g
(connection)e(summaries)-150 4802 y(each)e(day)-5 b(,)15
b(and)g(an)h(a)n(v)o(erage)e(of)h(20)g(real-time)g(noti\002cations,)g
(though)-150 4902 y(this)21 b(\002gure)f(v)n(aries)h(greatly)-5
b(.)25 b(While)d(most)e(of)h(the)g(noti\002cations)f(are)-150
5001 y(innocuous)c(\(and)h(if)h(we)g(were)g(not)g(also)g(de)n(v)o
(elopers)e(of)i(the)g(system,)-150 5101 y(we)31 b(w)o(ould)f(suppress)g
(these\),)j(we)e(not)f(infrequently)e(also)j(detect)-150
5201 y(break-in)25 b(attempts.)47 b(Operation)25 b(of)i(the)h(system)f
(has)h(resulted)e(so)-150 5300 y(f)o(ar)i(in)h(4,000)e(email)h
(messages,)j(85)d(incident)f(reports)h(\002led)g(with)-150
5400 y(CIA)m(C)21 b(and)e(CER)-5 b(T)f(,)21 b(a)g(number)d(of)i
(accounts)f(deacti)n(v)n(ated)g(by)g(other)2049 -104
y(sites,)i(and)f(a)g(couple)f(incidents)h(in)m(v)n(olving)e(la)o(w)i
(enforcement.)2132 -1 y(The)48 b(system)h(generally)f(operates)g
(without)g(incurring)e(an)o(y)2049 99 y(pack)o(et)27
b(drops.)48 b(The)28 b(FDDI)g(ring)g(it)g(runs)g(on)g(is)h(moderately)d
(uti-)2049 198 y(lized:)45 b(a)31 b(recent)e(trace)h(of)g(a)g(2-3PM)g
(b)n(usy)f(hour)g(re\003ects)i(a)f(traf-)2049 298 y(\002c)i(le)n(v)o
(el)g(of)g(8,800)e(pack)o(ets/sec)i(\(25)f(Mbps\))g(sustained)g(for)h
(the)2049 398 y(full)d(hour)m(,)h(with)f(peaks)g(of)g(15,000)e(pack)o
(ets/sec.)52 b(Ho)n(we)n(v)o(er)m(,)30 b(the)2049 497
y(pack)o(et)18 b(\002lter)h(discards)f(a)h(great)f(deal)g(of)h(this,)g
(both)e(due)h(to)h(\002ltering)2049 597 y(primarily)30
b(on)g(SYN,)i(FIN,)f(or)g(RST)h(control)e(bits,)k(and)c(because)2049
697 y(only)f(about)g(20\045)g(of)g(the)h(traf)n(\002c)f(belongs)g(to)h
(netw)o(orks)e(that)i(we)2049 796 y(routinely)d(monitor)g(\(the)i(link)
f(is)i(shared)e(with)h(a)g(lar)o(ge)f(neighbor)2049 896
y(institution\).)54 b(During)30 b(a)g(b)n(usy)g(hour)m(,)i(the)e
(monitor)f(may)h(recei)n(v)o(e)2049 995 y(300,000)18
b(pack)o(ets)h(matching)g(the)h(\002lter)m(,)g(with)h(peaks)f(of)g
(200/sec.)2132 1099 y(In)25 b(order)g(to)g(mak)o(e)h(a)g(preliminary)d
(assessment)j(of)g(the)f(system)2049 1199 y(under)33
b(stress,)39 b(we)c(ran)f(it)i(for)e(a)h(thirty-minute)d(period)h
(without)2049 1298 y(the)25 b(\223interesting)g(netw)o(orks\224)f
(\002lter)m(,)j(resulting)d(in)i(a)f(much)g(higher)2049
1398 y(fraction)g(of)h(traf)n(\002c)g(accepted)f(by)h(the)g(pack)o(et)g
(\002lter)-5 b(.)44 b(During)25 b(this)2049 1498 y(period,)38
b(the)e(\002lter)g(accepted)f(an)g(a)n(v)o(erage)g(of)g(640)g(pack)o
(ets/sec,)2049 1597 y(with)29 b(peaks)g(o)o(v)o(er)e(800/sec.)50
b(Ho)n(we)n(v)o(er)m(,)29 b(the)g(\002lter)g(also)g(reported)2049
1697 y(364)d(dropped)e(pack)o(ets.)44 b(\(W)-7 b(e)28
b(note)e(that)h(the)g(hardw)o(are)e(platform)2049 1796
y(used)20 b(is)h(no)f(longer)f(state-of-the-art.\))2132
1900 y(In)56 b(addition)e(to)j(de)n(v)o(eloping)c(more)i(application)g
(analysis)2049 2000 y(modules,)26 b(we)h(see)h(a)f(number)e(of)i(a)n(v)
o(enues)f(for)g(future)g(w)o(ork.)45 b(As)2049 2099 y(discussed)22
b(abo)o(v)o(e,)e(compiling)g Fm(Bro)i Fs(scripts)g(and)f(de)n(vising)g
(mech-)2049 2199 y(anisms)27 b(to)g(distrib)n(ute)g(monitoring)d
(across)j(multiple)g(CPUs)h(ha)n(v)o(e)2049 2299 y(high)c(priority)-5
b(.)35 b(W)-7 b(e)26 b(are)e(also)h(v)o(ery)e(interested)h(in)g(e)o
(xtending)e(BPF)2049 2398 y(to)29 b(better)f(support)g(monitoring,)g
(such)h(as)g(adding)e(lookup)g(tables)2049 2498 y(and)21
b(v)n(ariable-length)e(snapshots.)29 b(Another)20 b(interesting)h
(direction)2049 2597 y(is)27 b(to)f(add)f(some)h(\223teeth\224)g(to)g
(the)g(monitoring)d(in)j(the)g(form)f(of)h(ac-)2049 2697
y(ti)n(v)o(ely)19 b(terminating)e(misbeha)n(ving)h(connections)g(by)h
(sending)f(RST)2049 2797 y(pack)o(ets)24 b(to)h(their)g(endpoints,)f
(or)g(communicating)e(with)j(interme-)2049 2896 y(diary)d(routers.)32
b(This)24 b(form)d(of)i(\223reacti)n(v)o(e)f(\002re)n(w)o(all\224)h
(might)f(\002t)i(par)n(-)2049 2996 y(ticularly)e(well)i(to)f(en)m
(vironments)d(lik)o(e)j(ours)g(that)g(need)f(to)h(strik)o(e)g(a)2049
3096 y(balance)c(between)h(security)f(and)h(openness.)2132
3199 y(Finally)-5 b(,)19 b(Bro)g(is)h(publicly)e(a)n(v)n(ailable)h(in)g
(source-code)e(form)h(\(see)2049 3299 y Fr(http://www-nr)m(g)o(.ee)o
(.lbl.go)o(v/br)l(o-info.html)h Fs(for)k(release)i(informa-)2049
3398 y(tion\).)f(W)-7 b(e)19 b(hope)f(that)g(it)i(will)f(both)f
(bene\002t)g(the)g(community)e(and)i(in)2049 3498 y(turn)i(bene\002t)f
(from)g(community)f(ef)n(forts)i(to)g(enhance)f(it.)2049
3800 y Ft(8)119 b(Ackno)o(wledgements)2049 3993 y Fs(W)-7
b(e)17 b(gratefully)d(ackno)n(wledge)g(Digital)i(Equipment)d
(Corporation')-5 b(s)2049 4093 y(W)e(estern)17 b(Research)f(Laboratory)
e(for)i(contrib)n(uting)e(the)i(Alpha)g(sys-)2049 4193
y(tem)24 b(that)g(made)f(de)n(v)o(eloping)e(and)i(operating)f(Bro)i(at)
h(high)e(speeds)2049 4292 y(possible.)30 b(I)22 b(w)o(ould)f
(particularly)f(lik)o(e)i(to)g(thank)f(Jef)n(f)h(Mogul,)f(who)2049
4392 y(w)o(as)26 b(instrumental)f(in)g(arranging)f(this)i(through)d
(WRL)-8 b(')j(s)28 b(External)2049 4491 y(Research)20
b(Program.)2132 4595 y(Man)o(y)49 b(thanks,)57 b(too,)h(to)50
b(Craig)g(Leres.)116 b(Bro)50 b(has)h(bene-)2049 4695
y(\002ted)32 b(greatly)e(from)h(man)o(y)f(discussions)h(with)h(him.)59
b(Craig)31 b(also)2049 4794 y(wrote)i(the)g(calendar)e(queue)h(and)h
(non-blocking)c(DNS)34 b(routines)2049 4894 y(discussed)20
b(in)g Fi(x)h Fs(4.)2132 4998 y(My)e(appreciation)e(to)i(Scott)g
(Denton)f(and)g(John)h(Antonishek)e(for)2049 5097 y(alpha-testing)g
(Bro)h(and)g(contrib)n(uting)e(portability)g(\002x)o(es)j(and)e(other)
2049 5197 y(enhancements.)2132 5300 y(Finally)-5 b(,)41
b(this)d(w)o(ork)e(w)o(ould)h(not)g(ha)n(v)o(e)f(been)h(possible)g
(with-)2049 5400 y(out)f(the)g(support)f(and)h(enthusiasm)f(of)h(Mark)g
(Rosenber)o(g,)i(V)-9 b(an)1908 5649 y(15)p eop
%%Page: 16 16
16 15 bop -150 -104 a Fs(Jacobson,)19 b(Stu)h(Lok)o(en)f(and)h(Da)n(v)o
(e)g(Ste)n(v)o(ens\227much)e(appreciated!)-150 181 y
Ft(A)120 b(Example:)36 b(tracking)31 b(Finger)g(traf\002c)-150
368 y Fs(In)d(this)i(appendix)c(we)k(gi)n(v)o(e)d(an)i(o)o(v)o(ervie)n
(w)e(of)h(ho)n(w)g(the)h(dif)n(ferent)-150 468 y(elements)19
b(of)g(Bro)h(come)f(together)f(for)h(monitoring)e(Finger)i(traf)n
(\002c.)-150 567 y(F)o(or)27 b(the)g(e)n(v)o(ent)f(engine,)h(we)h(ha)n
(v)o(e)e(a)i(C++)f(class)h Fm(FingerConn)p Fs(,)-150
667 y(deri)n(v)o(ed)17 b(from)h(the)h(general-purpose)d
Fm(TCP)p 1127 667 25 4 v 29 w(Connection)i Fs(class.)-150
767 y(When)f(Bro)h(encounters)d(a)j(ne)n(w)f(connection)e(with)j
(service)f(port)f(79,)-150 866 y(it)j(instantiates)f(a)h(corresponding)
14 b Fm(FingerConn)j Fs(object,)h(instead)-150 966 y(of)24
b(a)g Fm(TCP)p 160 966 V 30 w(Connection)f Fs(object)g(as)i(it)g(w)o
(ould)e(for)h(an)g(unrecog-)-150 1065 y(nized)c(port.)-67
1166 y Fm(FingerConn)129 b Fs(rede\002nes)h(the)h(virtual)f(function)
-150 1266 y Fm(BuildEndpoints)p Fs(,)29 b(which)g(is)i(in)m(v)n(ok)o
(ed)c(when)i(a)h(connection)-150 1365 y(object)20 b(is)h(\002rst)g
(created:)-150 1532 y Ff(void)39 b(FingerConn::BuildEndpoints\(\))-30
1611 y({)-30 1689 y(resp)g(=)h(new)f(TCP_Endpoint\(this,)e(0\);)-30
1768 y(orig)i(=)h(new)f(TCP_EndpointLine\(this,)d(1,)k(1,)g(0\);)-30
1847 y(})-150 2034 y Fs(Here,)70 b Fm(resp)p Fs(,)g(corresponding)57
b(to)k(the)f(responder)f(\(Finger)-150 2133 y(serv)o(er\))28
b(side)i(of)f(the)g(connection,)g(is)h(initialized)f(to)h(an)f
(ordinary)-150 2233 y Fm(TCP)p 5 2233 V 29 w(Endpoint)i
Fs(object,)i(because)e(Bro)g(does)g(not)g(\(presently\))-150
2332 y(look)37 b(inside)h(Finger)f(replies.)79 b(But)38
b Fm(orig)p Fs(,)k(the)c(Finger)g(client)-150 2432 y(side,)22
b(is)g(initialized)f(to)g(a)h Fm(TCP)p 758 2432 V 30
w(EndpointLine)d Fs(object,)i(which)-150 2532 y(means)f(Bro)h(will)g
(track)f(the)g(contents)g(of)g(that)g(side)h(of)f(the)g(connec-)-150
2631 y(tion,)f(and,)g(furthermore,)e(deli)n(v)o(er)h(the)i(contents)f
(in)h(a)g(line-oriented)-150 2731 y(f)o(ashion)f(to)i
Fm(FingerConn)p Fs(')-5 b(s)19 b(virtual)g Fm(NewLine)h
Fs(function:)-150 2897 y Ff(int)39 b
(FingerConn::NewLine\(TCP_Endpoint*)c(/*)40 b(s)g(*/,)607
2976 y(double)f(/*)h(t)f(*/,)h(char*)f(line\))-30 3055
y({)-30 3134 y(line)g(=)h(skip_whitespace\(line\);)-30
3292 y(//)f(Check)g(for)h(/W.)-30 3371 y(int)f(is_long)g(=)g(\(line[0])
g(==)h('/')f(&&)567 3449 y(toupper\(line[1]\))f(==)h('W'\);)-30
3528 y(if)g(\()h(is_long)f(\))89 3607 y(line)g(=)h
(skip_whitespace\(line+2\);)-30 3765 y(val_list*)e(vl)i(=)f(new)h
(val_list;)-30 3844 y(vl->append\(BuildConnVal\(\)\);)-30
3923 y(vl->append\(new)d(StringVal\(line\)\);)-30 4002
y(vl->append\(new)g(Val\(is_long,)h(TYPE_BOOL\)\);)-30
4159 y(mgr.QueueEvent\(finger_request,)d(vl\);)-30 4238
y(return)k(0;)-30 4317 y(})-150 4503 y Fm(NewLine)28
b Fs(skips)g(whitespace)g(in)g(the)h(request,)g(scans)g(it)g(for)f(the)
-150 4603 y(\223)p Fm(/W)p Fs(\224)c(indicator)f(\(which)h(requests)g
(v)o(erbose)f(Finger)h(output\),)f(and)-150 4703 y(mo)o(v)o(es)30
b(past)i(it)g(if)f(present.)58 b(It)31 b(then)g(creates)g(a)h
Fm(val)p 1485 4703 V 29 w(list)f Fs(ob-)-150 4802 y(ject,)21
b(which)f(holds)g(a)h(list)g(of)g(generic)e(Bro)i Fm(Val)f
Fs(objects.)26 b(The)20 b(\002rst)-150 4902 y(of)25 b(these)g(is)h
(assigned)e(to)i(a)f(generic)f(connection-identi\002er)d(v)n(alue)-150
5001 y(\(see)31 b(belo)n(w\);)j(the)d(second,)g(to)g(a)g(Bro)f
Fm(string)g Fs(containing)f(the)-150 5101 y(Finger)d(request,)h(and)f
(the)h(third)e(to)i(a)g Fm(bool)f Fs(indicating)g(whether)-150
5201 y(the)21 b(request)g(w)o(as)h(v)o(erbose)d(or)i(not.)28
b(The)20 b(penultimate)g(line)h(queues)-150 5300 y(a)g(ne)n(w)f
Fm(finger)p 370 5300 V 29 w(request)g Fs(e)n(v)o(ent)g(with)h(the)f
(corresponding)d(list)-150 5400 y(of)f(v)n(alues)g(as)h(ar)o(guments;)f
(\002nally)-5 b(,)16 b Fm(return)49 b(0)17 b Fs(indicates)f(that)h(the)
2049 -104 y Fm(FingerConn)22 b Fs(is)i(all)f(done)f(with)h(the)g
(memory)f(associated)g(with)2049 -5 y Fm(line)16 b Fs(\(since)g
Fm(new)49 b(StringVal\(line\))14 b Fs(made)h(a)i(cop)o(y)e(of)g(it\),)
2049 95 y(so)21 b(that)f(memory)e(can)i(be)g(reclaimed)g(by)f(the)i
(caller)-5 b(.)2132 194 y(The)34 b(connection)f(identi\002er)h
(discussed)g(abo)o(v)o(e)f(is)j(de\002ned)d(in)2049 294
y(Bro)20 b(as)h(a)g(\223)p Fm(connection)p Fs(\224)d(record:)2049
445 y Ff(type)39 b(endpoint:)g(record)g({)2169 524 y(size:)g(count;)g
(state:)g(count;)2049 603 y(};)2049 682 y(type)g(connection:)f(record)h
({)2169 760 y(id:)g(conn_id;)2169 839 y(orig:)g(endpoint;)f(resp:)h
(endpoint;)2169 918 y(start_time:)f(time;)2169 997 y(duration:)g
(interval;)2169 1076 y(service:)g(string;)2288 1155 y(#)i(if)f(empty,)g
(service)g(not)h(yet)f(determined)2169 1234 y(addl:)g(string;)2169
1312 y(hot:)g(count;)2288 1391 y(#)h(how)f(hot;)g(0)h(=)g(don't)f(know)
g(or)h(not)f(hot)2049 1470 y(};)2049 1642 y Fs(The)19
b Fm(id)h Fs(\002eld)g(is)g(a)g Fm(conn)p 2823 1642 V
30 w(id)f Fs(record,)f(discussed)i(in)g Fi(x)g Fs(3.1.)k
Fm(orig)2049 1741 y Fs(and)29 b Fm(resp)h Fs(correspond)d(to)j(the)g
(connection)e(originator)g(and)h(re-)2049 1841 y(sponder)m(,)22
b(each)h(a)h(Bro)f Fm(endpoint)f Fs(record)g(consisting)h(of)g
Fm(size)2049 1941 y Fs(\(the)c(number)f(of)i(bytes)g(transferred)d(by)j
(that)g(endpoint)e(so)i(f)o(ar\))f(and)2049 2040 y Fm(state)p
Fs(,)38 b(the)c(endpoint')-5 b(s)33 b(TCP)j(state)f(\(e.g.,)i(SYN)e
(sent,)k(estab-)2049 2140 y(lished,)26 b(closed\).)40
b(This)25 b(latter)h(w)o(ould)e(be)h(better)g(e)o(xpressed)f(using)2049
2240 y(an)j(enumerated)e(type)i(\(rather)f(than)g(a)i
Fm(count)p Fs(\),)g(which)f(we)g(may)2049 2339 y(add)20
b(to)g(Bro)g(in)h(the)f(future.)2132 2439 y(The)36 b
Fm(start)p 2553 2439 V 29 w(time)g Fs(\002eld)h(re\003ects)g(when)f
(the)g(connection')-5 b(s)2049 2538 y(\002rst)21 b(pack)o(et)f(w)o(as)h
(seen,)f(and)g Fm(duration)g Fs(ho)n(w)f(long)h(the)g(connec-)2049
2638 y(tion)k(has)h(e)o(xisted.)38 b Fm(service)24 b
Fs(corresponds)e(to)j(the)f(name)g(of)h(the)2049 2738
y(service,)h(or)f(an)g(empty)f(string)h(if)g(it)h(has)g(not)f(been)f
(identi\002ed.)39 b(By)2049 2837 y(con)m(v)o(ention,)33
b Fm(addl)g Fs(holds)f(additional)g(information)f(associated)2049
2937 y(with)e(the)g(connection;)i(better)d(than)h(a)g
Fm(string)f Fs(here)h(w)o(ould)f(be)2049 3037 y(some)16
b(sort)g(of)g(union)f(or)h(generic)f(type,)i(if)f(Bro)h(supported)d
(such.)23 b(Fi-)2049 3136 y(nally)-5 b(,)18 b(by)h(con)m(v)o(ention)d
(the)k(polic)o(y)e(script)h(increments)f Fm(hot)i Fs(when-)2049
3236 y(e)n(v)o(er)g(it)i(\002nds)f(something)f(potentially)g
(suspicious)g(about)g(the)h(con-)2049 3335 y(nection.)2132
3435 y(Here)f(is)h(the)f(corresponding)d(polic)o(y)i(script:)2049
3586 y Ff(global)39 b(hot_names)f(=)i({)g("root",)f("lp",)g("uucp")g
(};)2049 3665 y(global)g(finger_log)f(=)2169 3744 y
(open\(getenv\("BRO_ID"\))e(==)k("")f(?)2368 3823 y("finger.log")f(:)
2368 3901 y(fmt\("finger.\045s",)f(getenv\("BRO_ID"\)\)\);)2049
4059 y(event)i(finger_request\(c:connection,)2886 4138
y(request:)g(string,)2886 4217 y(full:)g(bool\))2169
4296 y({)2169 4375 y(if)g(\()h(byte_len\(request\))d(>)j(80)f(\))h({)
2288 4454 y(request)f(=)h(fmt\("\045s...",)2846 4532
y(sub_bytes\(request,)d(1,)j(80\)\);)2288 4611 y(++c$hot;)2169
4690 y(})2169 4769 y(if)f(\()h(request)f(in)g(hot_names)g(\))2288
4848 y(++c$hot;)2169 5006 y(local)g(req)g(=)h(request)f(==)g("")h(?)
2288 5085 y("ANY")f(:)h(fmt\("\\"\045s\\"",)e(request\);)2169
5163 y(if)h(\()h(c$addl)f(!=)g("")h(\))2288 5242 y(#)g(This)f(is)h(an)f
(additional)g(request.)2288 5321 y(req)h(=)f(fmt\("\(\045s\)",)f
(req\);)2169 5400 y(if)h(\()h(full)f(\))1908 5649 y Fs(16)p
eop
%%Page: 17 17
17 16 bop 89 -104 a Ff(req)40 b(=)f(fmt\("\045s)g(\(/W\)",)g(req\);)-30
53 y(local)g(msg)g(=)h(fmt\("\045s)f(>)g(\045s)h(\045s",)607
132 y(c$id$orig_h,)607 211 y(c$id$resp_h,)607 290 y(req\);)-30
369 y(if)f(\()h(c$hot)f(>)h(0)f(\))89 448 y(log)h(fmt\("finger:)e
(\045s",)h(msg\);)-30 526 y(print)g(finger_log,)209 605
y(fmt\("\045.6f)f(\045s",)h(c$start_time,)f(msg\);)-30
763 y(c$addl)h(=)g(c$addl)g(==)h("")f(?)328 842 y(req)h(:)f
(fmt\("*\045s,)g(\045s",)g(c$addl,)g(req\);)-30 921 y(})-150
1129 y Fs(The)28 b(global)f Fm(hot)p 399 1129 25 4 v
30 w(names)h Fs(is)h(a)g(Bro)f Fm(set)h Fs(of)f Fm(string)p
Fs(.)48 b(In)29 b(the)-150 1229 y(ne)o(xt)22 b(line,)i
Fm(finger)p 490 1229 V 29 w(log)f Fs(is)g(initialized)g(to)g(a)h(Bro)f
Fm(file)p Fs(,)g(either)-150 1329 y(named)f(\223\002nger)-5
b(.log\224,)23 b(or)m(,)g(if)h(the)f Fm(BRO)p 997 1329
V 30 w(ID)g Fs(en)m(vironment)e(v)n(ariable)-150 1428
y(is)g(set,)g(to)f(a)h(name)f(deri)n(v)o(ed)e(from)h(it)i(using)f(the)g
(b)n(uilt-in)g Fm(fmt)g Fs(func-)-150 1528 y(tion.)-67
1634 y(The)28 b Fm(finger)p 396 1634 V 29 w(request)g
Fs(e)n(v)o(ent)g(handler)f(follo)n(ws.)50 b(It)29 b(tak)o(es)-150
1734 y(three)h(ar)o(guments,)i(corresponding)27 b(to)k(the)g(v)n(alues)
g(added)e(to)j(the)-150 1833 y Fm(val)p 5 1833 V 29 w(list)24
b Fs(abo)o(v)o(e.)34 b(It)24 b(\002rst)h(checks)e(whether)g(the)g
(request)h(is)g(e)o(x-)-150 1933 y(cessi)n(v)o(ely)15
b(long,)h(and,)f(if)h(so,)h(truncates)e(it)h(and)f(increments)g(the)h
Fm(hot)-150 2033 y Fs(\002eld)21 b(of)g(the)g(connection')-5
b(s)19 b(information)g(record.)25 b(\(The)c(Bro)g(b)n(uilt-)-150
2132 y(in)j(functions)f(used)h(here)g(are)g(named)g(in)g(terms)g(of)h
(\223bytes\224)e(rather)-150 2232 y(than)16 b(\223string\224)g(because)
f(the)o(y)h(mak)o(e)g(no)g(assumptions)f(about)h(NUL-)-150
2331 y(termination)k(of)i(their)g(ar)o(guments;)e(in)i(particular)m(,)f
Fm(byte)p 1563 2331 V 29 w(len)h Fs(re-)-150 2431 y(turns)g(the)h
(length)f(of)h(its)h(ar)o(gument)c(including)h(a)i(\002nal)g(NUL)g
(byte,)-150 2531 y(if)d(present.\))-67 2637 y(Ne)o(xt,)32
b(the)e(script)g(checks)f(whether)g(the)h(request)f(corresponds)-150
2736 y(to)e(an)o(y)e(of)h(the)h(entries)f(in)h(the)f
Fm(hot)p 935 2736 V 30 w(names)g Fs(set.)44 b(If)26 b(so,)i(it)g(again)
-150 2836 y(marks)20 b(the)g(connection)e(as)j(\223hot.)-6
b(\224)-67 2942 y(W)f(e)25 b(then)e(initialize)g(the)h(local)f(v)n
(ariable)f Fm(req)i Fs(to)f(a)h(quoted)e(v)o(er)n(-)-150
3042 y(sion)17 b(of)h(the)f(request;)h(or)m(,)f(if)h(the)g(request)e(w)
o(as)j(empty)d(\(which)h(in)h(the)-150 3141 y(Finger)25
b(protocol)g(indicates)g(a)i(request)e(type)h(of)f(\223)-7
b(ANY\224\),)26 b(then)g(it)-150 3241 y(is)21 b(changed)e(to)h(\223)-7
b(ANY\224.)-67 3347 y(The)19 b(e)n(v)o(ent)g(handler)g(stores)h(the)f
(Finger)g(request)h(in)f(the)h(connec-)-150 3447 y(tion)g(record')-5
b(s)19 b Fm(addl)h Fs(\002eld)g(\(see)h(belo)n(w\),)e(so)h(the)g(ne)o
(xt)g(line)g(checks)-150 3546 y(to)30 b(see)g(whether)f(this)h(\002eld)
g(already)f(contains)g(a)h(request.)53 b(If)29 b(so,)-150
3646 y(then)19 b(we)h(are)g(seeing)f(multiple)g(requests)h(for)f(a)h
(single)f(Finger)g(con-)-150 3746 y(nection.)30 b(This)23
b(is)g(not)f(allo)n(wed)g(by)f(the)i(Finger)e(protocol,)g(b)n(ut)h
(that)-150 3845 y(doesn')o(t)28 b(mean)h(we)g(w)o(on')o(t)g(see)h
(them!)52 b(In)29 b(particular)m(,)g(we)h(might)-150
3945 y(imagine)23 b(a)i(subterfuge)d(attack)i(in)g(which)g(an)g(attack)
o(er)f(queries)h(an)-150 4045 y(innocuous)h(name)h(in)h(their)g
(\002rst)h(request,)g(and)e(a)h(sensiti)n(v)o(e)g(name)-150
4144 y(in)i(their)f(second,)h(and)f(depending)d(on)j(ho)n(w)g(the)h
(\002nger)e(serv)o(er)h(is)-150 4244 y(written,)g(it)g(may)e(well)h
(respond)f(to)h(both.)1102 4214 y Fn(4)1183 4244 y Fs(This)g(script)g
(will)g(still)-150 4343 y(catch)g(such)g(use,)i(since)f(it)g(fully)f
(processes)g(each)g(request;)j(b)n(ut)e(it)-150 4443
y(needs)21 b(to)g(be)g(careful)f(to)i(k)o(eep)e(the)i(global)e(state)i
(corresponding)17 b(to)-150 4543 y(the)30 b(connection)e(\(in)i(the)g
Fm(addl)f Fs(\002eld\))h(complete.)54 b(T)-7 b(o)30 b(do)f(so,)k(it)
-150 4642 y(marks)21 b(additional)f(requests)h(by)g(enclosing)f(them)h
(in)h(parentheses,)-150 4742 y(and)31 b(also)g(prepends)e(an)i
(asterisk)h(to)f(the)g(entire)g Fm(addl)g Fs(\002eld)g(for)-150
4842 y(each)25 b(additional)g(request,)h(so)g(that)f(in)h(later)g
(visual)f(inspection)g(of)-150 4941 y(the)20 b(Finger)g(logs)g(these)g
(requests)g(immediately)f(stand)h(out.)-67 5047 y(The)k
Fm(msg)g Fs(local)g(v)n(ariable)f(holds)g(the)h(basic)g(description)f
(of)h(the)-150 5147 y(Finger)29 b(request.)51 b(The)29
b Fm(fmt)h Fs(function)d(kno)n(ws)i(to)h(format)e(the)h(IP)p
-150 5244 801 4 v -65 5298 a Fk(4)-30 5321 y Fp(W)-5
b(e)22 b(do)i(indeed)h(see)e(occasional)k(multiple)e(requests.)41
b(So)23 b(f)o(ar)m(,)i(the)o(y)g(ha)o(v)o(e)f(all)-150
5400 y(appeared)19 b(fully)f(innocuous.)2049 -104 y Fs(addresses)38
b Fm(c$id$orig)p 2861 -104 25 4 v 28 w(h)h Fs(and)e Fm(c$id$resp)p
3586 -104 V 28 w(h)i Fs(as)g(\223dotted)2049 -5 y(quads.)-6
b(\224)2132 95 y(Ne)o(xt,)27 b(if)f(the)g(connection)e(has)i(been)f
(mark)o(ed)f(as)j(\223hot\224)e(\(either)2049 194 y(just)30
b(pre)n(viously)-5 b(,)29 b(or)g(perhaps)f(by)g(a)i(completely)e(dif)n
(ferent)f(e)n(v)o(ent)2049 294 y(handler\),)17 b(then)g(the)h(script)h
(generates)e(a)h(real-time)g(noti\002cation.)23 b(In)2049
394 y(an)o(y)17 b(case,)h(it)g(also)g(records)f(the)g(request)g(to)h
(the)g Fm(finger)p 3732 394 V 29 w(log)f Fs(\002le.)2049
493 y(Finally)-5 b(,)24 b(it)g(updates)e(the)i Fm(addl)f
Fs(\002eld)h(to)g(re\003ect)f(the)h(request)e(\(and)2049
593 y(to)e(\003ag)h(multiple)e(requests,)h(as)h(discussed)f(abo)o(v)o
(e\).)2132 693 y(Entries)g(in)g(the)h(log)e(\002le)i(look)f(lik)o(e:)
2049 841 y Ff(880988813.752829)37 b(171.64.15.68)i(>)2726
920 y(128.3.253.104)f("feng")2049 999 y(880991121.364126)f
(131.243.168.28)h(>)2726 1078 y(130.132.143.23)g("anlin")2049
1156 y(880997120.932007)f(192.84.144.6)i(>)2726 1235
y(128.3.32.16)g(ALL)2049 1314 y(881000846.603872)e(128.3.9.45)i(>)2726
1393 y(146.165.7.14)g(ALL)g(\(/W\))2049 1472 y(881001601.958411)e
(152.66.83.11)i(>)2726 1551 y(128.3.13.76)g("davfor")2049
1720 y Fs(\(though)18 b(without)i(the)g(lines)g(split)h(after)f(the)g
(\223)p Fm(>)p Fs(\224\).)2132 1820 y(The)37 b(real-time)f
(noti\002cations)g(look)h(quite)f(similar)m(,)41 b(with)d(the)2049
1919 y(k)o(e)o(yw)o(ord)24 b(\223)p Fm(finger:)p Fs(\224)34
b(added)24 b(to)i(a)n(v)n(oid)f(ambiguity)f(with)h(other)2049
2019 y(types)20 b(of)g(real-time)f(noti\002cation.)2049
2297 y Ft(Refer)n(ences)2049 2482 y Fs([Br88])114 b(R.)32
b(Bro)n(wn,)h(\223Calendar)d(Queues:)47 b(A)32 b(F)o(ast)g
Fj(O)r Fc(\(1\))g Fs(Pri-)2386 2582 y(ority)39 b(Queue)g
(Implementation)e(for)j(the)g(Simulation)2386 2681 y(Ev)o(ent)16
b(Set)j(Problem,)-6 b(\224)17 b Fr(Communications)f(of)i(the)f(A)n(CM)p
Fs(,)2386 2781 y(31\(10\),)g(pp.)j(1220-1227,)c(Oct.)21
b(1988.)2049 2942 y([CT94])91 b(C.)44 b(Compton)f(and)h(D.)g(T)-6
b(ennenhouse,)47 b(\223Collabora-)2386 3041 y(ti)n(v)o(e)e(Load)f
(Shedding)f(for)i(Media-Based)g(Applica-)2386 3141 y(tions,)-6
b(\224)45 b Fr(Pr)l(oc.)c(International)d(Confer)m(ence)i(on)g(Mul-)
2386 3241 y(timedia)i(Computing)f(and)h(Systems)p Fs(,)49
b(Boston,)e(MA,)2386 3340 y(May)-5 b(.)19 b(1994.)2049
3501 y([In97])127 b(Internet)44 b(Security)h(Systems,)52
b(Inc.,)f Fr(RealSecur)m(e)3940 3471 y Fa(TM)4029 3501
y Fs(,)2386 3600 y(http://www)-5 b(.iss.net/prod/rs.html,)16
b(1997.)2049 3761 y([JLM89])40 b(V)-11 b(.)72 b(Jacobson,)83
b(C.)72 b(Leres,)84 b(and)71 b(S.)g(McCanne,)2386 3861
y Fm(tcpdump)p Fs(,)80 b(a)n(v)n(ailable)68 b(via)h(anon)o(ymous)d(ftp)
i(to)2386 3960 y(ftp.ee.lbl.go)o(v)-5 b(,)16 b(Jun.)k(1989.)2049
4121 y([MJ93])91 b(S.)30 b(McCanne)e(and)h(V)-11 b(.)31
b(Jacobson,)f(\223The)f(BSD)i(P)o(ack)o(et)2386 4221
y(Filter:)38 b(A)27 b(Ne)n(w)g(Architecture)f(for)g(User)n(-le)n(v)o
(el)g(P)o(ack)o(et)2386 4320 y(Capture,)-6 b(\224)18
b Fr(Pr)l(oc.)h(1993)e(W)-5 b(inter)20 b(USENIX)f(Confer)m(ence)p
Fs(,)2386 4420 y(San)h(Die)o(go,)f(CA.)2049 4581 y([MLJ94])40
b(S.)77 b(McCanne,)90 b(C.)78 b(Leres)e(and)h(V)-11 b(.)77
b(Jacobson,)2386 4680 y Fm(libpcap)p Fs(,)j(a)n(v)n(ailable)68
b(via)h(anon)o(ymous)d(ftp)i(to)2386 4780 y(ftp.ee.lbl.go)o(v)-5
b(,)16 b(1994.)2049 4940 y([MHL94])39 b(B.)23 b(Mukherjee,)d(L.)i
(Heberlein,)f(and)h(K.)g(Le)n(vitt,)g(\223Net-)2386 5040
y(w)o(ork)33 b(Intrusion)f(Detection,)-6 b(\224)37 b
Fr(IEEE)c(Network)p Fs(,)38 b(8\(3\),)2386 5140 y(pp.)19
b(26-41,)f(May/Jun.)h(1994.)2049 5300 y([Ne97])100 b(Netw)o(ork)41
b(Flight)g(Recorder)m(,)46 b(Inc.,)g Fr(Network)d(Flight)2386
5400 y(Recor)m(der)p Fs(,)19 b(http://www)-5 b(.nfr)g(.com,)17
b(1997.)1908 5649 y(17)p eop
%%Page: 18 18
18 17 bop -150 -104 a Fs([P)o(a94])115 b(V)-11 b(.)35
b(P)o(axson,)i(\223Empirically-Deri)n(v)o(ed)30 b(Analytic)35
b(Mod-)187 -5 y(els)28 b(of)f(W)m(ide-Area)g(TCP)h(Connections,)-6
b(\224)28 b Fr(IEEE/A)n(CM)187 95 y(T)-5 b(r)o(ansactions)34
b(on)g(Networking)p Fs(,)39 b(2\(4\),)e(pp.)e(316-336,)187
194 y(Aug.)19 b(1994.)-150 360 y([P)o(a97])115 b(V)-11
b(.)31 b(P)o(axson,)i(\223End-to-End)28 b(Internet)i(P)o(ack)o(et)h
(Dynam-)187 460 y(ics,)-6 b(\224)67 b Fr(Pr)l(oc.)57
b(SIGCOMM)g('97)p Fs(,)65 b(Cannes,)h(France,)187 560
y(Sep.)20 b(1997.)-150 726 y([PR83a])59 b(J.)26 b(Postel)h(and)f(J.)h
(Re)o(ynolds,)f(\223T)-6 b(elnet)26 b(Protocol)f(Spec-)187
825 y(i\002cation,)-6 b(\224)21 b(RFC)j(854,)d(Netw)o(ork)g
(Information)e(Center)m(,)187 925 y(SRI)i(International,)c(Menlo)j(P)o
(ark,)f(CA,)i(May)f(1983.)-150 1091 y([PR83b])54 b(J.)24
b(Postel)g(and)f(J.)h(Re)o(ynolds,)g(\223T)-6 b(elnet)23
b(Option)g(Speci\002-)187 1191 y(cations,)-6 b(\224)30
b(RFC)g(855,)g(Netw)o(ork)d(Information)f(Center)m(,)187
1290 y(SRI)21 b(International,)c(Menlo)j(P)o(ark,)f(CA,)i(May)f(1983.)
-150 1456 y([PR85])96 b(J.)25 b(Postel)g(and)f(J.)h(Re)o(ynolds,)f
(\223File)h(T)m(ransfer)f(Protocol)187 1556 y(\(FTP\),)-6
b(\224)35 b(RFC)j(959,)h(Netw)o(ork)c(Information)e(Center)m(,)187
1656 y(SRI)21 b(International,)c(Menlo)j(P)o(ark,)f(CA,)i(Oct.)f(1985.)
-150 1822 y([PZCMO96])40 b(N.)22 b(Puk)o(etza,)f(K.)h(Zhang,)e(M.)i
(Chung,)f(B.)h(Mukher)n(-)187 1921 y(jee)34 b(and)f(R.)h(Olsson,)j
(\223)-7 b(A)34 b(Methodology)d(for)i(T)-6 b(esting)187
2021 y(Intrusion)23 b(Detection)i(Systems,)-6 b(\224)27
b Fr(IEEE)e(T)-5 b(r)o(ansactions)187 2121 y(on)40 b(Softwar)m(e)g
(Engineering)p Fs(,)j(22\(10\),)g(pp.)d(719-729,)187
2220 y(Oct.)20 b(1996.)-150 2386 y([RLSSL)-6 b(W97])40
b(M.)25 b(Ranum,)g(K.)g(Land\002eld,)g(M.)f(Stolarchuk,)g(M.)187
2486 y(Sienkie)n(wicz,)41 b(A.)d(Lambeth)e(and)i(E.)g(W)-7
b(all,)43 b(\223Imple-)187 2585 y(menting)29 b(a)i(generalized)e(tool)h
(for)g(netw)o(ork)f(monitor)n(-)187 2685 y(ing,)-6 b(\224)24
b Fr(Pr)l(oc.)g(LISA)f('97)p Fs(,)h(USENIX)g(11th)f(Systems)h(Ad-)187
2785 y(ministration)19 b(Conference,)f(San)i(Die)o(go,)f(Oct.)i(1997.)
-150 2951 y([Sr95a])86 b(R.)21 b(Srini)n(v)n(asan,)f(\223RPC:)i(Remote)
e(Procedure)f(Call)j(Pro-)187 3050 y(tocol)30 b(Speci\002cation)g(V)-9
b(ersion)30 b(2,)-6 b(\224)34 b(RFC)e(1831,)g(DDN)187
3150 y(Netw)o(ork)19 b(Information)e(Center)m(,)j(Aug.)f(1995.)-150
3316 y([Sr95b])81 b(R.)30 b(Srini)n(v)n(asan,)g(\223XDR:)g(External)e
(Data)h(Representa-)187 3416 y(tion)g(Standard,)-6 b(\224)30
b(RFC)g(1832,)g(DDN)g(Netw)o(ork)e(Infor)n(-)187 3515
y(mation)19 b(Center)m(,)g(Aug.)h(1995.)-150 3681 y([T)-7
b(o97])111 b(T)-7 b(ouch)65 b(T)-6 b(echnologies,)75
b(Inc.,)i Fr(INT)o(OUCH)67 b(INSA)p Fs(,)187 3781 y(http://www)-5
b(.ttisms.com/tti/nsa)p 1176 3781 25 4 v 27 w(www)g(.html,)19
b(1997.)-150 3947 y([Wh97])77 b(WheelGroup)151 b(Corporation,)184
b Fr(NetRang)o(er)1740 3917 y Fa(TM)1830 3947 y Fs(,)187
4047 y(http://www)-5 b(.wheelgroup.com,)14 b(1997.)-150
4213 y([WFP96])41 b(G.)30 b(White,)i(E.)e(Fisch)h(and)e(U.)h(Pooch,)i
(\223Cooperating)187 4312 y(Security)e(Managers:)47 b(A)32
b(Peer)n(-Based)g(Intrusion)e(De-)187 4412 y(tection)22
b(System,)-6 b(\224)23 b Fr(IEEE)f(Network)p Fs(,)i(10\(1\),)e(pp.)g
(20-23,)187 4512 y(Jan./Feb)m(.)d(1994.)-150 4678 y([Zi91])123
b(D.)41 b(Zimmerman,)k(\223The)c(Finger)g(User)h(Information)187
4777 y(Protocol,)-6 b(\224)27 b(RFC)h(1288,)f(Netw)o(ork)f(Information)
e(Cen-)187 4877 y(ter)m(,)16 b(SRI)g(International,)e(Menlo)h(P)o(ark,)
g(CA,)h(Dec.)k(1991.)1908 5649 y(18)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
